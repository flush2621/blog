<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>oracle 知识整理 | Coding Test</title>
    <meta name="generator" content="VuePress 1.4.1">
    <link rel="icon" href="/blog/vintage.png">
    <meta name="description" content="">
    <link rel="preload" href="/blog/assets/css/0.styles.eb09ddcc.css" as="style"><link rel="preload" href="/blog/assets/js/app.5c42660f.js" as="script"><link rel="preload" href="/blog/assets/js/2.e56be046.js" as="script"><link rel="preload" href="/blog/assets/js/9.97bb3cd3.js" as="script"><link rel="prefetch" href="/blog/assets/js/10.dfdebfe4.js"><link rel="prefetch" href="/blog/assets/js/11.f6969033.js"><link rel="prefetch" href="/blog/assets/js/12.4ee28117.js"><link rel="prefetch" href="/blog/assets/js/13.3d9bbc61.js"><link rel="prefetch" href="/blog/assets/js/14.d811ee2e.js"><link rel="prefetch" href="/blog/assets/js/15.f33d1813.js"><link rel="prefetch" href="/blog/assets/js/16.ec13d158.js"><link rel="prefetch" href="/blog/assets/js/17.4bc69c62.js"><link rel="prefetch" href="/blog/assets/js/18.ea863cb2.js"><link rel="prefetch" href="/blog/assets/js/19.92aabd56.js"><link rel="prefetch" href="/blog/assets/js/20.88ce400a.js"><link rel="prefetch" href="/blog/assets/js/21.c39432cf.js"><link rel="prefetch" href="/blog/assets/js/22.ef377f9f.js"><link rel="prefetch" href="/blog/assets/js/23.86927b1c.js"><link rel="prefetch" href="/blog/assets/js/3.e684de52.js"><link rel="prefetch" href="/blog/assets/js/4.c397a620.js"><link rel="prefetch" href="/blog/assets/js/5.fc2a5355.js"><link rel="prefetch" href="/blog/assets/js/6.7c45b942.js"><link rel="prefetch" href="/blog/assets/js/7.9973c160.js"><link rel="prefetch" href="/blog/assets/js/8.b26946fc.js">
    <link rel="stylesheet" href="/blog/assets/css/0.styles.eb09ddcc.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog/" class="home-link router-link-active"><!----> <span class="site-name">Coding Test</span></a> <div class="links"><!----> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blog/" class="nav-link">
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="博文" class="dropdown-title"><span class="title">博文</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/java/" class="nav-link">
  Java
</a></li><li class="dropdown-item"><!----> <a href="/blog/cpp/" class="nav-link">
  C++
</a></li><li class="dropdown-item"><!----> <a href="/blog/python/" class="nav-link">
  Python
</a></li><li class="dropdown-item"><!----> <a href="/blog/swagger/" class="nav-link">
  Swagger
</a></li><li class="dropdown-item"><!----> <a href="/blog/zh/" class="nav-link">
  Vuepress
</a></li><li class="dropdown-item"><!----> <a href="/blog/linux/" class="nav-link">
  Linux
</a></li><li class="dropdown-item"><!----> <a href="/blog/oracle/" class="nav-link router-link-active">
  Oracle
</a></li></ul></div></div><div class="nav-item"><a href="https://google.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  关于
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://github.com/flush2621" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/blog/" class="nav-link">
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="博文" class="dropdown-title"><span class="title">博文</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/java/" class="nav-link">
  Java
</a></li><li class="dropdown-item"><!----> <a href="/blog/cpp/" class="nav-link">
  C++
</a></li><li class="dropdown-item"><!----> <a href="/blog/python/" class="nav-link">
  Python
</a></li><li class="dropdown-item"><!----> <a href="/blog/swagger/" class="nav-link">
  Swagger
</a></li><li class="dropdown-item"><!----> <a href="/blog/zh/" class="nav-link">
  Vuepress
</a></li><li class="dropdown-item"><!----> <a href="/blog/linux/" class="nav-link">
  Linux
</a></li><li class="dropdown-item"><!----> <a href="/blog/oracle/" class="nav-link router-link-active">
  Oracle
</a></li></ul></div></div><div class="nav-item"><a href="https://google.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  关于
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://github.com/flush2621" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/blog/oracle/" class="sidebar-link">Oracle笔记</a></li><li><a href="/blog/oracle/oraclenotes.html" class="active sidebar-link">oracle 知识整理</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/oracle/oraclenotes.html#函数扩充" class="sidebar-link">函数扩充</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/oracle/oraclenotes.html#一、wm-concat和connect-by" class="sidebar-link">一、wm_concat和connect by</a></li><li class="sidebar-sub-header"><a href="/blog/oracle/oraclenotes.html#二、伪列生产汉字表" class="sidebar-link">二、伪列生产汉字表</a></li><li class="sidebar-sub-header"><a href="/blog/oracle/oraclenotes.html#三、拆分多行-connect-by-prior-dbms-random-value" class="sidebar-link">三、拆分多行(connect by prior, dbms_random.value)</a></li><li class="sidebar-sub-header"><a href="/blog/oracle/oraclenotes.html#四、多行转列-pivot" class="sidebar-link">四、多行转列(pivot)</a></li><li class="sidebar-sub-header"><a href="/blog/oracle/oraclenotes.html#五、合计-grouping" class="sidebar-link">五、合计(grouping)</a></li><li class="sidebar-sub-header"><a href="/blog/oracle/oraclenotes.html#六、综合应用-grouping-pivot-：" class="sidebar-link">六、综合应用(grouping,pivot)：</a></li></ul></li><li class="sidebar-sub-header"><a href="/blog/oracle/oraclenotes.html#系统信息查询" class="sidebar-link">系统信息查询</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/oracle/oraclenotes.html#一、session明细-v-session-v-sqlarea-v-process" class="sidebar-link">一、Session明细(v$session,v$sqlarea,v$process)</a></li><li class="sidebar-sub-header"><a href="/blog/oracle/oraclenotes.html#二、v-session-longops-执行-6s的sql" class="sidebar-link">二、v$session_longops(执行&gt;6s的sql)</a></li><li class="sidebar-sub-header"><a href="/blog/oracle/oraclenotes.html#三、dba-scheduler-jobs" class="sidebar-link">三、dbaschedulerjobs</a></li></ul></li></ul></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="oracle笔记整理"><a href="#oracle笔记整理" class="header-anchor">#</a> oracle笔记整理</h1> <h2 id="函数扩充"><a href="#函数扩充" class="header-anchor">#</a> 函数扩充</h2> <p><em>Timestamp:2020/5/18</em></p> <h3 id="一、wm-concat和connect-by"><a href="#一、wm-concat和connect-by" class="header-anchor">#</a> 一、wm_concat和connect by</h3> <p>（用于Java的 raw data）</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">with</span> tmp <span class="token keyword">as</span><span class="token punctuation">(</span>
<span class="token keyword">select</span> rownum param <span class="token keyword">from</span> dual <span class="token keyword">connect</span> <span class="token keyword">by</span> rownum <span class="token operator">&lt;</span> <span class="token number">27</span>
<span class="token punctuation">)</span>
<span class="token keyword">select</span> wm_concat<span class="token punctuation">(</span><span class="token string">'&quot;'</span><span class="token operator">||</span>CHR<span class="token punctuation">(</span>param<span class="token operator">+</span><span class="token number">96</span><span class="token punctuation">)</span><span class="token operator">||</span><span class="token string">'&quot;'</span><span class="token punctuation">)</span> <span class="token keyword">from</span> tmp
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">Flux</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> stringFlux1 <span class="token operator">=</span> <span class="token class-name">Flux</span><span class="token punctuation">.</span><span class="token function">just</span><span class="token punctuation">(</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;b&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;c&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;d&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;e&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;f&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;g&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;h&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;i&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;j&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;k&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;l&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;m&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;n&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;o&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;p&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;q&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;r&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;s&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;t&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;u&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;v&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;w&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;x&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;y&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;z&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="二、伪列生产汉字表"><a href="#二、伪列生产汉字表" class="header-anchor">#</a> 二、伪列生产汉字表</h3> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">select</span> t<span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword">from</span><span class="token punctuation">(</span>
     <span class="token keyword">select</span> rownum xh<span class="token punctuation">,</span>nchr<span class="token punctuation">(</span>rownum<span class="token punctuation">)</span> hz <span class="token keyword">from</span> dual
     <span class="token keyword">connect</span> <span class="token keyword">by</span> rownum<span class="token operator">&lt;</span><span class="token number">65535</span>
   <span class="token punctuation">)</span> t
   <span class="token keyword">where</span> t<span class="token punctuation">.</span>xh <span class="token operator">between</span> <span class="token number">19968</span> <span class="token operator">and</span> <span class="token number">40869</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>输出：</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code>        XH HZ
<span class="token comment">---------- --</span>
     <span class="token number">27906</span> 洂
     <span class="token number">27907</span> 洃
     <span class="token number">27908</span> 洄
     <span class="token number">27909</span> 洅
     <span class="token number">27910</span> 洆
     <span class="token number">27911</span> 洇
     <span class="token number">27912</span> 洈
     <span class="token number">27913</span> 洉
     <span class="token number">27914</span> 洊
     <span class="token number">27915</span> 洋
     <span class="token number">27916</span> 洌
     <span class="token number">27917</span> 洍
     <span class="token number">27918</span> 洎
     <span class="token number">27919</span> 洏
     <span class="token number">27920</span> 洐
     <span class="token number">27921</span> 洑
     <span class="token number">27922</span> 洒
     <span class="token number">27923</span> 洓
     <span class="token number">27924</span> 洔
     <span class="token number">27925</span> 洕
     <span class="token number">27926</span> 洖
     <span class="token number">27927</span> 洗
     <span class="token number">27928</span> 洘
     <span class="token number">27929</span> 洙
     <span class="token number">27930</span> 洚
     <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><h3 id="三、拆分多行-connect-by-prior-dbms-random-value"><a href="#三、拆分多行-connect-by-prior-dbms-random-value" class="header-anchor">#</a> 三、拆分多行(connect by prior, dbms_random.value)</h3> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">with</span> p <span class="token keyword">as</span><span class="token punctuation">(</span>
    <span class="token keyword">select</span> area_no<span class="token punctuation">,</span> wm_concat<span class="token punctuation">(</span>old_store_no<span class="token punctuation">)</span> store <span class="token keyword">from</span> store_compare 
    <span class="token keyword">where</span> area_no <span class="token operator">in</span><span class="token punctuation">(</span><span class="token number">51</span><span class="token punctuation">,</span><span class="token number">52</span><span class="token punctuation">,</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token operator">and</span> <span class="token keyword">status</span><span class="token operator">=</span><span class="token number">1</span> <span class="token keyword">group</span> <span class="token keyword">by</span> area_no
<span class="token punctuation">)</span><span class="token comment">//生成测试数据</span>
<span class="token keyword">SELECT</span> area_no<span class="token punctuation">,</span> to_number<span class="token punctuation">(</span>REGEXP_SUBSTR<span class="token punctuation">(</span>store<span class="token punctuation">,</span><span class="token string">'[^,]+'</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token keyword">LEVEL</span><span class="token punctuation">,</span><span class="token string">'i'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> str<span class="token punctuation">,</span> <span class="token keyword">level</span>
<span class="token keyword">FROM</span> p 
<span class="token keyword">CONNECT</span> <span class="token keyword">BY</span> prior area_no <span class="token operator">=</span> area_no <span class="token operator">and</span> prior dbms_random<span class="token punctuation">.</span><span class="token keyword">value</span> <span class="token operator">is</span> <span class="token operator">not</span> <span class="token boolean">null</span>
<span class="token operator">and</span> <span class="token keyword">LEVEL</span><span class="token operator">&lt;=</span> LENGTH<span class="token punctuation">(</span>store<span class="token punctuation">)</span> <span class="token operator">-</span> LENGTH<span class="token punctuation">(</span>REGEXP_REPLACE<span class="token punctuation">(</span>store<span class="token punctuation">,</span> <span class="token string">','</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">1</span>
<span class="token keyword">order</span> <span class="token keyword">by</span> <span class="token number">1</span><span class="token punctuation">,</span><span class="token number">3</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>输出：</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code>   AREA_NO        STR      <span class="token keyword">LEVEL</span>
<span class="token comment">---------- ---------- ----------</span>
        <span class="token number">11</span>         <span class="token number">88</span>          <span class="token number">1</span>
        <span class="token number">11</span>          <span class="token number">7</span>          <span class="token number">2</span>
        <span class="token number">11</span>         <span class="token number">21</span>          <span class="token number">3</span>
        <span class="token number">11</span>         <span class="token number">71</span>          <span class="token number">4</span>
        <span class="token number">11</span>         <span class="token number">30</span>          <span class="token number">5</span>
        <span class="token number">11</span>         <span class="token number">51</span>          <span class="token number">6</span>
        <span class="token number">51</span>         <span class="token number">89</span>          <span class="token number">1</span>
        <span class="token number">51</span>         <span class="token number">68</span>          <span class="token number">2</span>
        <span class="token number">51</span>          <span class="token number">5</span>          <span class="token number">3</span>
        <span class="token number">51</span>         <span class="token number">10</span>          <span class="token number">4</span>
        <span class="token number">51</span>         <span class="token number">84</span>          <span class="token number">5</span>
        <span class="token number">51</span>         <span class="token number">16</span>          <span class="token number">6</span>
        <span class="token number">52</span>         <span class="token number">27</span>          <span class="token number">1</span>
        <span class="token number">52</span>         <span class="token number">38</span>          <span class="token number">2</span>
        <span class="token number">52</span>          <span class="token number">9</span>          <span class="token number">3</span>
        <span class="token number">52</span>         <span class="token number">43</span>          <span class="token number">4</span>
        <span class="token number">52</span>         <span class="token number">18</span>          <span class="token number">5</span>
        <span class="token number">52</span>         <span class="token number">64</span>          <span class="token number">6</span>
        <span class="token number">52</span>         <span class="token number">33</span>          <span class="token number">7</span>
        <span class="token number">52</span>         <span class="token number">20</span>          <span class="token number">8</span>

已选择<span class="token number">20</span>行。
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><h3 id="四、多行转列-pivot"><a href="#四、多行转列-pivot" class="header-anchor">#</a> 四、多行转列(pivot)</h3> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> 
<span class="token punctuation">(</span>
	<span class="token keyword">SELECT</span> group_no<span class="token punctuation">,</span> location<span class="token punctuation">,</span> vat_total_retail <span class="token keyword">FROM</span> erp_jxc_group
	<span class="token keyword">where</span> tran_date <span class="token operator">=</span> to_date<span class="token punctuation">(</span>sysdate<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">and</span>
    	location <span class="token operator">in</span><span class="token punctuation">(</span><span class="token keyword">select</span> new_store_no <span class="token keyword">from</span> store_compare <span class="token keyword">where</span> area_no<span class="token operator">=</span><span class="token number">51</span> <span class="token operator">and</span> <span class="token keyword">status</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span>  
<span class="token keyword">pivot</span> 
<span class="token punctuation">(</span>
    <span class="token function">SUM</span><span class="token punctuation">(</span>vat_total_retail<span class="token punctuation">)</span> <span class="token keyword">FOR</span> location <span class="token operator">IN</span> <span class="token punctuation">(</span><span class="token number">100097</span><span class="token punctuation">,</span><span class="token number">100098</span><span class="token punctuation">,</span><span class="token number">100101</span><span class="token punctuation">,</span><span class="token number">100103</span><span class="token punctuation">,</span><span class="token number">100198</span><span class="token punctuation">,</span><span class="token number">100199</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>输出：</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code>  GROUP_NO     <span class="token number">100097</span>     <span class="token number">100098</span>     <span class="token number">100101</span>     <span class="token number">100103</span>     <span class="token number">100198</span>     <span class="token number">100199</span>
<span class="token comment">---------- ---------- ---------- ---------- ---------- ---------- ----------</span>
       <span class="token number">303</span>    <span class="token number">5754.09</span>    <span class="token number">7530.66</span>    <span class="token number">3122.16</span>    <span class="token number">5531.09</span>     <span class="token number">1842.2</span>    <span class="token number">2235.53</span>
       <span class="token number">309</span>     <span class="token number">1245.2</span>          <span class="token number">0</span>       <span class="token number">89.8</span>     <span class="token number">7240.7</span>          <span class="token number">0</span>          <span class="token number">0</span>
       <span class="token number">310</span>      <span class="token number">624.4</span>     <span class="token number">1842.1</span>        <span class="token number">966</span>     <span class="token number">3648.5</span>       <span class="token number">91.8</span>      <span class="token number">269.2</span>
       <span class="token number">307</span>       <span class="token number">61.8</span>      <span class="token number">482.1</span>          <span class="token number">0</span>      <span class="token number">133.4</span>          <span class="token number">0</span>       <span class="token number">81.8</span>
       <span class="token number">205</span>       <span class="token number">4943</span>    <span class="token number">7359.25</span>    <span class="token number">2524.08</span>     <span class="token number">7089.8</span>    <span class="token number">1752.68</span>     <span class="token number">2194.8</span>
       <span class="token number">102</span>   <span class="token number">23678.13</span>   <span class="token number">20455.59</span>    <span class="token number">9076.26</span>   <span class="token number">18634.53</span>    <span class="token number">7083.65</span>   <span class="token number">10568.19</span>
       <span class="token number">201</span>   <span class="token number">36147.38</span>   <span class="token number">72443.88</span>   <span class="token number">22054.07</span>   <span class="token number">37959.31</span>   <span class="token number">12888.72</span>   <span class="token number">14477.76</span>
       <span class="token number">306</span>      <span class="token number">402.1</span>        <span class="token number">280</span>     <span class="token number">276.48</span>        <span class="token number">692</span>      <span class="token number">223.8</span>       <span class="token number">92.4</span>
       <span class="token number">308</span>     <span class="token number">3615.8</span>     <span class="token number">6451.3</span>    <span class="token number">1607.52</span>   <span class="token number">10462.25</span>      <span class="token number">350.5</span>      <span class="token number">906.3</span>
       <span class="token number">206</span>   <span class="token number">21560.33</span>   <span class="token number">42297.53</span>   <span class="token number">12735.87</span>   <span class="token number">20483.38</span>    <span class="token number">4239.88</span>    <span class="token number">9086.99</span>
       <span class="token number">301</span>     <span class="token number">2790.4</span>      <span class="token number">770.4</span>      <span class="token number">632.6</span>      <span class="token number">913.2</span>      <span class="token number">374.8</span>      <span class="token number">387.2</span>
       <span class="token number">101</span>   <span class="token number">37649.24</span>   <span class="token number">23336.13</span>   <span class="token number">20118.01</span>   <span class="token number">35692.87</span>   <span class="token number">15110.78</span>   <span class="token number">20996.78</span>
       <span class="token number">104</span>    <span class="token number">9685.68</span>   <span class="token number">13425.62</span>    <span class="token number">7651.62</span>   <span class="token number">12385.69</span>    <span class="token number">3031.67</span>    <span class="token number">4799.84</span>
       <span class="token number">202</span>    <span class="token number">6428.53</span>    <span class="token number">10603.6</span>    <span class="token number">4330.86</span>    <span class="token number">6783.47</span>    <span class="token number">4153.26</span>    <span class="token number">3719.16</span>
       <span class="token number">203</span>   <span class="token number">11947.55</span>     <span class="token number">9904.3</span>    <span class="token number">5266.93</span>   <span class="token number">10021.92</span>    <span class="token number">2337.16</span>    <span class="token number">3468.64</span>
       <span class="token number">304</span>          <span class="token number">0</span>          <span class="token number">0</span>                     <span class="token number">0</span>
       <span class="token number">103</span>    <span class="token number">4532.18</span>    <span class="token number">5549.28</span>    <span class="token number">3104.82</span>    <span class="token number">5803.72</span>    <span class="token number">1999.93</span>    <span class="token number">1968.47</span>
       <span class="token number">204</span>    <span class="token number">18334.7</span>   <span class="token number">35790.53</span>   <span class="token number">12650.82</span>   <span class="token number">24362.46</span>    <span class="token number">4874.12</span>    <span class="token number">9191.27</span>
       <span class="token number">302</span>      <span class="token number">380.8</span>     <span class="token number">1346.2</span>      <span class="token number">342.2</span>      <span class="token number">336.6</span>      <span class="token number">115.7</span>       <span class="token number">72.7</span>
       <span class="token number">305</span>        <span class="token number">540</span>        <span class="token number">606</span>        <span class="token number">515</span>       <span class="token number">1082</span>          <span class="token number">0</span>         <span class="token number">99</span>
       <span class="token number">601</span>          <span class="token number">0</span>          <span class="token number">0</span>          <span class="token number">0</span>          <span class="token number">0</span>          <span class="token number">0</span>          <span class="token number">0</span>

已选择<span class="token number">21</span>行。
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><h3 id="五、合计-grouping"><a href="#五、合计-grouping" class="header-anchor">#</a> 五、合计(grouping)</h3> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code>  <span class="token keyword">select</span> supplier<span class="token punctuation">,</span> 
         location<span class="token punctuation">,</span>
         <span class="token keyword">case</span> <span class="token keyword">when</span><span class="token punctuation">(</span>grouping<span class="token punctuation">(</span>mm<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">then</span> <span class="token string">'合计'</span> <span class="token keyword">else</span> mm <span class="token keyword">end</span> mm<span class="token punctuation">,</span> 
         <span class="token function">sum</span><span class="token punctuation">(</span>profit<span class="token punctuation">)</span> profit<span class="token punctuation">,</span> <span class="token function">sum</span><span class="token punctuation">(</span>sale_amount<span class="token punctuation">)</span> sales
  <span class="token keyword">from</span> extract_profit_nj
  <span class="token keyword">where</span> mm <span class="token operator">like</span> <span class="token string">'2019%'</span>
  <span class="token keyword">group</span> <span class="token keyword">by</span> supplier<span class="token punctuation">,</span>location<span class="token punctuation">,</span>rollup<span class="token punctuation">(</span>mm<span class="token punctuation">)</span>
  <span class="token keyword">order</span> <span class="token keyword">by</span> supplier<span class="token punctuation">,</span> location<span class="token punctuation">,</span> mm
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>输出：</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code>  SUPPLIER   LOCATION MM                                   PROFIT      SALES
<span class="token comment">---------- ---------- -------------------------------- ---------- ----------</span>
  <span class="token number">22104274</span>     <span class="token number">100216</span> <span class="token number">201908</span>                             <span class="token number">1991.458</span>   <span class="token number">19914.58</span>
  <span class="token number">22104274</span>     <span class="token number">100216</span> <span class="token number">201909</span>                              <span class="token number">2000.54</span>    <span class="token number">20005.4</span>
  <span class="token number">22104274</span>     <span class="token number">100216</span> <span class="token number">201910</span>                             <span class="token number">1999.327</span>   <span class="token number">19993.27</span>
  <span class="token number">22104274</span>     <span class="token number">100216</span> <span class="token number">201911</span>                              <span class="token number">1426.34</span>    <span class="token number">14263.4</span>
  <span class="token number">22104274</span>     <span class="token number">100216</span> <span class="token number">201912</span>                              <span class="token number">1369.25</span>    <span class="token number">13692.5</span>
  <span class="token number">22104274</span>     <span class="token number">100216</span> 合计                               <span class="token number">8786.915</span>   <span class="token number">87869.15</span>
  <span class="token number">22104283</span>     <span class="token number">100098</span> <span class="token number">201907</span>                              <span class="token number">11.2244</span>      <span class="token number">51.02</span>
  <span class="token number">22104283</span>     <span class="token number">100098</span> <span class="token number">201908</span>                            <span class="token number">1450.8758</span>    <span class="token number">6594.89</span>
  <span class="token number">22104283</span>     <span class="token number">100098</span> <span class="token number">201909</span>                             <span class="token number">3590.191</span>   <span class="token number">16319.05</span>
  <span class="token number">22104283</span>     <span class="token number">100098</span> 合计                              <span class="token number">5052.2912</span>   <span class="token number">22964.96</span>
  <span class="token number">22104283</span>     <span class="token number">100101</span> <span class="token number">201907</span>                                <span class="token number">5.544</span>       <span class="token number">25.2</span>
  <span class="token number">22104283</span>     <span class="token number">100101</span> <span class="token number">201908</span>                              <span class="token number">352.473</span>    <span class="token number">1602.15</span>
  <span class="token number">22104283</span>     <span class="token number">100101</span> <span class="token number">201909</span>                             <span class="token number">780.7294</span>    <span class="token number">3548.77</span>
  <span class="token number">22104283</span>     <span class="token number">100101</span> 合计                              <span class="token number">1138.7464</span>    <span class="token number">5176.12</span>
  <span class="token number">22104285</span>     <span class="token number">100097</span> <span class="token number">201908</span>                             <span class="token number">830.9202</span>    <span class="token number">3776.91</span>
  <span class="token number">22104285</span>     <span class="token number">100097</span> <span class="token number">201909</span>                            <span class="token number">1631.8346</span>    <span class="token number">7417.43</span>
  <span class="token number">22104285</span>     <span class="token number">100097</span> 合计                              <span class="token number">2462.7548</span>   <span class="token number">11194.34</span>
  <span class="token number">22104285</span>     <span class="token number">100103</span> <span class="token number">201908</span>                             <span class="token number">764.5154</span>    <span class="token number">3475.07</span>
  <span class="token number">22104285</span>     <span class="token number">100103</span> <span class="token number">201909</span>                            <span class="token number">1495.5952</span>    <span class="token number">6798.16</span>
  <span class="token number">22104285</span>     <span class="token number">100103</span> 合计                              <span class="token number">2260.1106</span>   <span class="token number">10273.23</span>
  <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><h3 id="六、综合应用-grouping-pivot-："><a href="#六、综合应用-grouping-pivot-：" class="header-anchor">#</a> 六、综合应用(grouping,pivot)：</h3> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">with</span> ep <span class="token keyword">as</span><span class="token punctuation">(</span>
  <span class="token keyword">select</span> turn_store<span class="token punctuation">(</span>store_no<span class="token punctuation">)</span> loc<span class="token punctuation">,</span> suppl_no<span class="token punctuation">,</span> 
         <span class="token keyword">case</span> <span class="token keyword">when</span><span class="token punctuation">(</span>mark <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">then</span> pages<span class="token operator">||</span><span class="token string">'季度'</span> 
         <span class="token keyword">when</span><span class="token punctuation">(</span>mark <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token keyword">then</span> decode<span class="token punctuation">(</span>pages<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">'上半年'</span><span class="token punctuation">,</span><span class="token string">'下半年'</span><span class="token punctuation">)</span> 
         <span class="token keyword">else</span> <span class="token string">'全年'</span> <span class="token keyword">end</span> intervals <span class="token punctuation">,</span>
         extract_profit
  <span class="token keyword">from</span> associatesup_base <span class="token keyword">where</span> <span class="token keyword">year</span><span class="token operator">=</span><span class="token number">2019</span> <span class="token operator">and</span> mark <span class="token operator">=</span><span class="token number">3</span>
<span class="token punctuation">)</span><span class="token punctuation">,</span>
epn <span class="token keyword">as</span><span class="token punctuation">(</span>
  <span class="token keyword">select</span> t1<span class="token punctuation">.</span>loc<span class="token punctuation">,</span> t1<span class="token punctuation">.</span>suppl_no<span class="token punctuation">,</span> t2<span class="token punctuation">.</span>second_supp_name names<span class="token punctuation">,</span> t1<span class="token punctuation">.</span>intervals<span class="token punctuation">,</span> t1<span class="token punctuation">.</span>extract_profit
  <span class="token keyword">from</span> ep t1<span class="token punctuation">,</span> erp_supplier_loc t2
  <span class="token keyword">where</span> t1<span class="token punctuation">.</span>loc<span class="token operator">=</span>t2<span class="token punctuation">.</span>location <span class="token operator">and</span> t1<span class="token punctuation">.</span>suppl_no<span class="token operator">=</span>t2<span class="token punctuation">.</span>second_supp
<span class="token punctuation">)</span><span class="token punctuation">,</span>
extra <span class="token keyword">as</span><span class="token punctuation">(</span>
  <span class="token keyword">select</span> supplier<span class="token punctuation">,</span> 
         location<span class="token punctuation">,</span>
         <span class="token keyword">case</span> <span class="token keyword">when</span><span class="token punctuation">(</span>grouping<span class="token punctuation">(</span>mm<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">then</span> <span class="token string">'合计'</span> <span class="token keyword">else</span> mm <span class="token keyword">end</span> mm<span class="token punctuation">,</span> 
         <span class="token function">sum</span><span class="token punctuation">(</span>profit<span class="token punctuation">)</span> profit<span class="token punctuation">,</span> <span class="token function">sum</span><span class="token punctuation">(</span>sale_amount<span class="token punctuation">)</span> sales
  <span class="token keyword">from</span> extract_profit_nj
  <span class="token keyword">where</span> mm <span class="token operator">like</span> <span class="token string">'2019%'</span>
  <span class="token keyword">group</span> <span class="token keyword">by</span> supplier<span class="token punctuation">,</span>location<span class="token punctuation">,</span>rollup<span class="token punctuation">(</span>mm<span class="token punctuation">)</span>
  <span class="token keyword">order</span> <span class="token keyword">by</span> supplier<span class="token punctuation">,</span> location<span class="token punctuation">,</span> mm
<span class="token punctuation">)</span><span class="token punctuation">,</span>
merges <span class="token keyword">as</span><span class="token punctuation">(</span>
  <span class="token keyword">select</span> t1<span class="token punctuation">.</span>suppl_no<span class="token punctuation">,</span> t1<span class="token punctuation">.</span>names<span class="token punctuation">,</span> t1<span class="token punctuation">.</span>loc<span class="token punctuation">,</span> t1<span class="token punctuation">.</span>extract_profit<span class="token punctuation">,</span> t2<span class="token punctuation">.</span>profit<span class="token punctuation">,</span> sales<span class="token punctuation">,</span> mm
  <span class="token keyword">from</span> epn t1<span class="token punctuation">,</span> extra t2
  <span class="token keyword">where</span> t1<span class="token punctuation">.</span>loc<span class="token operator">=</span>t2<span class="token punctuation">.</span>location <span class="token operator">and</span> t1<span class="token punctuation">.</span>suppl_no<span class="token operator">=</span>t2<span class="token punctuation">.</span>supplier
<span class="token punctuation">)</span><span class="token punctuation">,</span>
profit <span class="token keyword">as</span><span class="token punctuation">(</span>
  <span class="token keyword">select</span> <span class="token operator">*</span>
  <span class="token keyword">from</span> <span class="token punctuation">(</span><span class="token keyword">select</span> suppl_no<span class="token punctuation">,</span> names<span class="token punctuation">,</span> loc<span class="token punctuation">,</span> extract_profit<span class="token punctuation">,</span> profit<span class="token punctuation">,</span> mm <span class="token keyword">from</span> merges<span class="token punctuation">)</span>
  <span class="token keyword">pivot</span> <span class="token punctuation">(</span><span class="token function">sum</span><span class="token punctuation">(</span>profit<span class="token punctuation">)</span> <span class="token keyword">for</span> mm <span class="token operator">in</span><span class="token punctuation">(</span><span class="token number">201901</span><span class="token punctuation">,</span><span class="token number">201902</span><span class="token punctuation">,</span><span class="token number">201903</span><span class="token punctuation">,</span><span class="token number">201904</span><span class="token punctuation">,</span><span class="token number">201905</span><span class="token punctuation">,</span><span class="token number">201906</span><span class="token punctuation">,</span><span class="token number">201907</span><span class="token punctuation">,</span><span class="token number">201908</span><span class="token punctuation">,</span><span class="token number">201909</span><span class="token punctuation">,</span><span class="token number">201910</span><span class="token punctuation">,</span><span class="token string">'合计'</span> <span class="token keyword">as</span> 毛利合计<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">,</span>
sales <span class="token keyword">as</span><span class="token punctuation">(</span>
  <span class="token keyword">select</span> <span class="token operator">*</span>
  <span class="token keyword">from</span> <span class="token punctuation">(</span><span class="token keyword">select</span> suppl_no<span class="token punctuation">,</span> names<span class="token punctuation">,</span> loc<span class="token punctuation">,</span> extract_profit<span class="token punctuation">,</span> sales<span class="token punctuation">,</span> mm <span class="token keyword">from</span> merges<span class="token punctuation">)</span>
  <span class="token keyword">pivot</span> <span class="token punctuation">(</span><span class="token function">sum</span><span class="token punctuation">(</span>sales<span class="token punctuation">)</span> <span class="token keyword">for</span> mm <span class="token operator">in</span><span class="token punctuation">(</span><span class="token string">'合计'</span> <span class="token keyword">as</span> 销售合计<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span>
<span class="token keyword">select</span> t1<span class="token punctuation">.</span><span class="token operator">*</span><span class="token punctuation">,</span> t2<span class="token punctuation">.</span>销售合计
<span class="token keyword">from</span> profit t1<span class="token punctuation">,</span> sales t2
<span class="token keyword">where</span> t1<span class="token punctuation">.</span>suppl_no<span class="token operator">=</span>t2<span class="token punctuation">.</span>suppl_no <span class="token operator">and</span> t1<span class="token punctuation">.</span>loc<span class="token operator">=</span>t2<span class="token punctuation">.</span>loc
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br></div></div><p>输出：</p> <table><thead><tr><th style="text-align:left;">SUPPL_NO</th> <th>NAMES</th> <th>LOC</th> <th>EXTRACT_PROFIT</th> <th>201901</th> <th>201902</th> <th>201903</th> <th>201904</th> <th>201905</th> <th>201906</th> <th>201907</th> <th>201908</th> <th>201909</th> <th>201910</th> <th>毛利合计</th> <th>销售合计</th></tr></thead> <tbody><tr><td style="text-align:left;">22007738</td> <td>南京润兆食品有限公司</td> <td>100102</td> <td>16000</td> <td>361.985</td> <td>436.6875</td> <td>272.0525</td> <td>327.55</td> <td>324.5325</td> <td>217.03</td> <td>57.975</td> <td>203.44</td> <td>116.2025</td> <td>120.965</td> <td>3130.478</td> <td>12521.91</td></tr> <tr><td style="text-align:left;">22007787</td> <td>金华市鑫宇商贸有限公司</td> <td>100099</td> <td>84000</td> <td>6143.265</td> <td>7095.271</td> <td>5700.585</td> <td>5369.146</td> <td>5484.772</td> <td>4928.636</td> <td>5609.974</td> <td>6388.335</td> <td>4041.061</td> <td>5389.075</td> <td>63065.21</td> <td>200414.7</td></tr> <tr><td style="text-align:left;">22007827</td> <td>上海瑷馨露贸易有限公司</td> <td>100099</td> <td>60000</td> <td>222.2976</td> <td>162.24</td> <td>54.72</td> <td>510.3864</td> <td>101.49</td> <td>340.68</td> <td></td> <td></td> <td></td> <td>55.23555</td> <td>1775.49</td> <td>7195.46</td></tr> <tr><td style="text-align:left;">22104132</td> <td>广州希艺欧家居用品有限公司...</td> <td>100103...</td> <td>61600</td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td>3214.572</td> <td>5744.702</td> <td>5463.819</td> <td>4439.644</td> <td>27218.25</td> <td>121426.2</td></tr></tbody></table> <h2 id="系统信息查询"><a href="#系统信息查询" class="header-anchor">#</a> 系统信息查询</h2> <h3 id="一、session明细-v-session-v-sqlarea-v-process"><a href="#一、session明细-v-session-v-sqlarea-v-process" class="header-anchor">#</a> 一、Session明细(v$session,v$sqlarea,v$process)</h3> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SELECT</span> SE<span class="token punctuation">.</span>sid<span class="token punctuation">,</span> SE<span class="token punctuation">.</span><span class="token keyword">serial</span><span class="token comment">#, PR.spid, SE.status, SUBSTR(SE.program, 1, 10) PROG,</span>
    SUBSTR<span class="token punctuation">(</span>SE<span class="token punctuation">.</span>machine<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span> MACH<span class="token punctuation">,</span> pr<span class="token punctuation">.</span>pid<span class="token punctuation">,</span>
    SQ<span class="token punctuation">.</span>sql_text
<span class="token keyword">FROM</span> v$<span class="token keyword">session</span> SE<span class="token punctuation">,</span> v$sqlarea SQ<span class="token punctuation">,</span> v$process PR
<span class="token keyword">WHERE</span> SE<span class="token punctuation">.</span>paddr <span class="token operator">=</span> PR<span class="token punctuation">.</span>ADDR<span class="token punctuation">(</span><span class="token operator">+</span><span class="token punctuation">)</span>
    <span class="token operator">AND</span> SE<span class="token punctuation">.</span>sql_address <span class="token operator">=</span> SQ<span class="token punctuation">.</span>address<span class="token punctuation">(</span><span class="token operator">+</span><span class="token punctuation">)</span>
    <span class="token operator">AND</span> schemaname <span class="token operator">like</span> <span class="token string">'HEADOF'</span>
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> SE<span class="token punctuation">.</span>sid<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p><img src="/blog/assets/img/ora1.d6ac5e2d.png" alt="An image"></p> <h3 id="二、v-session-longops-执行-6s的sql"><a href="#二、v-session-longops-执行-6s的sql" class="header-anchor">#</a> 二、v$session_longops(执行&gt;6s的sql)</h3> <p>v$session_longops是v$session的子集</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SELECT</span> V<span class="token punctuation">.</span>SQL_ID<span class="token punctuation">,</span>
       A<span class="token punctuation">.</span>USERNAME<span class="token punctuation">,</span>
       A<span class="token punctuation">.</span>SID<span class="token punctuation">,</span>
       A<span class="token punctuation">.</span>OPNAME<span class="token punctuation">,</span>
       T<span class="token punctuation">.</span><span class="token keyword">status</span><span class="token punctuation">,</span> T<span class="token punctuation">.</span>program<span class="token punctuation">,</span> T<span class="token punctuation">.</span>machine<span class="token punctuation">,</span>
       <span class="token function">ROUND</span><span class="token punctuation">(</span>decode<span class="token punctuation">(</span>A<span class="token punctuation">.</span>TOTALWORK<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>A<span class="token punctuation">.</span>SOFAR <span class="token operator">*</span> <span class="token number">100</span> <span class="token operator">/</span> A<span class="token punctuation">.</span>TOTALWORK<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token string">'%'</span> <span class="token keyword">AS</span> <span class="token string">&quot;执行进度百分比&quot;</span><span class="token punctuation">,</span>
       A<span class="token punctuation">.</span>TIME_REMAINING <span class="token string">&quot;估计剩余时间(秒)&quot;</span><span class="token punctuation">,</span>
       V<span class="token punctuation">.</span>SQL_TEXT<span class="token punctuation">,</span>
       A<span class="token punctuation">.</span>ELAPSED_SECONDS <span class="token string">&quot;执行时间(秒)&quot;</span><span class="token punctuation">,</span>
       A<span class="token punctuation">.</span>START_TIME <span class="token string">&quot;执行开始时间&quot;</span><span class="token punctuation">,</span>
       A<span class="token punctuation">.</span>TOTALWORK <span class="token string">&quot;总数(块block)&quot;</span><span class="token punctuation">,</span>
       A<span class="token punctuation">.</span>SOFAR <span class="token string">&quot;已完成数(块block)&quot;</span><span class="token punctuation">,</span>
       decode<span class="token punctuation">(</span>A<span class="token punctuation">.</span>ELAPSED_SECONDS<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>A<span class="token punctuation">.</span>SOFAR <span class="token operator">/</span> A<span class="token punctuation">.</span>ELAPSED_SECONDS<span class="token punctuation">)</span> <span class="token string">&quot;每秒扫描数(块block)&quot;</span>
  <span class="token keyword">FROM</span> V$SESSION_LONGOPS A<span class="token punctuation">,</span> V$<span class="token keyword">SQL</span> V<span class="token punctuation">,</span> V$<span class="token keyword">SESSION</span> T
 <span class="token keyword">WHERE</span> A<span class="token punctuation">.</span>SQL_ADDRESS <span class="token operator">=</span> V<span class="token punctuation">.</span>ADDRESS
   <span class="token operator">AND</span> A<span class="token punctuation">.</span>SID <span class="token operator">=</span> T<span class="token punctuation">.</span>SID
   <span class="token operator">AND</span> A<span class="token punctuation">.</span>SQL_HASH_VALUE <span class="token operator">=</span> V<span class="token punctuation">.</span>HASH_VALUE
   <span class="token operator">AND</span> schemaname <span class="token operator">like</span> <span class="token string">'HEADOF'</span>
 <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> A<span class="token punctuation">.</span>ELAPSED_SECONDS <span class="token keyword">DESC</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><h3 id="三、dba-scheduler-jobs"><a href="#三、dba-scheduler-jobs" class="header-anchor">#</a> 三、dba_scheduler_jobs</h3> <p>... ...</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> v$sqlarea <span class="token keyword">where</span> sql_id<span class="token operator">=</span><span class="token string">'g9yvnt209fvxx'</span><span class="token punctuation">;</span>

<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> v$<span class="token keyword">sql</span> <span class="token keyword">where</span> sql_id<span class="token operator">=</span><span class="token string">'59v4zh1ac3v2a'</span><span class="token punctuation">;</span>

<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> V$SESSION_LONGOPS <span class="token keyword">where</span> sid<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">;</span>

<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> dba_scheduler_jobs <span class="token keyword">where</span> enabled<span class="token operator">=</span><span class="token string">'TRUE'</span><span class="token punctuation">;</span>

<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> dba_autotask_client<span class="token punctuation">;</span>

<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> dba_scheduler_windows<span class="token punctuation">;</span>

<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> dba_autotask_window_clients<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/blog/oracle/" class="prev router-link-active">
        Oracle笔记
      </a></span> <!----></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/blog/assets/js/app.5c42660f.js" defer></script><script src="/blog/assets/js/2.e56be046.js" defer></script><script src="/blog/assets/js/9.97bb3cd3.js" defer></script>
  </body>
</html>
