<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>python模块 | Coding Test</title>
    <meta name="generator" content="VuePress 1.4.1">
    <link rel="icon" href="/blog/vintage.png">
    <meta name="description" content="">
    <link rel="preload" href="/blog/assets/css/0.styles.eb09ddcc.css" as="style"><link rel="preload" href="/blog/assets/js/app.d55c3362.js" as="script"><link rel="preload" href="/blog/assets/js/2.e56be046.js" as="script"><link rel="preload" href="/blog/assets/js/22.4c3e2b37.js" as="script"><link rel="prefetch" href="/blog/assets/js/10.aa5d7824.js"><link rel="prefetch" href="/blog/assets/js/11.f6969033.js"><link rel="prefetch" href="/blog/assets/js/12.34c857cf.js"><link rel="prefetch" href="/blog/assets/js/13.c23aedaa.js"><link rel="prefetch" href="/blog/assets/js/14.8a6c5077.js"><link rel="prefetch" href="/blog/assets/js/15.685a44c2.js"><link rel="prefetch" href="/blog/assets/js/16.1990c6df.js"><link rel="prefetch" href="/blog/assets/js/17.5df75dc7.js"><link rel="prefetch" href="/blog/assets/js/18.147dbfc8.js"><link rel="prefetch" href="/blog/assets/js/19.4bf42f91.js"><link rel="prefetch" href="/blog/assets/js/20.ada09f4f.js"><link rel="prefetch" href="/blog/assets/js/21.55b42ea5.js"><link rel="prefetch" href="/blog/assets/js/23.d760ca08.js"><link rel="prefetch" href="/blog/assets/js/24.c780b59d.js"><link rel="prefetch" href="/blog/assets/js/25.ddd91e89.js"><link rel="prefetch" href="/blog/assets/js/3.cd6046e6.js"><link rel="prefetch" href="/blog/assets/js/4.e35994b2.js"><link rel="prefetch" href="/blog/assets/js/5.f2810536.js"><link rel="prefetch" href="/blog/assets/js/6.6b62a0f9.js"><link rel="prefetch" href="/blog/assets/js/7.e88559c3.js"><link rel="prefetch" href="/blog/assets/js/8.acfae334.js"><link rel="prefetch" href="/blog/assets/js/9.8e37e9cb.js">
    <link rel="stylesheet" href="/blog/assets/css/0.styles.eb09ddcc.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog/" class="home-link router-link-active"><!----> <span class="site-name">Coding Test</span></a> <div class="links"><!----> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blog/" class="nav-link">
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="博文" class="dropdown-title"><span class="title">博文</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/java/" class="nav-link">
  Java
</a></li><li class="dropdown-item"><!----> <a href="/blog/cpp/" class="nav-link">
  C++
</a></li><li class="dropdown-item"><!----> <a href="/blog/python/" class="nav-link router-link-active">
  Python
</a></li><li class="dropdown-item"><!----> <a href="/blog/golang/" class="nav-link">
  GoLang
</a></li><li class="dropdown-item"><!----> <a href="/blog/swagger/" class="nav-link">
  Swagger
</a></li><li class="dropdown-item"><!----> <a href="/blog/zh/" class="nav-link">
  Vuepress
</a></li><li class="dropdown-item"><!----> <a href="/blog/linux/" class="nav-link">
  Linux
</a></li><li class="dropdown-item"><!----> <a href="/blog/oracle/" class="nav-link">
  Oracle
</a></li></ul></div></div><div class="nav-item"><a href="https://google.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  关于
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://github.com/flush2621" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/blog/" class="nav-link">
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="博文" class="dropdown-title"><span class="title">博文</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/java/" class="nav-link">
  Java
</a></li><li class="dropdown-item"><!----> <a href="/blog/cpp/" class="nav-link">
  C++
</a></li><li class="dropdown-item"><!----> <a href="/blog/python/" class="nav-link router-link-active">
  Python
</a></li><li class="dropdown-item"><!----> <a href="/blog/golang/" class="nav-link">
  GoLang
</a></li><li class="dropdown-item"><!----> <a href="/blog/swagger/" class="nav-link">
  Swagger
</a></li><li class="dropdown-item"><!----> <a href="/blog/zh/" class="nav-link">
  Vuepress
</a></li><li class="dropdown-item"><!----> <a href="/blog/linux/" class="nav-link">
  Linux
</a></li><li class="dropdown-item"><!----> <a href="/blog/oracle/" class="nav-link">
  Oracle
</a></li></ul></div></div><div class="nav-item"><a href="https://google.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  关于
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://github.com/flush2621" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/blog/python/" class="sidebar-link">Python笔记</a></li><li><a href="/blog/python/pynote.html" class="active sidebar-link">python模块</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/python/pynote.html#pyperclip剪贴板-安装和使用" class="sidebar-link">pyperclip剪贴板.安装和使用</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/python/pynote.html#一、pyperclip模块简介" class="sidebar-link">一、pyperclip模块简介</a></li><li class="sidebar-sub-header"><a href="/blog/python/pynote.html#二、pyperclip安装" class="sidebar-link">二、pyperclip安装</a></li><li class="sidebar-sub-header"><a href="/blog/python/pynote.html#三、pyperclip模块中函数使用" class="sidebar-link">三、pyperclip模块中函数使用</a></li><li class="sidebar-sub-header"><a href="/blog/python/pynote.html#四、项目举例" class="sidebar-link">四、项目举例</a></li></ul></li><li class="sidebar-sub-header"><a href="/blog/python/pynote.html#pyautogui自动化控制鼠标和键盘操作" class="sidebar-link">pyautogui自动化控制鼠标和键盘操作</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/python/pynote.html#鼠标操作样例" class="sidebar-link">鼠标操作样例</a></li><li class="sidebar-sub-header"><a href="/blog/python/pynote.html#键盘操作样例" class="sidebar-link">键盘操作样例</a></li><li class="sidebar-sub-header"><a href="/blog/python/pynote.html#按键支持" class="sidebar-link">按键支持</a></li><li class="sidebar-sub-header"><a href="/blog/python/pynote.html#提示信息" class="sidebar-link">提示信息</a></li><li class="sidebar-sub-header"><a href="/blog/python/pynote.html#截屏" class="sidebar-link">截屏</a></li></ul></li><li class="sidebar-sub-header"><a href="/blog/python/pynote.html#综合应用" class="sidebar-link">综合应用</a></li><li class="sidebar-sub-header"><a href="/blog/python/pynote.html#操作微信的应用" class="sidebar-link">操作微信的应用</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/python/pynote.html#主程序-run-py" class="sidebar-link">主程序 run.py</a></li><li class="sidebar-sub-header"><a href="/blog/python/pynote.html#数据报表excel生成readorcl-py" class="sidebar-link">数据报表excel生成readorcl.py</a></li><li class="sidebar-sub-header"><a href="/blog/python/pynote.html#excel表格区域截图convertimg-py" class="sidebar-link">Excel表格区域截图convertImg.py</a></li><li class="sidebar-sub-header"><a href="/blog/python/pynote.html#微信发图程序wechat-py" class="sidebar-link">微信发图程序wechat.py</a></li><li class="sidebar-sub-header"><a href="/blog/python/pynote.html#数据库sql存储queryinfo-py" class="sidebar-link">数据库sql存储queryInfo.py</a></li></ul></li><li class="sidebar-sub-header"><a href="/blog/python/pynote.html#网络爬虫的应用" class="sidebar-link">网络爬虫的应用</a></li><li class="sidebar-sub-header"><a href="/blog/python/pynote.html#pandas" class="sidebar-link">Pandas</a></li></ul></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="python模块"><a href="#python模块" class="header-anchor">#</a> python模块</h1> <p><em>Timestamp:2020/5/27</em></p> <h2 id="pyperclip剪贴板-安装和使用"><a href="#pyperclip剪贴板-安装和使用" class="header-anchor">#</a> pyperclip剪贴板.安装和使用</h2> <h3 id="一、pyperclip模块简介"><a href="#一、pyperclip模块简介" class="header-anchor">#</a> 一、pyperclip模块简介</h3> <p>pyperclip模块中有两个函数，分别是copy()和paste()，copy()用于向计算机的剪贴板发送文本，paste()用于从计算机剪贴板接收文本。</p> <h3 id="二、pyperclip安装"><a href="#二、pyperclip安装" class="header-anchor">#</a> 二、pyperclip安装</h3> <p>pyperclip模块不是Python自带的，需要自己安装，安装比较简单，windows下输入安装命令即可，如下：</p> <p>pip install pyperclip</p> <h3 id="三、pyperclip模块中函数使用"><a href="#三、pyperclip模块中函数使用" class="header-anchor">#</a> 三、pyperclip模块中函数使用</h3> <p>&gt;&gt;&gt;import pyperclip</p> <p>&gt;&gt;&gt;pyperclip.copy(&quot;Hello world&quot;) #此时打开剪贴板，可直接粘贴&quot;Hello world&quot;到剪贴板</p> <p>如果在剪贴板中复制了某一段字符，比如&quot;nihao&quot;，此时运行pyperclip.paste()就会返回&quot;nihao&quot;</p> <h3 id="四、项目举例"><a href="#四、项目举例" class="header-anchor">#</a> 四、项目举例</h3> <p><em><strong>（摘自python编程快速上手-让繁琐工作自动化）</strong></em></p> <p>1、口令保管箱</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code>PASSWORDS <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">&quot;email&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;euyr8wuey89r3geidw&quot;</span><span class="token punctuation">,</span>

<span class="token string">&quot;blog&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;wqeiy2398eghduk&quot;</span><span class="token punctuation">,</span>

<span class="token string">&quot;computer&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;ewkwo][ke;w&quot;</span><span class="token punctuation">}</span>

<span class="token keyword">import</span> sys<span class="token punctuation">,</span> pyperclip

<span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>sys<span class="token punctuation">.</span>argv <span class="token operator">&lt;</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">:</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;Please input the account name&quot;</span><span class="token punctuation">)</span>

sys<span class="token punctuation">.</span>exit<span class="token punctuation">(</span><span class="token punctuation">)</span>

account <span class="token operator">=</span> sys<span class="token punctuation">.</span>argv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>

<span class="token keyword">if</span> account <span class="token keyword">in</span> PASSWORDS<span class="token punctuation">:</span>

pyperclip<span class="token punctuation">.</span>copy<span class="token punctuation">(</span>PASSWORDS<span class="token punctuation">[</span>account<span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;The password for &quot;</span> <span class="token operator">+</span> account <span class="token operator">+</span> <span class="token string">&quot; copied to clipboard!&quot;</span><span class="token punctuation">)</span>

<span class="token keyword">else</span><span class="token punctuation">:</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;There is no account named &quot;</span> <span class="token operator">+</span> account <span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><p>2、在标记中添加无序列表</p> <p>从剪贴板复制一段文本，在文本每一行开头加上“*”，再粘贴回剪贴板</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">import</span> pyperclip

text <span class="token operator">=</span> pyperclip<span class="token punctuation">.</span>paste<span class="token punctuation">(</span><span class="token punctuation">)</span>

lines <span class="token operator">=</span> text<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">&quot;\n&quot;</span><span class="token punctuation">)</span>

<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>lines<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>

lines<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;*&quot;</span> <span class="token operator">+</span> lines<span class="token punctuation">[</span>i<span class="token punctuation">]</span>

text <span class="token operator">=</span> <span class="token string">&quot;\n&quot;</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>lines<span class="token punctuation">)</span>

pyperclip<span class="token punctuation">.</span>copy<span class="token punctuation">(</span>text<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h2 id="pyautogui自动化控制鼠标和键盘操作"><a href="#pyautogui自动化控制鼠标和键盘操作" class="header-anchor">#</a> pyautogui自动化控制鼠标和键盘操作</h2> <p>PyAutoGUI是一个纯Python的GUI自动化工具，其目的是可以用程序自动控制鼠标和键盘操作，多平台支持（Windows，OS X，Linux）。</p> <h3 id="鼠标操作样例"><a href="#鼠标操作样例" class="header-anchor">#</a> 鼠标操作样例</h3> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">import</span> pyautogui

<span class="token comment"># 获取当前屏幕分辨率</span>
screenWidth<span class="token punctuation">,</span> screenHeight <span class="token operator">=</span> pyautogui<span class="token punctuation">.</span>size<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># 获取当前鼠标位置</span>
currentMouseX<span class="token punctuation">,</span> currentMouseY <span class="token operator">=</span> pyautogui<span class="token punctuation">.</span>position<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># 2秒钟鼠标移动坐标为100,100位置  绝对移动</span>
<span class="token comment">#pyautogui.moveTo(100, 100,2)</span>
pyautogui<span class="token punctuation">.</span>moveTo<span class="token punctuation">(</span>x<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">,</span> y<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">,</span>duration<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> tween<span class="token operator">=</span>pyautogui<span class="token punctuation">.</span>linear<span class="token punctuation">)</span>

<span class="token comment">#鼠标移到屏幕中央。</span>
pyautogui<span class="token punctuation">.</span>moveTo<span class="token punctuation">(</span>screenWidth <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> screenHeight <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span>

<span class="token comment"># 鼠标左击一次</span>
<span class="token comment">#pyautogui.click()</span>
<span class="token comment"># x </span>
<span class="token comment"># y </span>
<span class="token comment"># clicks 点击次数</span>
<span class="token comment"># interval点击之间的间隔</span>
<span class="token comment"># button 'left', 'middle', 'right' 对应鼠标 左 中 右或者取值(1, 2, or 3)</span>
<span class="token comment"># tween 渐变函数</span>
<span class="token comment">#</span>
pyautogui<span class="token punctuation">.</span>click<span class="token punctuation">(</span>x<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> y<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> clicks<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> interval<span class="token operator">=</span><span class="token number">0.0</span><span class="token punctuation">,</span> button<span class="token operator">=</span><span class="token string">'left'</span><span class="token punctuation">,</span> duration<span class="token operator">=</span><span class="token number">0.0</span><span class="token punctuation">,</span> tween<span class="token operator">=</span>pyautogui<span class="token punctuation">.</span>linear<span class="token punctuation">)</span>

<span class="token comment"># 鼠标相对移动 ,向下移动</span>
<span class="token comment">#pyautogui.moveRel(None, 10)</span>
pyautogui<span class="token punctuation">.</span>moveRel<span class="token punctuation">(</span>xOffset<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> yOffset<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">,</span>duration<span class="token operator">=</span><span class="token number">0.0</span><span class="token punctuation">,</span> tween<span class="token operator">=</span>pyautogui<span class="token punctuation">.</span>linear<span class="token punctuation">)</span>


<span class="token comment"># 鼠标当前位置0间隔双击</span>
<span class="token comment">#pyautogui.doubleClick()</span>
pyautogui<span class="token punctuation">.</span>doubleClick<span class="token punctuation">(</span>x<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> y<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> interval<span class="token operator">=</span><span class="token number">0.0</span><span class="token punctuation">,</span> button<span class="token operator">=</span><span class="token string">'left'</span><span class="token punctuation">,</span> duration<span class="token operator">=</span><span class="token number">0.0</span><span class="token punctuation">,</span> tween<span class="token operator">=</span>pyautogui<span class="token punctuation">.</span>linear<span class="token punctuation">)</span>

<span class="token comment"># 鼠标当前位置3击</span>
<span class="token comment">#pyautogui.tripleClick()</span>
pyautogui<span class="token punctuation">.</span>tripleClick<span class="token punctuation">(</span>x<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> y<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> interval<span class="token operator">=</span><span class="token number">0.0</span><span class="token punctuation">,</span> button<span class="token operator">=</span><span class="token string">'left'</span><span class="token punctuation">,</span> duration<span class="token operator">=</span><span class="token number">0.0</span><span class="token punctuation">,</span> tween<span class="token operator">=</span>pyautogui<span class="token punctuation">.</span>linear<span class="token punctuation">)</span>

<span class="token comment">#右击</span>
pyautogui<span class="token punctuation">.</span>rightClick<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">#中击</span>
pyautogui<span class="token punctuation">.</span>middleClick<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">#  用缓动/渐变函数让鼠标2秒后移动到(500,500)位置</span>
<span class="token comment">#  use tweening/easing function to move mouse over 2 seconds.</span>
pyautogui<span class="token punctuation">.</span>moveTo<span class="token punctuation">(</span>x<span class="token operator">=</span><span class="token number">500</span><span class="token punctuation">,</span> y<span class="token operator">=</span><span class="token number">500</span><span class="token punctuation">,</span> duration<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> tween<span class="token operator">=</span>pyautogui<span class="token punctuation">.</span>easeInOutQuad<span class="token punctuation">)</span>

<span class="token comment">#鼠标拖拽</span>
pyautogui<span class="token punctuation">.</span>dragTo<span class="token punctuation">(</span>x<span class="token operator">=</span><span class="token number">427</span><span class="token punctuation">,</span> y<span class="token operator">=</span><span class="token number">535</span><span class="token punctuation">,</span> duration<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">,</span>button<span class="token operator">=</span><span class="token string">'left'</span><span class="token punctuation">)</span>

<span class="token comment">#鼠标相对拖拽</span>
pyautogui<span class="token punctuation">.</span>dragRel<span class="token punctuation">(</span>xOffset<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">,</span>yOffset<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">,</span>duration<span class="token operator">=</span><span class="token punctuation">,</span>button<span class="token operator">=</span><span class="token string">'left'</span><span class="token punctuation">,</span>mouseDownUp<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>

<span class="token comment">#鼠标移动到x=1796, y=778位置按下</span>
pyautogui<span class="token punctuation">.</span>mouseDown<span class="token punctuation">(</span>x<span class="token operator">=</span><span class="token number">1796</span><span class="token punctuation">,</span> y<span class="token operator">=</span><span class="token number">778</span><span class="token punctuation">,</span> button<span class="token operator">=</span><span class="token string">'left'</span><span class="token punctuation">)</span>

<span class="token comment">#鼠标移动到x=2745, y=778位置松开（与mouseDown组合使用选中）</span>
pyautogui<span class="token punctuation">.</span>mouseUp<span class="token punctuation">(</span>x<span class="token operator">=</span><span class="token number">2745</span><span class="token punctuation">,</span> y<span class="token operator">=</span><span class="token number">778</span><span class="token punctuation">,</span> button<span class="token operator">=</span><span class="token string">'left'</span><span class="token punctuation">,</span>duration<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span>

<span class="token comment">#鼠标当前位置滚轮滚动</span>
pyautogui<span class="token punctuation">.</span>scroll<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">#鼠标水平滚动（Linux）</span>
pyautogui<span class="token punctuation">.</span>hscroll<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">#鼠标左右滚动（Linux）</span>
pyautogui<span class="token punctuation">.</span>vscroll<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br></div></div><h3 id="键盘操作样例"><a href="#键盘操作样例" class="header-anchor">#</a> 键盘操作样例</h3> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment">#模拟输入信息</span>
pyautogui<span class="token punctuation">.</span>typewrite<span class="token punctuation">(</span>message<span class="token operator">=</span><span class="token string">'Hello world!'</span><span class="token punctuation">,</span>interval<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">)</span>
<span class="token comment">#点击ESC</span>
pyautogui<span class="token punctuation">.</span>press<span class="token punctuation">(</span><span class="token string">'esc'</span><span class="token punctuation">)</span>
<span class="token comment"># 按住shift键</span>
pyautogui<span class="token punctuation">.</span>keyDown<span class="token punctuation">(</span><span class="token string">'shift'</span><span class="token punctuation">)</span>
<span class="token comment"># 放开shift键</span>
pyautogui<span class="token punctuation">.</span>keyUp<span class="token punctuation">(</span><span class="token string">'shift'</span><span class="token punctuation">)</span>
<span class="token comment"># 模拟组合热键</span>
pyautogui<span class="token punctuation">.</span>hotkey<span class="token punctuation">(</span><span class="token string">'ctrl'</span><span class="token punctuation">,</span> <span class="token string">'c'</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h3 id="按键支持"><a href="#按键支持" class="header-anchor">#</a> 按键支持</h3> <table><thead><tr><th>按键</th> <th>说明</th></tr></thead> <tbody><tr><td><code>enter</code>(或<code>return</code> 或 <code>\n</code>)</td> <td>回车</td></tr> <tr><td><code>esc</code></td> <td>ESC键</td></tr> <tr><td><code>shiftleft</code>, <code>shiftright</code></td> <td>左右SHIFT键</td></tr> <tr><td><code>altleft</code>, <code>altright</code></td> <td>左右ALT键</td></tr> <tr><td><code>ctrlleft</code>, <code>ctrlright</code></td> <td>左右CTRL键</td></tr> <tr><td><code>tab</code> (<code>\t</code>)</td> <td>TAB键</td></tr> <tr><td><code>backspace</code>, <code>delete</code></td> <td>BACKSPACE 、DELETE键</td></tr> <tr><td><code>pageup</code>, <code>pagedown</code></td> <td>PAGE UP 和 PAGE DOWN键</td></tr> <tr><td><code>home</code>, <code>end</code></td> <td>HOME 和 END键</td></tr> <tr><td><code>up</code>, <code>down</code>, <code>left</code>,<code>right</code></td> <td>箭头键</td></tr> <tr><td><code>f1</code>, <code>f2</code>, <code>f3</code>….</td> <td>F1…….F12键</td></tr> <tr><td><code>volumemute</code>, <code>volumedown</code>,<code>volumeup</code></td> <td>有些键盘没有</td></tr> <tr><td><code>pause</code></td> <td>PAUSE键</td></tr> <tr><td><code>capslock</code>, <code>numlock</code>,<code>scrolllock</code></td> <td>CAPS LOCK, NUM LOCK, 和 SCROLLLOCK 键</td></tr> <tr><td><code>insert</code></td> <td>INS或INSERT键</td></tr> <tr><td><code>printscreen</code></td> <td>PRTSC 或 PRINT SCREEN键</td></tr> <tr><td><code>winleft</code>, <code>winright</code></td> <td>Win键</td></tr> <tr><td><code>command</code></td> <td>Mac OS X command键</td></tr></tbody></table> <h3 id="提示信息"><a href="#提示信息" class="header-anchor">#</a> 提示信息</h3> <p><em><strong>alert</strong></em></p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment">#pyautogui.alert('This is an alert box.','Test')</span>
pyautogui<span class="token punctuation">.</span>alert<span class="token punctuation">(</span>text<span class="token operator">=</span><span class="token string">'This is an alert box.'</span><span class="token punctuation">,</span> title<span class="token operator">=</span><span class="token string">'Test'</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><em><strong>option</strong></em></p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment">#pyautogui.confirm('Shall I proceed?')</span>
pyautogui<span class="token punctuation">.</span>confirm<span class="token punctuation">(</span><span class="token string">'Enter option.'</span><span class="token punctuation">,</span> buttons<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'A'</span><span class="token punctuation">,</span> <span class="token string">'B'</span><span class="token punctuation">,</span> <span class="token string">'C'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><em><strong>password</strong></em></p> <div class="language-python line-numbers-mode"><pre class="language-python"><code>a <span class="token operator">=</span> pyautogui<span class="token punctuation">.</span>password<span class="token punctuation">(</span><span class="token string">'Enter password (text will be hidden)'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><em><strong>prompt</strong></em></p> <div class="language-python line-numbers-mode"><pre class="language-python"><code>a <span class="token operator">=</span> pyautogui<span class="token punctuation">.</span>prompt<span class="token punctuation">(</span><span class="token string">'input  message'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="截屏"><a href="#截屏" class="header-anchor">#</a> 截屏</h3> <p><em><strong>整个屏幕截图并保存</strong></em></p> <div class="language-python line-numbers-mode"><pre class="language-python"><code>im1 <span class="token operator">=</span> pyautogui<span class="token punctuation">.</span>screenshot<span class="token punctuation">(</span><span class="token punctuation">)</span>
im1<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token string">'my_screenshot.png'</span><span class="token punctuation">)</span>

im2 <span class="token operator">=</span> pyautogui<span class="token punctuation">.</span>screenshot<span class="token punctuation">(</span><span class="token string">'my_screenshot2.png'</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><em><strong>屏幕查找图片位置并获取中间点</strong></em></p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment">#在当前屏幕中查找指定图片(图片需要由系统截图功能截取的图)</span>
coords <span class="token operator">=</span> pyautogui<span class="token punctuation">.</span>locateOnScreen<span class="token punctuation">(</span><span class="token string">'folder.png'</span><span class="token punctuation">)</span>
<span class="token comment">#获取定位到的图中间点坐标</span>
x<span class="token punctuation">,</span>y<span class="token operator">=</span>pyautogui<span class="token punctuation">.</span>center<span class="token punctuation">(</span>coords<span class="token punctuation">)</span>
<span class="token comment">#右击该坐标点</span>
pyautogui<span class="token punctuation">.</span>rightClick<span class="token punctuation">(</span>x<span class="token punctuation">,</span>y<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p><em><strong>安全设置</strong></em></p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">import</span> pyautogui

<span class="token comment">#保护措施，避免失控</span>
pyautogui<span class="token punctuation">.</span>FAILSAFE <span class="token operator">=</span> <span class="token boolean">True</span>
<span class="token comment">#为所有的PyAutoGUI函数增加延迟。默认延迟时间是0.1秒。</span>
pyautogui<span class="token punctuation">.</span>PAUSE <span class="token operator">=</span> <span class="token number">0.5</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h2 id="综合应用"><a href="#综合应用" class="header-anchor">#</a> 综合应用</h2> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>用来搜索的图片需要使用ALT+PrintScreen来截图处理，否则有极大可能使用pyautogui.locateOnScreen函数时无法辨识</p></div> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">import</span> time
<span class="token keyword">import</span> pyautogui
<span class="token keyword">import</span> pyperclip
<span class="token keyword">import</span> os
<span class="token keyword">import</span> random


<span class="token keyword">def</span> <span class="token function">mapping_img</span><span class="token punctuation">(</span>img<span class="token punctuation">,</span>click<span class="token punctuation">)</span><span class="token punctuation">:</span>
  box_location <span class="token operator">=</span> pyautogui<span class="token punctuation">.</span>locateOnScreen<span class="token punctuation">(</span>img<span class="token punctuation">)</span>
  <span class="token keyword">print</span><span class="token punctuation">(</span>box_location<span class="token punctuation">)</span>
  center <span class="token operator">=</span> pyautogui<span class="token punctuation">.</span>center<span class="token punctuation">(</span>box_location<span class="token punctuation">)</span>
  <span class="token keyword">if</span> click <span class="token operator">==</span> <span class="token string">'double'</span><span class="token punctuation">:</span>
    pyautogui<span class="token punctuation">.</span>doubleClick<span class="token punctuation">(</span>center<span class="token punctuation">)</span>
  <span class="token keyword">else</span><span class="token punctuation">:</span>
    pyautogui<span class="token punctuation">.</span>leftClick<span class="token punctuation">(</span>center<span class="token punctuation">)</span>
  time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">chat_user</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">:</span>
  <span class="token keyword">if</span> user <span class="token operator">!=</span> <span class="token string">''</span><span class="token punctuation">:</span>
    mapping_img<span class="token punctuation">(</span><span class="token string">'search.png'</span><span class="token punctuation">,</span><span class="token string">'single'</span><span class="token punctuation">)</span>
    pyautogui<span class="token punctuation">.</span>typewrite<span class="token punctuation">(</span>user<span class="token punctuation">)</span>
    time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    pyautogui<span class="token punctuation">.</span>moveRel<span class="token punctuation">(</span>xOffset<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span>yOffset<span class="token operator">=</span><span class="token number">80</span><span class="token punctuation">)</span>
    pyautogui<span class="token punctuation">.</span>click<span class="token punctuation">(</span><span class="token punctuation">)</span>
    time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
  <span class="token keyword">else</span><span class="token punctuation">:</span>
    mapping_img<span class="token punctuation">(</span><span class="token string">'myself.png'</span><span class="token punctuation">,</span><span class="token string">'single'</span><span class="token punctuation">)</span>
    mapping_img<span class="token punctuation">(</span><span class="token string">'chat.png'</span><span class="token punctuation">,</span><span class="token string">'single'</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">read_txt</span><span class="token punctuation">(</span>txt<span class="token punctuation">)</span><span class="token punctuation">:</span>
  hellofile <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span>txt<span class="token punctuation">,</span><span class="token string">&quot;r&quot;</span><span class="token punctuation">,</span>encoding<span class="token operator">=</span><span class="token string">&quot;UTF-8&quot;</span><span class="token punctuation">)</span>
  hellocontent <span class="token operator">=</span> hellofile<span class="token punctuation">.</span>readlines<span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>hellocontent<span class="token punctuation">)</span><span class="token punctuation">)</span>
  number <span class="token operator">=</span> random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token builtin">len</span><span class="token punctuation">(</span>hellocontent<span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
  <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'line number is {}'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>number<span class="token punctuation">)</span><span class="token punctuation">)</span>
  pyperclip<span class="token punctuation">.</span>copy<span class="token punctuation">(</span>hellocontent<span class="token punctuation">[</span>number<span class="token punctuation">]</span><span class="token punctuation">)</span>
  pyautogui<span class="token punctuation">.</span>hotkey<span class="token punctuation">(</span><span class="token string">'ctrl'</span><span class="token punctuation">,</span><span class="token string">'v'</span><span class="token punctuation">)</span>
  hellofile<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">read_img</span><span class="token punctuation">(</span>img_name<span class="token punctuation">)</span><span class="token punctuation">:</span>
  mapping_img<span class="token punctuation">(</span><span class="token string">'pic.png'</span><span class="token punctuation">,</span><span class="token string">'single'</span><span class="token punctuation">)</span>
  img_path <span class="token operator">=</span> <span class="token string">u'C:\\pythonsource\\analysis\\wechat\\'</span> <span class="token operator">+</span> img_name
  pyautogui<span class="token punctuation">.</span>typewrite<span class="token punctuation">(</span>img_path<span class="token punctuation">)</span>
  pyautogui<span class="token punctuation">.</span>press<span class="token punctuation">(</span><span class="token string">'enter'</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
  os<span class="token punctuation">.</span>chdir<span class="token punctuation">(</span><span class="token string">u&quot;C:/pythonsource/analysis/wechat&quot;</span><span class="token punctuation">)</span>
  time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
  <span class="token keyword">print</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>getcwd<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token comment">#TODO Login Wechat</span>
  mapping_img<span class="token punctuation">(</span><span class="token string">'login.png'</span><span class="token punctuation">,</span><span class="token string">'double'</span><span class="token punctuation">)</span>
  <span class="token comment">#TODO search chat user</span>
  chat_user<span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span>
  <span class="token comment">#TODO start chatting</span>
  read_txt<span class="token punctuation">(</span><span class="token string">'hello.txt'</span><span class="token punctuation">)</span>
  pyautogui<span class="token punctuation">.</span>press<span class="token punctuation">(</span><span class="token string">'enter'</span><span class="token punctuation">)</span>
  time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
  read_txt<span class="token punctuation">(</span><span class="token string">'yulu.txt'</span><span class="token punctuation">)</span>
  pyautogui<span class="token punctuation">.</span>press<span class="token punctuation">(</span><span class="token string">'enter'</span><span class="token punctuation">)</span>
  time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
  read_img<span class="token punctuation">(</span><span class="token string">'duesales.xlsx'</span><span class="token punctuation">)</span>
  pyautogui<span class="token punctuation">.</span>press<span class="token punctuation">(</span><span class="token string">'enter'</span><span class="token punctuation">)</span>
  time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
  main<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br></div></div><h2 id="操作微信的应用"><a href="#操作微信的应用" class="header-anchor">#</a> 操作微信的应用</h2> <h3 id="主程序-run-py"><a href="#主程序-run-py" class="header-anchor">#</a> 主程序 run.py</h3> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">from</span> wechat <span class="token keyword">import</span> readorcl
<span class="token keyword">from</span> wechat <span class="token keyword">import</span> queryInfo
<span class="token keyword">from</span> wechat <span class="token keyword">import</span> convertImg
<span class="token keyword">from</span> wechat <span class="token keyword">import</span> wechat
<span class="token keyword">import</span> os<span class="token punctuation">,</span>glob
<span class="token keyword">import</span> time
<span class="token keyword">def</span> <span class="token function">scandirs</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> currentFile <span class="token keyword">in</span> glob<span class="token punctuation">.</span>glob<span class="token punctuation">(</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>path<span class="token punctuation">,</span> <span class="token string">'*'</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># if os.path.isdir(currentFile):</span>
        <span class="token comment">#     print ('got a directory: ' + currentFile)</span>
        <span class="token comment">#     scandirs(currentFile)</span>
        <span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">'processing file: '</span> <span class="token operator">+</span> currentFile<span class="token punctuation">)</span>
        <span class="token keyword">if</span> currentFile<span class="token punctuation">.</span>endswith<span class="token punctuation">(</span><span class="token string">'png'</span><span class="token punctuation">)</span> <span class="token keyword">or</span> currentFile<span class="token punctuation">.</span>endswith<span class="token punctuation">(</span><span class="token string">'xls'</span><span class="token punctuation">)</span> <span class="token keyword">or</span> currentFile<span class="token punctuation">.</span>endswith<span class="token punctuation">(</span><span class="token string">'xlsx'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            os<span class="token punctuation">.</span>remove<span class="token punctuation">(</span>currentFile<span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    currentPath <span class="token operator">=</span> <span class="token string">&quot;C:\\pythonsource\\analysis\\&quot;</span>
    scandirs<span class="token punctuation">(</span>currentPath<span class="token punctuation">)</span>
    time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
    infoList <span class="token operator">=</span> queryInfo<span class="token punctuation">.</span>getParam<span class="token punctuation">(</span><span class="token punctuation">)</span>
    cellIndx <span class="token operator">=</span> readorcl<span class="token punctuation">.</span>main<span class="token punctuation">(</span>infoList<span class="token punctuation">)</span>
    time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
    filedirs <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">''</span><span class="token punctuation">]</span><span class="token operator">*</span><span class="token builtin">len</span><span class="token punctuation">(</span>infoList<span class="token punctuation">)</span>
    i <span class="token operator">=</span> <span class="token number">0</span>
    flag <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">while</span><span class="token punctuation">(</span>flag <span class="token operator">&lt;</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            <span class="token keyword">for</span> info <span class="token keyword">in</span> infoList<span class="token punctuation">:</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span>cellIndx<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>
                convertImg<span class="token punctuation">.</span>excel_catch_screen<span class="token punctuation">(</span>currentPath <span class="token operator">+</span> info<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> currentPath <span class="token operator">+</span> info<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span> cellIndx<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>
                time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
                filedirs<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> currentPath <span class="token operator">+</span> info<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span>
                i <span class="token operator">=</span> i <span class="token operator">+</span> <span class="token number">1</span>
            flag <span class="token operator">=</span> <span class="token number">3</span>
        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
            flag <span class="token operator">+=</span> <span class="token number">1</span>
            time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
            i <span class="token operator">=</span> <span class="token number">0</span>
    flag <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">while</span><span class="token punctuation">(</span>flag <span class="token operator">&lt;</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            wechat<span class="token punctuation">.</span>sendInfor<span class="token punctuation">(</span><span class="token string">'nanjingdi'</span><span class="token punctuation">,</span> currentPath<span class="token operator">+</span><span class="token string">'wechat\\'</span><span class="token punctuation">,</span> filedirs<span class="token punctuation">)</span>
            flag <span class="token operator">=</span> <span class="token number">3</span>
        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
            flag <span class="token operator">+=</span> <span class="token number">1</span>
            time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    os<span class="token punctuation">.</span>system<span class="token punctuation">(</span><span class="token string">'TASKKILL /F /IM excel.exe'</span><span class="token punctuation">)</span>
    time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
    start<span class="token punctuation">(</span><span class="token punctuation">)</span>
    time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
    os<span class="token punctuation">.</span>system<span class="token punctuation">(</span><span class="token string">'TASKKILL /F /IM excel.exe'</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br></div></div><h3 id="数据报表excel生成readorcl-py"><a href="#数据报表excel生成readorcl-py" class="header-anchor">#</a> 数据报表excel生成readorcl.py</h3> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">import</span> os
<span class="token keyword">import</span> cx_Oracle
<span class="token keyword">import</span> xlwt
<span class="token keyword">import</span> datetime
<span class="token keyword">import</span> re
<span class="token keyword">import</span> time

endIdx <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">*</span><span class="token number">100</span>
stylex <span class="token operator">=</span> xlwt<span class="token punctuation">.</span>XFStyle

<span class="token keyword">def</span> <span class="token function">WriteSheetRow</span><span class="token punctuation">(</span>sheet<span class="token punctuation">,</span>rowValueList<span class="token punctuation">,</span>rowIndex<span class="token punctuation">,</span>start_column<span class="token punctuation">,</span> cwidth<span class="token punctuation">,</span> isBold<span class="token punctuation">)</span><span class="token punctuation">:</span>
  i <span class="token operator">=</span> start_column
  font <span class="token operator">=</span> xlwt<span class="token punctuation">.</span>Font<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">#设计字体</span>
  font<span class="token punctuation">.</span>height <span class="token operator">=</span> <span class="token number">200</span>

  pattern <span class="token operator">=</span> xlwt<span class="token punctuation">.</span>Pattern<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">#设计背景</span>

  borders <span class="token operator">=</span> xlwt<span class="token punctuation">.</span>Borders<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">#设计边框</span>
  borders<span class="token punctuation">.</span>top <span class="token operator">=</span> xlwt<span class="token punctuation">.</span>Borders<span class="token punctuation">.</span>THIN
  borders<span class="token punctuation">.</span>bottom <span class="token operator">=</span> xlwt<span class="token punctuation">.</span>Borders<span class="token punctuation">.</span>THIN
  borders<span class="token punctuation">.</span>left <span class="token operator">=</span> xlwt<span class="token punctuation">.</span>Borders<span class="token punctuation">.</span>THIN
  borders<span class="token punctuation">.</span>right <span class="token operator">=</span> xlwt<span class="token punctuation">.</span>Borders<span class="token punctuation">.</span>THIN

  borders<span class="token punctuation">.</span>top_colour <span class="token operator">=</span> <span class="token number">0x00</span>
  borders<span class="token punctuation">.</span>bottom_colour <span class="token operator">=</span> <span class="token number">0x00</span>
  borders<span class="token punctuation">.</span>left_colour <span class="token operator">=</span> <span class="token number">0x00</span>
  borders<span class="token punctuation">.</span>right_colour <span class="token operator">=</span> <span class="token number">0x00</span>

  zhPattern <span class="token operator">=</span> re<span class="token punctuation">.</span><span class="token builtin">compile</span><span class="token punctuation">(</span><span class="token string">u'[\u4e00-\u9fa5]'</span><span class="token punctuation">)</span>
  subtotalPattern <span class="token operator">=</span> re<span class="token punctuation">.</span><span class="token builtin">compile</span><span class="token punctuation">(</span><span class="token string">r'小计'</span><span class="token punctuation">)</span>
  totalPattern <span class="token operator">=</span> re<span class="token punctuation">.</span><span class="token builtin">compile</span><span class="token punctuation">(</span><span class="token string">r'总计'</span><span class="token punctuation">)</span>
  style <span class="token operator">=</span> xlwt<span class="token punctuation">.</span>XFStyle<span class="token punctuation">(</span><span class="token punctuation">)</span>
  turnOn <span class="token operator">=</span> <span class="token number">0</span>
  <span class="token keyword">for</span> svalue <span class="token keyword">in</span> rowValueList<span class="token punctuation">:</span>
    param <span class="token operator">=</span> <span class="token builtin">str</span><span class="token punctuation">(</span>svalue<span class="token punctuation">)</span>
    match <span class="token operator">=</span> zhPattern<span class="token punctuation">.</span>search<span class="token punctuation">(</span>param<span class="token punctuation">)</span>
    matchSubtotal <span class="token operator">=</span> subtotalPattern<span class="token punctuation">.</span>search<span class="token punctuation">(</span>param<span class="token punctuation">)</span>
    matchTotal <span class="token operator">=</span> totalPattern<span class="token punctuation">.</span>search<span class="token punctuation">(</span>param<span class="token punctuation">)</span>

    lens <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>param<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">300</span>
    <span class="token keyword">if</span> turnOn <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
      pattern<span class="token punctuation">.</span>pattern <span class="token operator">=</span> <span class="token number">1</span>
      pattern<span class="token punctuation">.</span>pattern_fore_colour <span class="token operator">=</span> <span class="token number">26</span>
      turnOn <span class="token operator">=</span> turnOn <span class="token operator">+</span> <span class="token number">1</span>
    <span class="token keyword">if</span> matchSubtotal<span class="token punctuation">:</span>
      turnOn <span class="token operator">=</span> turnOn <span class="token operator">+</span> <span class="token number">1</span>
      <span class="token keyword">print</span><span class="token punctuation">(</span>matchSubtotal<span class="token punctuation">)</span>
      pattern<span class="token punctuation">.</span>pattern <span class="token operator">=</span> xlwt<span class="token punctuation">.</span>Pattern<span class="token punctuation">.</span>SOLID_PATTERN
      pattern<span class="token punctuation">.</span>pattern_fore_colour <span class="token operator">=</span> <span class="token number">27</span>
    <span class="token keyword">if</span> matchTotal<span class="token punctuation">:</span>
      turnOn <span class="token operator">=</span> turnOn <span class="token operator">+</span> <span class="token number">1</span>
      <span class="token keyword">print</span><span class="token punctuation">(</span>matchTotal<span class="token punctuation">)</span>
      pattern<span class="token punctuation">.</span>pattern <span class="token operator">=</span> xlwt<span class="token punctuation">.</span>Pattern<span class="token punctuation">.</span>SOLID_PATTERN
      pattern<span class="token punctuation">.</span>pattern_fore_colour <span class="token operator">=</span> xlwt<span class="token punctuation">.</span>Style<span class="token punctuation">.</span>colour_map<span class="token punctuation">[</span><span class="token string">'pale_blue'</span><span class="token punctuation">]</span> <span class="token comment">#periwinkle  sea_green pale_blue</span>
    <span class="token keyword">if</span> match<span class="token punctuation">:</span>
      lens <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>param<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">300</span> <span class="token operator">*</span> <span class="token number">2</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>param<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">'-'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        font <span class="token operator">=</span> xlwt<span class="token punctuation">.</span>Font<span class="token punctuation">(</span><span class="token punctuation">)</span>
        font<span class="token punctuation">.</span>colour_index <span class="token operator">=</span> <span class="token number">10</span>
        style<span class="token punctuation">.</span>font <span class="token operator">=</span> font
      <span class="token keyword">else</span><span class="token punctuation">:</span>
        font <span class="token operator">=</span> xlwt<span class="token punctuation">.</span>Font<span class="token punctuation">(</span><span class="token punctuation">)</span>
        font<span class="token punctuation">.</span>colour_index <span class="token operator">=</span> <span class="token number">0</span>
        style<span class="token punctuation">.</span>font <span class="token operator">=</span> font

    cwidth<span class="token punctuation">[</span>i<span class="token operator">-</span>start_column<span class="token punctuation">]</span> <span class="token operator">=</span> lens <span class="token keyword">if</span> lens <span class="token operator">&gt;</span> cwidth<span class="token punctuation">[</span>i<span class="token operator">-</span>start_column<span class="token punctuation">]</span> <span class="token keyword">else</span> cwidth<span class="token punctuation">[</span>i<span class="token operator">-</span>start_column<span class="token punctuation">]</span>
    <span class="token keyword">if</span> isBold<span class="token punctuation">:</span>
      font<span class="token punctuation">.</span>bold <span class="token operator">=</span> <span class="token boolean">True</span>
      font<span class="token punctuation">.</span>italic <span class="token operator">=</span> <span class="token boolean">True</span>
      pattern<span class="token punctuation">.</span>pattern <span class="token operator">=</span> xlwt<span class="token punctuation">.</span>Pattern<span class="token punctuation">.</span>SOLID_PATTERN
      pattern<span class="token punctuation">.</span>pattern_fore_colour <span class="token operator">=</span> xlwt<span class="token punctuation">.</span>Style<span class="token punctuation">.</span>colour_map<span class="token punctuation">[</span><span class="token string">'silver_ega'</span><span class="token punctuation">]</span>  <span class="token comment"># 5</span>
      style<span class="token punctuation">.</span>pattern <span class="token operator">=</span> pattern
      style<span class="token punctuation">.</span>borders <span class="token operator">=</span> borders
      style<span class="token punctuation">.</span>font <span class="token operator">=</span> font
      al <span class="token operator">=</span> xlwt<span class="token punctuation">.</span>Alignment<span class="token punctuation">(</span><span class="token punctuation">)</span>
      al<span class="token punctuation">.</span>horz <span class="token operator">=</span> <span class="token number">0x02</span>  <span class="token comment"># 设置水平居中</span>
      al<span class="token punctuation">.</span>vert <span class="token operator">=</span> <span class="token number">0x01</span>  <span class="token comment"># 设置垂直居中</span>
      style<span class="token punctuation">.</span>alignment <span class="token operator">=</span> al
      <span class="token keyword">global</span> stylex
      stylex <span class="token operator">=</span> style
      sheet<span class="token punctuation">.</span>write<span class="token punctuation">(</span>rowIndex<span class="token punctuation">,</span> i<span class="token punctuation">,</span> svalue<span class="token punctuation">,</span> style<span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
      style<span class="token punctuation">.</span>pattern <span class="token operator">=</span> pattern
      style<span class="token punctuation">.</span>borders <span class="token operator">=</span> borders
      sheet<span class="token punctuation">.</span>write<span class="token punctuation">(</span>rowIndex<span class="token punctuation">,</span>i<span class="token punctuation">,</span>svalue<span class="token punctuation">,</span> style<span class="token punctuation">)</span>
    i <span class="token operator">=</span> i <span class="token operator">+</span> <span class="token number">1</span>
  <span class="token keyword">return</span> cwidth

<span class="token keyword">def</span> <span class="token function">getData</span><span class="token punctuation">(</span>wbk<span class="token punctuation">,</span> sqlstr<span class="token punctuation">,</span> sheetname<span class="token punctuation">,</span> idx<span class="token punctuation">)</span><span class="token punctuation">:</span>
  <span class="token comment">#时间戳</span>
  timestamp <span class="token operator">=</span> <span class="token string">'时间戳:'</span><span class="token operator">+</span>datetime<span class="token punctuation">.</span>datetime<span class="token punctuation">.</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>strftime<span class="token punctuation">(</span><span class="token string">'%Y-%m-%d %H:%M'</span><span class="token punctuation">)</span>
  <span class="token keyword">print</span><span class="token punctuation">(</span>timestamp<span class="token punctuation">)</span>

  <span class="token comment">#创建Sheet</span>
  sheet <span class="token operator">=</span> wbk<span class="token punctuation">.</span>add_sheet<span class="token punctuation">(</span>sheetname<span class="token punctuation">,</span> cell_overwrite_ok<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
  start_line <span class="token operator">=</span> <span class="token number">3</span> <span class="token comment">#起始行</span>
  start_column <span class="token operator">=</span> <span class="token number">1</span> <span class="token comment">#起始列</span>
  rowIndex <span class="token operator">=</span> start_line
  sheet<span class="token punctuation">.</span>write<span class="token punctuation">(</span>rowIndex<span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">,</span> start_column<span class="token punctuation">,</span> timestamp<span class="token punctuation">)</span>
  <span class="token comment">#设置环境变量的语言字符集，为Oracle链接避免乱码</span>
  os<span class="token punctuation">.</span>environ<span class="token punctuation">[</span><span class="token string">'NLS_LANG'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'SIMPLIFIED CHINESE_CHINA.UTF8'</span>
  conn <span class="token operator">=</span> cx_Oracle<span class="token punctuation">.</span>connect<span class="token punctuation">(</span><span class="token string">'数据库链接'</span><span class="token punctuation">)</span>
  cr <span class="token operator">=</span> conn<span class="token punctuation">.</span>cursor<span class="token punctuation">(</span><span class="token punctuation">)</span>
  sql <span class="token operator">=</span> sqlstr
  cr<span class="token punctuation">.</span>execute<span class="token punctuation">(</span>sql<span class="token punctuation">)</span>
  <span class="token comment">#声明列(column)宽度数组</span>
  cwidth <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>

  <span class="token keyword">for</span> record <span class="token keyword">in</span> cr<span class="token punctuation">:</span>
    <span class="token keyword">if</span> rowIndex <span class="token operator">==</span> start_line<span class="token punctuation">:</span> <span class="token comment">#第一行打印表头</span>
      title <span class="token operator">=</span> <span class="token punctuation">[</span>i<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> cr<span class="token punctuation">.</span>description<span class="token punctuation">]</span>
      <span class="token comment">#列宽数组初始化，通过函数调用更新列宽数组，每列的最大值</span>
      cwidth <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">*</span> <span class="token builtin">len</span><span class="token punctuation">(</span>title<span class="token punctuation">)</span>
      g <span class="token operator">=</span> <span class="token keyword">lambda</span> k<span class="token punctuation">:</span><span class="token string">'%-s'</span> <span class="token operator">%</span> k
      title <span class="token operator">=</span> <span class="token builtin">map</span><span class="token punctuation">(</span>g<span class="token punctuation">,</span>title<span class="token punctuation">)</span>
      cwidth <span class="token operator">=</span> WriteSheetRow<span class="token punctuation">(</span>sheet<span class="token punctuation">,</span> title<span class="token punctuation">,</span> rowIndex<span class="token punctuation">,</span> start_column<span class="token punctuation">,</span> cwidth<span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">)</span>
      rowIndex <span class="token operator">=</span> rowIndex <span class="token operator">+</span> <span class="token number">1</span>
      cwidth <span class="token operator">=</span> WriteSheetRow<span class="token punctuation">(</span>sheet<span class="token punctuation">,</span> record<span class="token punctuation">,</span> rowIndex<span class="token punctuation">,</span> start_column<span class="token punctuation">,</span> cwidth<span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
      cwidth <span class="token operator">=</span> WriteSheetRow<span class="token punctuation">(</span>sheet<span class="token punctuation">,</span> record<span class="token punctuation">,</span> rowIndex<span class="token punctuation">,</span> start_column<span class="token punctuation">,</span> cwidth<span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">)</span>
    rowIndex <span class="token operator">=</span> rowIndex <span class="token operator">+</span> <span class="token number">1</span>

  font <span class="token operator">=</span> xlwt<span class="token punctuation">.</span>Font<span class="token punctuation">(</span><span class="token punctuation">)</span>
  font<span class="token punctuation">.</span>bold <span class="token operator">=</span> <span class="token boolean">True</span>
  font<span class="token punctuation">.</span>height<span class="token operator">=</span><span class="token number">300</span>
  font<span class="token punctuation">.</span>underline<span class="token operator">=</span><span class="token boolean">True</span>
  style <span class="token operator">=</span> xlwt<span class="token punctuation">.</span>XFStyle<span class="token punctuation">(</span><span class="token punctuation">)</span>
  style<span class="token punctuation">.</span>font <span class="token operator">=</span> font
  al <span class="token operator">=</span> xlwt<span class="token punctuation">.</span>Alignment<span class="token punctuation">(</span><span class="token punctuation">)</span>
  al<span class="token punctuation">.</span>horz <span class="token operator">=</span> <span class="token number">0x02</span>  <span class="token comment"># 设置水平居中</span>
  al<span class="token punctuation">.</span>vert <span class="token operator">=</span> <span class="token number">0x01</span>  <span class="token comment"># 设置垂直居中</span>
  style<span class="token punctuation">.</span>alignment <span class="token operator">=</span> al
  sheet<span class="token punctuation">.</span>write_merge<span class="token punctuation">(</span>start_line<span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">,</span>start_line<span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">,</span>start_column<span class="token punctuation">,</span>start_column<span class="token operator">+</span><span class="token builtin">len</span><span class="token punctuation">(</span>cwidth<span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>sheetname<span class="token punctuation">,</span>style<span class="token punctuation">)</span>
  a <span class="token operator">=</span> start_column<span class="token operator">+</span><span class="token builtin">len</span><span class="token punctuation">(</span>cwidth<span class="token punctuation">)</span>
  suffix_str <span class="token operator">=</span> <span class="token string">''</span>
  m <span class="token operator">=</span> <span class="token string">'Z'</span> <span class="token keyword">if</span> a <span class="token operator">%</span> <span class="token number">26</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token keyword">else</span> <span class="token builtin">chr</span><span class="token punctuation">(</span>a <span class="token operator">%</span> <span class="token number">26</span> <span class="token operator">+</span> <span class="token number">64</span><span class="token punctuation">)</span>
  prefix <span class="token operator">=</span> <span class="token number">64</span> <span class="token operator">+</span> <span class="token punctuation">(</span>a <span class="token operator">//</span> <span class="token number">26</span><span class="token punctuation">)</span>
  <span class="token keyword">if</span> a <span class="token operator">&gt;</span> <span class="token number">26</span><span class="token punctuation">:</span>
    suffix_str <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token builtin">chr</span><span class="token punctuation">(</span>prefix <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">+</span> m<span class="token punctuation">)</span> <span class="token keyword">if</span> a <span class="token operator">%</span> <span class="token number">26</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token keyword">else</span> <span class="token punctuation">(</span><span class="token builtin">chr</span><span class="token punctuation">(</span>prefix<span class="token punctuation">)</span> <span class="token operator">+</span> m<span class="token punctuation">)</span>
  <span class="token keyword">else</span><span class="token punctuation">:</span>
    suffix_str <span class="token operator">=</span> m
  <span class="token keyword">global</span> endIdx
  endIdx<span class="token punctuation">[</span>idx<span class="token punctuation">]</span> <span class="token operator">=</span> suffix_str<span class="token operator">+</span><span class="token builtin">str</span><span class="token punctuation">(</span>rowIndex<span class="token punctuation">)</span>
  cr<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
  conn<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>

  j <span class="token operator">=</span> <span class="token number">0</span>
  <span class="token comment">#循环设置列宽</span>
  <span class="token keyword">for</span> width <span class="token keyword">in</span> cwidth<span class="token punctuation">:</span>
    sheet<span class="token punctuation">.</span>col<span class="token punctuation">(</span>j<span class="token operator">+</span>start_column<span class="token punctuation">)</span><span class="token punctuation">.</span>width <span class="token operator">=</span> width
    j <span class="token operator">=</span> j <span class="token operator">+</span> <span class="token number">1</span>
  <span class="token keyword">if</span> sheetname <span class="token operator">==</span> <span class="token string">'采购组销售'</span><span class="token punctuation">:</span>
    specialHandling<span class="token punctuation">(</span>sheet<span class="token punctuation">)</span>
  <span class="token comment">#保存文件</span>
  <span class="token keyword">return</span> wbk

<span class="token keyword">def</span> <span class="token function">specialHandling</span><span class="token punctuation">(</span>sheet<span class="token punctuation">)</span><span class="token punctuation">:</span>
  <span class="token keyword">global</span> stylex
  sheet<span class="token punctuation">.</span>write_merge<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'部门'</span><span class="token punctuation">,</span> stylex<span class="token punctuation">)</span>
  sheet<span class="token punctuation">.</span>write_merge<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'采购'</span><span class="token punctuation">,</span> stylex<span class="token punctuation">)</span>
  sheet<span class="token punctuation">.</span>write_merge<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token string">'本    日    销    售'</span><span class="token punctuation">,</span> stylex<span class="token punctuation">)</span>
  sheet<span class="token punctuation">.</span>write_merge<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token string">'本  月  累  计  销  售'</span><span class="token punctuation">,</span> stylex<span class="token punctuation">)</span>
  sheet<span class="token punctuation">.</span>write_merge<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">,</span> <span class="token string">'本   日   来   客'</span><span class="token punctuation">,</span> stylex<span class="token punctuation">)</span>
  sheet<span class="token punctuation">.</span>write_merge<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">,</span> <span class="token string">'本  日  平  均  来  客'</span><span class="token punctuation">,</span> stylex<span class="token punctuation">)</span>
  sheet<span class="token punctuation">.</span>write_merge<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">19</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token string">'本   日   客   单'</span><span class="token punctuation">,</span> stylex<span class="token punctuation">)</span>
  sheet<span class="token punctuation">.</span>write_merge<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">21</span><span class="token punctuation">,</span> <span class="token number">22</span><span class="token punctuation">,</span> <span class="token string">'本   月   客   单'</span><span class="token punctuation">,</span> stylex<span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">createXls</span><span class="token punctuation">(</span>sqlmap<span class="token punctuation">)</span><span class="token punctuation">:</span>
  i <span class="token operator">=</span> <span class="token number">0</span>
  <span class="token keyword">for</span> sqlsheet <span class="token keyword">in</span> sqlmap<span class="token punctuation">:</span>
    wbk <span class="token operator">=</span> xlwt<span class="token punctuation">.</span>Workbook<span class="token punctuation">(</span>encoding<span class="token operator">=</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>
    wbk <span class="token operator">=</span> getData<span class="token punctuation">(</span>wbk<span class="token punctuation">,</span>sqlsheet<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>sqlsheet<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>i<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>sqlsheet<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    wbk<span class="token punctuation">.</span>save<span class="token punctuation">(</span>sqlsheet<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    i <span class="token operator">=</span> i <span class="token operator">+</span> <span class="token number">1</span>
    time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">testColors</span><span class="token punctuation">(</span>filename<span class="token punctuation">)</span><span class="token punctuation">:</span>
  wbk <span class="token operator">=</span> xlwt<span class="token punctuation">.</span>Workbook<span class="token punctuation">(</span><span class="token punctuation">)</span>
  sheet <span class="token operator">=</span> wbk<span class="token punctuation">.</span>add_sheet<span class="token punctuation">(</span><span class="token string">&quot;sheet1&quot;</span><span class="token punctuation">,</span>cell_overwrite_ok<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
  <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">256</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    style <span class="token operator">=</span> xlwt<span class="token punctuation">.</span>XFStyle<span class="token punctuation">(</span><span class="token punctuation">)</span>
    pattern <span class="token operator">=</span> xlwt<span class="token punctuation">.</span>Pattern<span class="token punctuation">(</span><span class="token punctuation">)</span>
    pattern<span class="token punctuation">.</span>pattern <span class="token operator">=</span> <span class="token number">1</span>  <span class="token comment"># xlwt.Pattern.SOLID_PATTERN</span>
    pattern<span class="token punctuation">.</span>pattern_fore_colour <span class="token operator">=</span> i
    pattern<span class="token punctuation">.</span>pattern_back_colour<span class="token operator">=</span><span class="token number">35</span>
    style<span class="token punctuation">.</span>pattern <span class="token operator">=</span> pattern
    sheet<span class="token punctuation">.</span>write<span class="token punctuation">(</span>i<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>i<span class="token punctuation">,</span>style<span class="token punctuation">)</span>
    i <span class="token operator">=</span> i <span class="token operator">+</span> <span class="token number">1</span>
  wbk<span class="token punctuation">.</span>save<span class="token punctuation">(</span>filename<span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span>sqlmap<span class="token punctuation">)</span><span class="token punctuation">:</span>
  createXls<span class="token punctuation">(</span>sqlmap<span class="token punctuation">)</span>
  <span class="token keyword">return</span> endIdx

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    main<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment">#testColors(&quot;colors.xls&quot;)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br><span class="line-number">143</span><br><span class="line-number">144</span><br><span class="line-number">145</span><br><span class="line-number">146</span><br><span class="line-number">147</span><br><span class="line-number">148</span><br><span class="line-number">149</span><br><span class="line-number">150</span><br><span class="line-number">151</span><br><span class="line-number">152</span><br><span class="line-number">153</span><br><span class="line-number">154</span><br><span class="line-number">155</span><br><span class="line-number">156</span><br><span class="line-number">157</span><br><span class="line-number">158</span><br><span class="line-number">159</span><br><span class="line-number">160</span><br><span class="line-number">161</span><br><span class="line-number">162</span><br><span class="line-number">163</span><br><span class="line-number">164</span><br><span class="line-number">165</span><br><span class="line-number">166</span><br><span class="line-number">167</span><br><span class="line-number">168</span><br><span class="line-number">169</span><br><span class="line-number">170</span><br><span class="line-number">171</span><br><span class="line-number">172</span><br><span class="line-number">173</span><br><span class="line-number">174</span><br><span class="line-number">175</span><br><span class="line-number">176</span><br><span class="line-number">177</span><br><span class="line-number">178</span><br><span class="line-number">179</span><br><span class="line-number">180</span><br><span class="line-number">181</span><br><span class="line-number">182</span><br><span class="line-number">183</span><br><span class="line-number">184</span><br><span class="line-number">185</span><br><span class="line-number">186</span><br><span class="line-number">187</span><br><span class="line-number">188</span><br><span class="line-number">189</span><br><span class="line-number">190</span><br><span class="line-number">191</span><br><span class="line-number">192</span><br><span class="line-number">193</span><br><span class="line-number">194</span><br><span class="line-number">195</span><br><span class="line-number">196</span><br><span class="line-number">197</span><br><span class="line-number">198</span><br></div></div><h3 id="excel表格区域截图convertimg-py"><a href="#excel表格区域截图convertimg-py" class="header-anchor">#</a> Excel表格区域截图convertImg.py</h3> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">from</span> PIL <span class="token keyword">import</span> ImageGrab
<span class="token keyword">import</span> pythoncom
<span class="token keyword">import</span> uuid
<span class="token keyword">import</span> os<span class="token punctuation">,</span> time
<span class="token keyword">from</span> win32com<span class="token punctuation">.</span>client <span class="token keyword">import</span> Dispatch<span class="token punctuation">,</span> DispatchEx

<span class="token keyword">def</span> <span class="token function">excel_catch_screen</span><span class="token punctuation">(</span>filename<span class="token punctuation">,</span> imgname<span class="token punctuation">,</span> screen_area<span class="token punctuation">)</span><span class="token punctuation">:</span>
  flag <span class="token operator">=</span> <span class="token number">0</span>
  <span class="token keyword">while</span> flag <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">:</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
      os<span class="token punctuation">.</span>system<span class="token punctuation">(</span><span class="token string">'TASKKILL /F /IM excel.exe'</span><span class="token punctuation">)</span>
      time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
      <span class="token triple-quoted-string string">&quot;&quot;&quot; 对excel的表格区域进行截图——用例：excel_catch_screen(ur&quot;D:\Desktop\123.xlsx&quot;, &quot;Sheet1&quot;, &quot;A1:J10&quot;)&quot;&quot;&quot;</span>
      pythoncom<span class="token punctuation">.</span>CoInitialize<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># excel多线程相关</span>

      excel <span class="token operator">=</span> DispatchEx<span class="token punctuation">(</span><span class="token string">&quot;Excel.Application&quot;</span><span class="token punctuation">)</span>  <span class="token comment"># 启动excel</span>
      excel<span class="token punctuation">.</span>Visible <span class="token operator">=</span> <span class="token boolean">False</span>  <span class="token comment"># 可视化</span>
      excel<span class="token punctuation">.</span>DisplayAlerts <span class="token operator">=</span> <span class="token boolean">False</span>  <span class="token comment"># 是否显示警告</span>
      wb <span class="token operator">=</span> excel<span class="token punctuation">.</span>Workbooks<span class="token punctuation">.</span>Open<span class="token punctuation">(</span>filename<span class="token punctuation">)</span>  <span class="token comment"># 打开excel</span>
      ws <span class="token operator">=</span> wb<span class="token punctuation">.</span>Sheets<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>  <span class="token comment"># 选择sheet</span>
      ws<span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">'B1:'</span> <span class="token operator">+</span> screen_area<span class="token punctuation">)</span><span class="token punctuation">.</span>CopyPicture<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 复制图片区域</span>
      ws<span class="token punctuation">.</span>Paste<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 粘贴 ws.Paste(ws.Range('B1'))  # 将图片移动到具体位置</span>

      name <span class="token operator">=</span> <span class="token builtin">str</span><span class="token punctuation">(</span>uuid<span class="token punctuation">.</span>uuid4<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 重命名唯一值</span>
      new_shape_name <span class="token operator">=</span> name<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">6</span><span class="token punctuation">]</span>
      excel<span class="token punctuation">.</span>Selection<span class="token punctuation">.</span>ShapeRange<span class="token punctuation">.</span>Name <span class="token operator">=</span> new_shape_name  <span class="token comment"># 将刚刚选择的Shape重命名，避免与已有图片混淆</span>

      ws<span class="token punctuation">.</span>Shapes<span class="token punctuation">(</span>new_shape_name<span class="token punctuation">)</span><span class="token punctuation">.</span>Copy<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 选择图片</span>
      img <span class="token operator">=</span> ImageGrab<span class="token punctuation">.</span>grabclipboard<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 获取剪贴板的图片数据</span>
      img<span class="token punctuation">.</span>save<span class="token punctuation">(</span>imgname<span class="token punctuation">)</span>  <span class="token comment"># 保存图片</span>
      wb<span class="token punctuation">.</span>Close<span class="token punctuation">(</span>SaveChanges<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>  <span class="token comment"># 关闭工作薄，不保存</span>
      excel<span class="token punctuation">.</span>Quit<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 退出excel</span>
      <span class="token keyword">del</span> excel  <span class="token comment"># 这个地方很重要，杀死excel进程是这个地方起作用</span>
      pythoncom<span class="token punctuation">.</span>CoUninitialize<span class="token punctuation">(</span><span class="token punctuation">)</span>
      flag <span class="token operator">=</span> <span class="token number">10</span>
    <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
       flag <span class="token operator">+=</span> <span class="token number">1</span>


<span class="token keyword">def</span> <span class="token function">starts</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
  currentPath <span class="token operator">=</span> <span class="token string">'C:\\pythonsource\\analysis\\'</span>
  excel_catch_screen<span class="token punctuation">(</span>currentPath <span class="token operator">+</span> <span class="token string">'stx_ind.xls'</span><span class="token punctuation">,</span> currentPath <span class="token operator">+</span> <span class="token string">'stx_ind.png'</span><span class="token punctuation">,</span> <span class="token string">'AD18'</span><span class="token punctuation">)</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    starts<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br></div></div><h3 id="微信发图程序wechat-py"><a href="#微信发图程序wechat-py" class="header-anchor">#</a> 微信发图程序wechat.py</h3> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">import</span> time
<span class="token keyword">import</span> pyautogui
<span class="token keyword">import</span> pyperclip
<span class="token keyword">import</span> win32api
<span class="token keyword">import</span> win32con
<span class="token keyword">import</span> win32gui
<span class="token keyword">import</span> random

<span class="token keyword">def</span> <span class="token function">mapping_img</span><span class="token punctuation">(</span>img<span class="token punctuation">,</span>click<span class="token punctuation">)</span><span class="token punctuation">:</span>
  box_location <span class="token operator">=</span> pyautogui<span class="token punctuation">.</span>locateOnScreen<span class="token punctuation">(</span>img<span class="token punctuation">)</span>
  <span class="token keyword">print</span><span class="token punctuation">(</span>box_location<span class="token punctuation">)</span>
  center <span class="token operator">=</span> pyautogui<span class="token punctuation">.</span>center<span class="token punctuation">(</span>box_location<span class="token punctuation">)</span>
  <span class="token keyword">if</span> click <span class="token operator">==</span> <span class="token string">'double'</span><span class="token punctuation">:</span>
    pyautogui<span class="token punctuation">.</span>doubleClick<span class="token punctuation">(</span>center<span class="token punctuation">)</span>
  <span class="token keyword">else</span><span class="token punctuation">:</span>
    pyautogui<span class="token punctuation">.</span>leftClick<span class="token punctuation">(</span>center<span class="token punctuation">)</span>
  time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">chat_user</span><span class="token punctuation">(</span>user<span class="token punctuation">,</span>currentPath<span class="token punctuation">)</span><span class="token punctuation">:</span>
  <span class="token keyword">if</span> user <span class="token operator">!=</span> <span class="token string">''</span><span class="token punctuation">:</span>
    mapping_img<span class="token punctuation">(</span>currentPath<span class="token operator">+</span><span class="token string">'search.png'</span><span class="token punctuation">,</span><span class="token string">'single'</span><span class="token punctuation">)</span>
    pyautogui<span class="token punctuation">.</span>typewrite<span class="token punctuation">(</span>user<span class="token punctuation">)</span>
    time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    pyautogui<span class="token punctuation">.</span>moveRel<span class="token punctuation">(</span>xOffset<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span>yOffset<span class="token operator">=</span><span class="token number">80</span><span class="token punctuation">)</span>
    pyautogui<span class="token punctuation">.</span>click<span class="token punctuation">(</span><span class="token punctuation">)</span>
    time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
  <span class="token keyword">else</span><span class="token punctuation">:</span>
    mapping_img<span class="token punctuation">(</span>currentPath<span class="token operator">+</span><span class="token string">'mine.png'</span><span class="token punctuation">,</span><span class="token string">'single'</span><span class="token punctuation">)</span>
    mapping_img<span class="token punctuation">(</span>currentPath<span class="token operator">+</span><span class="token string">'chat.png'</span><span class="token punctuation">,</span><span class="token string">'single'</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">read_txt</span><span class="token punctuation">(</span>txt<span class="token punctuation">)</span><span class="token punctuation">:</span>
  hellofile <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span>txt<span class="token punctuation">,</span><span class="token string">&quot;r&quot;</span><span class="token punctuation">,</span>encoding<span class="token operator">=</span><span class="token string">&quot;UTF-8&quot;</span><span class="token punctuation">)</span>
  hellocontent <span class="token operator">=</span> hellofile<span class="token punctuation">.</span>readlines<span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>hellocontent<span class="token punctuation">)</span><span class="token punctuation">)</span>
  number <span class="token operator">=</span> random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token builtin">len</span><span class="token punctuation">(</span>hellocontent<span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
  <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'line number is {}'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>number<span class="token punctuation">)</span><span class="token punctuation">)</span>
  pyperclip<span class="token punctuation">.</span>copy<span class="token punctuation">(</span>hellocontent<span class="token punctuation">[</span>number<span class="token punctuation">]</span><span class="token punctuation">)</span>
  pyautogui<span class="token punctuation">.</span>hotkey<span class="token punctuation">(</span><span class="token string">'ctrl'</span><span class="token punctuation">,</span><span class="token string">'v'</span><span class="token punctuation">)</span>
  hellofile<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">read_img</span><span class="token punctuation">(</span>currentPath<span class="token punctuation">,</span>imgPath<span class="token punctuation">,</span>tag<span class="token punctuation">)</span><span class="token punctuation">:</span>
  <span class="token keyword">if</span> tag <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
    mapping_img<span class="token punctuation">(</span>currentPath <span class="token operator">+</span> <span class="token string">'pic.png'</span><span class="token punctuation">,</span> <span class="token string">'single'</span><span class="token punctuation">)</span>
  <span class="token keyword">else</span><span class="token punctuation">:</span>
    pyautogui<span class="token punctuation">.</span>click<span class="token punctuation">(</span><span class="token punctuation">)</span>
  pyautogui<span class="token punctuation">.</span>typewrite<span class="token punctuation">(</span>imgPath<span class="token punctuation">)</span>
  pyautogui<span class="token punctuation">.</span>press<span class="token punctuation">(</span><span class="token string">'enter'</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">closeWindow</span><span class="token punctuation">(</span>currentPath<span class="token punctuation">)</span><span class="token punctuation">:</span>
  mapping_img<span class="token punctuation">(</span>currentPath <span class="token operator">+</span> <span class="token string">'close.png'</span><span class="token punctuation">,</span><span class="token string">'single'</span><span class="token punctuation">)</span>
  pyautogui<span class="token punctuation">.</span>click<span class="token punctuation">(</span><span class="token punctuation">)</span>


<span class="token keyword">def</span> <span class="token function">sendInfor</span><span class="token punctuation">(</span>username<span class="token punctuation">,</span>currentPath<span class="token punctuation">,</span>filedirs<span class="token punctuation">)</span><span class="token punctuation">:</span>
  pyautogui<span class="token punctuation">.</span>hotkey<span class="token punctuation">(</span><span class="token string">'win'</span><span class="token punctuation">,</span> <span class="token string">'m'</span><span class="token punctuation">)</span>
  posX <span class="token operator">=</span> win32api<span class="token punctuation">.</span>GetSystemMetrics<span class="token punctuation">(</span>win32con<span class="token punctuation">.</span>SM_CXSCREEN<span class="token punctuation">)</span>
  posY <span class="token operator">=</span> win32api<span class="token punctuation">.</span>GetSystemMetrics<span class="token punctuation">(</span>win32con<span class="token punctuation">.</span>SM_CYSCREEN<span class="token punctuation">)</span>
  <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'{},{}'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>posX<span class="token punctuation">,</span> posY<span class="token punctuation">)</span><span class="token punctuation">)</span>
  time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
  pyautogui<span class="token punctuation">.</span>leftClick<span class="token punctuation">(</span>posX <span class="token operator">-</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span>
  time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
  <span class="token comment">#TODO Login Wechat</span>
  mapping_img<span class="token punctuation">(</span>currentPath<span class="token operator">+</span><span class="token string">'login.png'</span><span class="token punctuation">,</span><span class="token string">'double'</span><span class="token punctuation">)</span>
  <span class="token comment">#TODO 输入法变更</span>
  hwnd <span class="token operator">=</span> win32gui<span class="token punctuation">.</span>GetForegroundWindow<span class="token punctuation">(</span><span class="token punctuation">)</span>
  win32api<span class="token punctuation">.</span>SendMessage<span class="token punctuation">(</span>hwnd<span class="token punctuation">,</span>win32con<span class="token punctuation">.</span>WM_INPUTLANGCHANGEREQUEST<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0x0409</span><span class="token punctuation">)</span>
  <span class="token comment">#TODO search chat user</span>
  chat_user<span class="token punctuation">(</span>username<span class="token punctuation">,</span>currentPath<span class="token punctuation">)</span>
  i <span class="token operator">=</span> <span class="token number">0</span>
  <span class="token keyword">for</span> imgPath <span class="token keyword">in</span> filedirs<span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>currentPath<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>imgPath<span class="token punctuation">)</span>
    read_img<span class="token punctuation">(</span>currentPath<span class="token punctuation">,</span>imgPath<span class="token punctuation">,</span>i<span class="token punctuation">)</span>
    pyautogui<span class="token punctuation">.</span>press<span class="token punctuation">(</span><span class="token string">'enter'</span><span class="token punctuation">,</span>interval<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">)</span>
    i <span class="token operator">=</span> i <span class="token operator">+</span> <span class="token number">1</span>
  closeWindow<span class="token punctuation">(</span>currentPath<span class="token punctuation">)</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br></div></div><h3 id="数据库sql存储queryinfo-py"><a href="#数据库sql存储queryinfo-py" class="header-anchor">#</a> 数据库sql存储queryInfo.py</h3> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">getParam</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
  sqlmap <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token punctuation">[</span><span class="token triple-quoted-string string">'''select case when(lag(area_no) over(order by area_no, name) = area_no and grouping(name) = 0) then '' 
            else decode(grouping(area_no)+grouping(name),1,'小计',2,'总计', decode(area_no,11,'江苏小综超',51,'江苏综超','其他')) end 分区, 
           decode(grouping(name),1,count(*)||'条',name) 店名, 
           round(sum(target)/10000,2) 日指标, round(sum(t_sal)/10000,2) 销售, round(sum(l_sal)/10000,2) 同期销售, round(sum(t_sal-l_sal)/10000,2) 增长额, 
           round(sum(t_sal-l_sal)/sum(l_sal)*100,2) 增长率,
           sum(t_visit) 来客, sum(l_visit) 同期来客, sum(t_visit-l_visit) 增长额, round(sum(t_visit-l_visit)/sum(l_visit)*100,2) 增长率,
           round(sum(t_sal)/sum(t_visit),2) 客单, round(sum(l_sal)/sum(l_visit),2) 同期客单, 
           round(sum(t_sal)/sum(t_visit),2)-round(sum(l_sal)/sum(l_visit),2) 增长额, 
           round((sum(t_sal)/sum(t_visit)-sum(l_sal)/sum(l_visit))/(sum(l_sal)/sum(l_visit))*100,2) 增长率
    from erp_st_ind where name not like '%大厂%'
    group by rollup(area_no, name)'''</span><span class="token punctuation">,</span><span class="token string">'门店时段销售'</span><span class="token punctuation">,</span><span class="token string">'st_ind.xls'</span><span class="token punctuation">,</span><span class="token string">'st_ind.png'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token triple-quoted-string string">'''with step1 as(
      select decode(t2.division,1,'1生鲜',2,'2食品',3,'3百货','其他') 部门, 
             case when(t2.buyer_uid like '%NF2%') then '硬百'
             when(t2.buyer_uid like '%NF10%') then '软百'
             else t2.buyer_uid end 采购,
             sum(target) target, sum(t_sal) t_sal, sum(l_sal) l_sal, sum(t_visit) t_visit, sum(l_visit) l_visit 
      from erp_group_ind t1, 
             (select t2.division, name, wm_concat(distinct t1.buyer_uid) buyer_uid 
              from erp_buyer_info t1, groups t2 
              where t1.group_no=t2.group_no group by division, name) t2
      where t1.name = t2.name
      group by t2.division, t2.buyer_uid
      ),
      step2 as(
      select decode(t2.division,1,'1生鲜',2,'2食品',3,'3百货','其他') 部门, 
             case when(t2.buyer_uid like '%NF2%') then '硬百'
             when(t2.buyer_uid like '%NF10%') then '软百'
             else t2.buyer_uid end 采购, division,
             --decode(substr(t2.buyer_uid,1,3),'NF2','软百','NF1','硬百',t2.buyer_uid) 采购, 
             sum(target) g_target, sum(g_tsal) g_tsal, sum(g_lsal) g_lsal, sum(g_tvisit) g_tvisit, sum(g_lvisit)g_lvisit 
      from erp_group_heap t1, 
             (select t2.division, name, wm_concat(distinct t1.buyer_uid) buyer_uid 
              from erp_buyer_info t1, groups t2 
              where t1.group_no=t2.group_no group by division, name) t2
      where t1.name = t2.name
      group by t2.division, t2.buyer_uid
      )
      select case when(lag(t2.部门) over(order by t2.部门, t2.采购) = t2.部门 and grouping(t2.采购) = 0) then '' 
                  else decode(grouping(t2.部门)+grouping(t2.采购),1,'小计',2,'总计', substr(t2.部门,2)) end  部门, 
             decode(grouping(t2.采购),1,count(*)||'条',t2.采购) 采购,
             round(sum(t1.target)/10000,2) 日指标, round(sum(t_sal)/10000,2) 销售, round(sum(t_sal)/sum(target)*100,2) 达成, round(sum(l_sal)/10000,2) 同期,
             round((sum(t_sal)-sum(l_sal))/10000,2) 增长, round(decode(sum(l_sal),0,0,(sum(t_sal)-sum(l_sal))/sum(l_sal)*100),2) 增长率,
             round((sum(g_tsal)+sum(t_sal))/10000,2) 月销售, round(sum(t2.g_target)/10000,2) 月指标, round((sum(g_tsal)+sum(t_sal))/sum(g_target)*100,2) 达成, 
             round(decode(sum(g_lsal),0,0,(sum(g_tsal)+sum(t_sal)-sum(g_lsal))/sum(g_lsal)*100),2) 增长率,
             sum(t_visit) 来客, sum(t_visit)-sum(l_visit) 增长, round((sum(t_visit)-sum(l_visit))/sum(l_visit)*100,2) 增长率,
             round((sum(g_tvisit)+sum(t_visit))/to_char(sysdate,'DD')) 来客, 
             round((sum(g_tvisit)+sum(t_visit)-sum(g_lvisit))/to_char(sysdate,'DD')) 增长, 
             round((sum(g_tvisit)+sum(t_visit)-sum(g_lvisit))/sum(g_lvisit)*100,2) 增长率,
             round(sum(t_sal)/sum(t_visit),2) 客单, 
             round((sum(t_sal)/sum(t_visit)-sum(l_sal)/sum(l_visit))/(sum(l_sal)/sum(l_visit))*100,2) 增长率,
             round((sum(g_tsal)+sum(t_sal))/(sum(g_tvisit)+sum(t_visit)),2) 客单, 
             round(((sum(g_tsal)+sum(t_sal))/(sum(g_tvisit)+sum(t_visit))-sum(g_lsal)/sum(g_lvisit))/(sum(g_lsal)/sum(g_lvisit))*100,2) 增长率   
      from step1 t1, step2 t2
      where t1.采购 = t2.采购
      group by rollup(t2.部门,t2.采购)'''</span><span class="token punctuation">,</span><span class="token string">'采购组销售'</span><span class="token punctuation">,</span><span class="token string">'group_sal.xls'</span><span class="token punctuation">,</span><span class="token string">'group_sal.png'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token triple-quoted-string string">'''with step1 as(
        Select t1.area_no,t.new_store_no,t.ds,t.Name,row_number()
        over( order by decode(t.l_sal,0,0,(t.t_sal-t.l_sal)*100/t.l_sal) desc) rank,
        t.t_sal , round(decode(t.l_sal,0,0,(t.t_sal-t.l_sal)*100/t.l_sal),2) s_zzv,
        t.t_visit,t.l_visit,
         round(decode(t.l_visit,0,0,(t.t_visit-t.l_visit)*100/t.l_visit),2) v_zzv,t.l_sal
         From erp_ds_ind t,store_compare t1
        Where t.new_store_no=t1.new_store_no and t1.old_store_no != 16
        And t1.area_no In(51,11)
        And t.ds='菜'
        ),
        step2 as(
        Select t.Location,t.t_visit
        From erp_st_ind t,store_compare t1
        Where t.Location=t1.new_store_no
        And t1.area_no In(51,11)
        ),
        step3 as(
        select wm_concat(ds)品类,decode(grouping(t1.name),1,count(*)||'条',t1.name) 店名,to_number(decode(grouping(name),1,null,sum(rank))) 名次,
               Sum(t1.t_sal) 销售额,
               round(decode(sum(t1.l_sal),0,0,(Sum(t1.t_sal)-sum(t1.l_sal))/sum(t1.l_sal))*100,2) 增长率,Sum(t1.t_visit) 来客,
               round(decode(sum(t1.l_visit),0,0,(Sum(t1.t_visit)-sum(t1.l_visit))/sum(t1.l_visit))*100,2) 来客增长率,
               decode(Sum(t2.t_visit),0,0,round(Sum(t1.t_visit)/Sum(t2.t_visit)*100,2)) 渗透率,
               decode(Sum(t1.t_visit),0,0,round(Sum(t1.t_sal)/Sum(t1.t_visit),2)) 客单,
               decode(sum(round(decode(t1.l_visit,0,0,t1.l_sal/t1.l_visit),2)),0,0,
               round(Sum( (round(decode(t1.t_visit,0,0,t1.t_sal/t1.t_visit),2)-round(decode(t1.l_visit,0,0,t1.l_sal/t1.l_visit),2)))*100/
              sum(round(decode(t1.l_visit,0,0,t1.l_sal/t1.l_visit),2)),2)) 客单增长率  
             from step1 t1, step2 t2
        where t1.new_store_no = t2.Location
        group by rollup(t1.Name)
        )
        select case when(length(品类) &gt; 5) then '总计' when(lag(品类,1) over(order by 名次) = 品类) then '' else 品类 end 品类,
               店名, 名次, 销售额, 增长率, 来客, 来客增长率, 渗透率, 客单, 客单增长率
        from step3'''</span><span class="token punctuation">,</span><span class="token string">'生鲜三大品类销售-菜'</span><span class="token punctuation">,</span><span class="token string">'vege.xls'</span><span class="token punctuation">,</span><span class="token string">'vege.png'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token triple-quoted-string string">'''with step1 as(
          Select t1.area_no,t.new_store_no,t.ds,t.Name,row_number()
          over( order by decode(t.l_sal,0,0,(t.t_sal-t.l_sal)*100/t.l_sal) desc) rank,
          t.t_sal , round(decode(t.l_sal,0,0,(t.t_sal-t.l_sal)*100/t.l_sal),2) s_zzv,
          t.t_visit,t.l_visit,
           round(decode(t.l_visit,0,0,(t.t_visit-t.l_visit)*100/t.l_visit),2) v_zzv,t.l_sal
           From erp_ds_ind t,store_compare t1
          Where t.new_store_no=t1.new_store_no and t1.old_store_no != 16
          And t1.area_no In(51,11)
          And t.ds='果'
          ),
          step2 as(
          Select t.Location,t.t_visit
          From erp_st_ind t,store_compare t1
          Where t.Location=t1.new_store_no
          And t1.area_no In(51,11)
          ),
          step3 as(
          select wm_concat(ds)品类,decode(grouping(t1.name),1,count(*)||'条',t1.name) 店名,to_number(decode(grouping(name),1,null,sum(rank))) 名次,
                 Sum(t1.t_sal) 销售额,
                 round(decode(sum(t1.l_sal),0,0,(Sum(t1.t_sal)-sum(t1.l_sal))/sum(t1.l_sal))*100,2) 增长率,Sum(t1.t_visit) 来客,
                 round(decode(sum(t1.l_visit),0,0,(Sum(t1.t_visit)-sum(t1.l_visit))/sum(t1.l_visit))*100,2) 来客增长率,
                 decode(Sum(t2.t_visit),0,0,round(Sum(t1.t_visit)/Sum(t2.t_visit)*100,2)) 渗透率,
                 decode(Sum(t1.t_visit),0,0,round(Sum(t1.t_sal)/Sum(t1.t_visit),2)) 客单,
                 decode(sum(round(decode(t1.l_visit,0,0,t1.l_sal/t1.l_visit),2)),0,0,
                 round(Sum( (round(decode(t1.t_visit,0,0,t1.t_sal/t1.t_visit),2)-round(decode(t1.l_visit,0,0,t1.l_sal/t1.l_visit),2)))*100/
                sum(round(decode(t1.l_visit,0,0,t1.l_sal/t1.l_visit),2)),2)) 客单增长率  
               from step1 t1, step2 t2
          where t1.new_store_no = t2.Location
          group by rollup(t1.Name)
          )
          select case when(length(品类) &gt; 5) then '总计' when(lag(品类,1) over(order by 名次) = 品类) then '' else 品类 end 品类,
                 店名, 名次, 销售额, 增长率, 来客, 来客增长率, 渗透率, 客单, 客单增长率
          from step3'''</span><span class="token punctuation">,</span> <span class="token string">'生鲜三大品类销售-果'</span><span class="token punctuation">,</span> <span class="token string">'fruit.xls'</span><span class="token punctuation">,</span> <span class="token string">'fruit.png'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token triple-quoted-string string">'''with step1 as(
          Select t1.area_no,t.new_store_no,t.ds,t.Name,row_number()
          over( order by decode(t.l_sal,0,0,(t.t_sal-t.l_sal)*100/t.l_sal) desc) rank,
          t.t_sal , round(decode(t.l_sal,0,0,(t.t_sal-t.l_sal)*100/t.l_sal),2) s_zzv,
          t.t_visit,t.l_visit,
           round(decode(t.l_visit,0,0,(t.t_visit-t.l_visit)*100/t.l_visit),2) v_zzv,t.l_sal
           From erp_ds_ind t,store_compare t1
          Where t.new_store_no=t1.new_store_no and t1.old_store_no != 16
          And t1.area_no In(51,11)
          And t.ds='肉'
          ),
          step2 as(
          Select t.Location,t.t_visit
          From erp_st_ind t,store_compare t1
          Where t.Location=t1.new_store_no
          And t1.area_no In(51,11)
          ),
          step3 as(
          select wm_concat(ds)品类,decode(grouping(t1.name),1,count(*)||'条',t1.name) 店名,to_number(decode(grouping(name),1,null,sum(rank))) 名次,
                 Sum(t1.t_sal) 销售额,
                 round(decode(sum(t1.l_sal),0,0,(Sum(t1.t_sal)-sum(t1.l_sal))/sum(t1.l_sal))*100,2) 增长率,Sum(t1.t_visit) 来客,
                 round(decode(sum(t1.l_visit),0,0,(Sum(t1.t_visit)-sum(t1.l_visit))/sum(t1.l_visit))*100,2) 来客增长率,
                 decode(Sum(t2.t_visit),0,0,round(Sum(t1.t_visit)/Sum(t2.t_visit)*100,2)) 渗透率,
                 decode(Sum(t1.t_visit),0,0,round(Sum(t1.t_sal)/Sum(t1.t_visit),2)) 客单,
                 decode(sum(round(decode(t1.l_visit,0,0,t1.l_sal/t1.l_visit),2)),0,0,
                 round(Sum( (round(decode(t1.t_visit,0,0,t1.t_sal/t1.t_visit),2)-round(decode(t1.l_visit,0,0,t1.l_sal/t1.l_visit),2)))*100/
                sum(round(decode(t1.l_visit,0,0,t1.l_sal/t1.l_visit),2)),2)) 客单增长率  
               from step1 t1, step2 t2
          where t1.new_store_no = t2.Location
          group by rollup(t1.Name)
          )
          select case when(length(品类) &gt; 5) then '总计' when(lag(品类,1) over(order by 名次) = 品类) then '' else 品类 end 品类,
                 店名, 名次, 销售额, 增长率, 来客, 来客增长率, 渗透率, 客单, 客单增长率
          from step3'''</span><span class="token punctuation">,</span><span class="token string">'生鲜三大品类销售-肉'</span><span class="token punctuation">,</span><span class="token string">'meat.xls'</span><span class="token punctuation">,</span><span class="token string">'meat.png'</span><span class="token punctuation">]</span>
  <span class="token punctuation">]</span>
  <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token number">65</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> sqlmap
<span class="token keyword">def</span> <span class="token function">get_nParam</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
  sqlmap_night <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token punctuation">[</span><span class="token triple-quoted-string string">'''select decode(grouping(i.area_no)+grouping(i.name),1,'小计',2,'总计', decode(i.area_no,11,'江苏小综超',51,'江苏综超','其他')) 分区, 
           decode(grouping(i.name),1,count(*)||'条',i.name) 店名, 
           round(sum(i.target)/10000,2) 日指标, round(sum(i.t_sal)/10000,2) 销售, round(sum(i.t_sal)/sum(i.target)*100,0) 达成,round(sum(i.l_sal)/10000,2) 同期销售, round(sum(i.t_sal-i.l_sal)/10000,2) 增长额, 
           round(sum(i.t_sal-i.l_sal)/sum(i.l_sal)*100,2) 增长率,
           round(sum(i.t_sal+h.st_tsal)/10000,2) 月销售,round(sum(h.target)/10000,2) 月指标,round(sum(i.t_sal+h.st_tsal)/sum(h.target)*100,0) 月达成,round(sum(i.t_sal+h.st_tsal-h.st_lsal)/10000,2) 月增长,round(sum(i.t_sal+h.st_tsal-h.st_lsal)/sum(h.st_lsal)*100,2) 月增长率,
           sum(i.t_visit) 来客, sum(i.l_visit) 同期来客, sum(i.t_visit-i.l_visit) 增长额, round(sum(i.t_visit-i.l_visit)/sum(i.l_visit)*100,2) 增长率,
           round(sum(i.t_visit+h.st_tvisit)/to_number(to_char(trunc(sysdate),'dd')),0) 月日均来客,round(sum(h.st_lvisit)/to_number(to_char(trunc(sysdate),'dd')) ,0) 月同期日均来客,round(sum(i.t_visit+h.st_tvisit)/to_number(to_char(trunc(sysdate),'dd')),0)-round(sum(h.st_lvisit)/to_number(to_char(trunc(sysdate),'dd')),0) 月日均来客增长,
           round((sum(i.t_visit+h.st_tvisit)-sum(h.st_lvisit))*100/(sum(h.st_lvisit)),2) 月日均来客增长率,
           round(sum(i.t_sal)/sum(i.t_visit),2) 客单, round(sum(i.l_sal)/sum(i.l_visit),2) 同期客单, 
           round(sum(i.t_sal)/sum(i.t_visit),2)-round(sum(i.l_sal)/sum(i.l_visit),2) 增长额, 
           round((sum(i.t_sal)/sum(i.t_visit)-sum(i.l_sal)/sum(i.l_visit))/(sum(i.l_sal)/sum(i.l_visit))*100,2) 增长率,
           round(sum(i.t_sal+h.st_tsal)/sum(i.t_visit+h.st_tvisit),2) 月客单,round(sum(h.st_lsal)/sum(h.st_lvisit),2) 月同期客单, round(sum(i.t_sal+h.st_tsal)/sum(i.t_visit+h.st_tvisit)-sum(h.st_lsal)/sum(h.st_lvisit),2) 月客单增长,round((sum(i.t_sal+h.st_tsal)/sum(i.t_visit+h.st_tvisit)-sum(h.st_lsal)/sum(h.st_lvisit))/(sum(h.st_lsal)/sum(h.st_lvisit))*100,2) 月客单增长率
    from erp_st_ind i,erp_st_heap h
    where i.name not like '%大厂%'
          and i.location=h.location
    group by rollup(i.area_no, i.name)'''</span><span class="token punctuation">,</span><span class="token string">'门店时段销售'</span><span class="token punctuation">,</span><span class="token string">'stx_ind.xls'</span><span class="token punctuation">,</span><span class="token string">'stx_ind.png'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token triple-quoted-string string">'''select decode(grouping(i.area_no)+grouping(i.name),1,'小计',2,'总计', decode(i.area_no,11,'江苏小综超',51,'江苏综超','其他')) 分区, 
           decode(grouping(i.name),1,count(*)||'条',i.name) 店名, 
           decode(i.div,1,'生鲜',2,'食品',3,'百货') 部门,
           round(sum(i.target)/10000,2) 日指标, round(sum(i.t_sal)/10000,2) 销售, round(sum(i.t_sal)/sum(i.target)*100,2) 达成,round(sum(i.l_sal)/10000,2) 同期销售, round(sum(i.t_sal-i.l_sal)/10000,2) 增长额, 
           round(sum(i.t_sal-i.l_sal)/sum(i.l_sal)*100,2) 增长率,
           round(sum(i.t_sal+h.g_tsal)/10000,2) 月销售,round(sum(h.target)/10000,2) 月指标,round(sum(i.t_sal+h.g_tsal)/sum(h.target)*100,2) 月达成,round(sum(i.t_sal+h.g_tsal-h.g_lsal)/10000,2) 月增长,round(sum(i.t_sal+h.g_tsal-h.g_lsal)/sum(h.g_lsal)*100,2) 月增长率,
           sum(i.t_visit) 来客, sum(i.l_visit) 同期来客, sum(i.t_visit-i.l_visit) 增长额, round(sum(i.t_visit-i.l_visit)/sum(i.l_visit)*100,2) 增长率,
           round(sum(i.t_visit+h.g_tvisit)/to_number(to_char(trunc(sysdate),'dd')),0) 月日均来客,round(sum(h.g_lvisit)/to_number(to_char(trunc(sysdate),'dd')) ,0) 月同期日均来客,round(sum(i.t_visit+h.g_tvisit)/to_number(to_char(trunc(sysdate),'dd')),0)-round(sum(h.g_lvisit)/to_number(to_char(trunc(sysdate),'dd')),0) 月日均来客增长,
           round((sum(i.t_visit+h.g_tvisit)-sum(h.g_lvisit))*100/(sum(h.g_lvisit)),2) 月日均来客增长率,
           round(sum(i.t_sal)/sum(i.t_visit),2) 客单, round(sum(i.l_sal)/sum(i.l_visit),2) 同期客单, 
           round(sum(i.t_sal)/sum(i.t_visit),2)-round(sum(i.l_sal)/sum(i.l_visit),2) 增长额, 
           round((sum(i.t_sal)/sum(i.t_visit)-sum(i.l_sal)/sum(i.l_visit))/(sum(i.l_sal)/sum(i.l_visit))*100,2) 增长率,
           round(sum(i.t_sal+h.g_tsal)/sum(i.t_visit+h.g_tvisit),2) 月客单,round(sum(h.g_lsal)/sum(h.g_lvisit),2) 月同期客单, round(sum(i.t_sal+h.g_tsal)/sum(i.t_visit+h.g_tvisit)-sum(h.g_lsal)/sum(h.g_lvisit),2) 月客单增长,round((sum(i.t_sal+h.g_tsal)/sum(i.t_visit+h.g_tvisit)-sum(h.g_lsal)/sum(h.g_lvisit))/(sum(h.g_lsal)/sum(h.g_lvisit))*100,2) 月客单增长率
    from erp_div_ind i,erp_div_heap h
    where i.name not like '%大厂%'
          and i.new_store_no=h.location
          and i.div=1
          and i.div=h.div
    group by i.div,rollup(i.area_no, i.name)'''</span><span class="token punctuation">,</span><span class="token string">'部门销售-生鲜'</span><span class="token punctuation">,</span><span class="token string">'sx_ind.xls'</span><span class="token punctuation">,</span><span class="token string">'sx_ind.png'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token triple-quoted-string string">'''select decode(grouping(i.area_no)+grouping(i.name),1,'小计',2,'总计', decode(i.area_no,11,'江苏小综超',51,'江苏综超','其他')) 分区, 
             decode(grouping(i.name),1,count(*)||'条',i.name) 店名, 
             decode(i.div,1,'生鲜',2,'食品',3,'百货') 部门,
             round(sum(i.target)/10000,2) 日指标, round(sum(i.t_sal)/10000,2) 销售, round(sum(i.t_sal)/sum(i.target)*100,2) 达成,round(sum(i.l_sal)/10000,2) 同期销售, round(sum(i.t_sal-i.l_sal)/10000,2) 增长额, 
             round(sum(i.t_sal-i.l_sal)/sum(i.l_sal)*100,2) 增长率,
             round(sum(i.t_sal+h.g_tsal)/10000,2) 月销售,round(sum(h.target)/10000,2) 月指标,round(sum(i.t_sal+h.g_tsal)/sum(h.target)*100,2) 月达成,round(sum(i.t_sal+h.g_tsal-h.g_lsal)/10000,2) 月增长,round(sum(i.t_sal+h.g_tsal-h.g_lsal)/sum(h.g_lsal)*100,2) 月增长率,
             sum(i.t_visit) 来客, sum(i.l_visit) 同期来客, sum(i.t_visit-i.l_visit) 增长额, round(sum(i.t_visit-i.l_visit)/sum(i.l_visit)*100,2) 增长率,
             round(sum(i.t_visit+h.g_tvisit)/to_number(to_char(trunc(sysdate),'dd')),0) 月日均来客,round(sum(h.g_lvisit)/to_number(to_char(trunc(sysdate),'dd')) ,0) 月同期日均来客,round(sum(i.t_visit+h.g_tvisit)/to_number(to_char(trunc(sysdate),'dd')),0)-round(sum(h.g_lvisit)/to_number(to_char(trunc(sysdate),'dd')),0) 月日均来客增长,
             round((sum(i.t_visit+h.g_tvisit)-sum(h.g_lvisit))*100/(sum(h.g_lvisit)),2) 月日均来客增长率,
             round(sum(i.t_sal)/sum(i.t_visit),2) 客单, round(sum(i.l_sal)/sum(i.l_visit),2) 同期客单, 
             round(sum(i.t_sal)/sum(i.t_visit),2)-round(sum(i.l_sal)/sum(i.l_visit),2) 增长额, 
             round((sum(i.t_sal)/sum(i.t_visit)-sum(i.l_sal)/sum(i.l_visit))/(sum(i.l_sal)/sum(i.l_visit))*100,2) 增长率,
             round(sum(i.t_sal+h.g_tsal)/sum(i.t_visit+h.g_tvisit),2) 月客单,round(sum(h.g_lsal)/sum(h.g_lvisit),2) 月同期客单, round(sum(i.t_sal+h.g_tsal)/sum(i.t_visit+h.g_tvisit)-sum(h.g_lsal)/sum(h.g_lvisit),2) 月客单增长,round((sum(i.t_sal+h.g_tsal)/sum(i.t_visit+h.g_tvisit)-sum(h.g_lsal)/sum(h.g_lvisit))/(sum(h.g_lsal)/sum(h.g_lvisit))*100,2) 月客单增长率
      from erp_div_ind i,erp_div_heap h
      where i.name not like '%大厂%'
            and i.new_store_no=h.location
            and i.div=2
            and i.div=h.div
      group by i.div,rollup(i.area_no, i.name)'''</span><span class="token punctuation">,</span> <span class="token string">'部门销售-食品'</span><span class="token punctuation">,</span> <span class="token string">'sp_ind.xls'</span><span class="token punctuation">,</span> <span class="token string">'sp_ind.png'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token triple-quoted-string string">'''select decode(grouping(i.area_no)+grouping(i.name),1,'小计',2,'总计', decode(i.area_no,11,'江苏小综超',51,'江苏综超','其他')) 分区, 
             decode(grouping(i.name),1,count(*)||'条',i.name) 店名, 
             decode(i.div,1,'生鲜',2,'食品',3,'百货') 部门,
             round(sum(i.target)/10000,2) 日指标, round(sum(i.t_sal)/10000,2) 销售, round(sum(i.t_sal)/sum(i.target)*100,2) 达成,round(sum(i.l_sal)/10000,2) 同期销售, round(sum(i.t_sal-i.l_sal)/10000,2) 增长额, 
             round(sum(i.t_sal-i.l_sal)/sum(i.l_sal)*100,2) 增长率,
             round(sum(i.t_sal+h.g_tsal)/10000,2) 月销售,round(sum(h.target)/10000,2) 月指标,round(sum(i.t_sal+h.g_tsal)/sum(h.target)*100,2) 月达成,round(sum(i.t_sal+h.g_tsal-h.g_lsal)/10000,2) 月增长,round(sum(i.t_sal+h.g_tsal-h.g_lsal)/sum(h.g_lsal)*100,2) 月增长率,
             sum(i.t_visit) 来客, sum(i.l_visit) 同期来客, sum(i.t_visit-i.l_visit) 增长额, round(sum(i.t_visit-i.l_visit)/sum(i.l_visit)*100,2) 增长率,
             round(sum(i.t_visit+h.g_tvisit)/to_number(to_char(trunc(sysdate),'dd')),0) 月日均来客,round(sum(h.g_lvisit)/to_number(to_char(trunc(sysdate),'dd')) ,0) 月同期日均来客,round(sum(i.t_visit+h.g_tvisit)/to_number(to_char(trunc(sysdate),'dd')),0)-round(sum(h.g_lvisit)/to_number(to_char(trunc(sysdate),'dd')),0) 月日均来客增长,
             round((sum(i.t_visit+h.g_tvisit)-sum(h.g_lvisit))*100/(sum(h.g_lvisit)),2) 月日均来客增长率,
             round(sum(i.t_sal)/sum(i.t_visit),2) 客单, round(sum(i.l_sal)/sum(i.l_visit),2) 同期客单, 
             round(sum(i.t_sal)/sum(i.t_visit),2)-round(sum(i.l_sal)/sum(i.l_visit),2) 增长额, 
             round((sum(i.t_sal)/sum(i.t_visit)-sum(i.l_sal)/sum(i.l_visit))/(sum(i.l_sal)/sum(i.l_visit))*100,2) 增长率,
             round(sum(i.t_sal+h.g_tsal)/sum(i.t_visit+h.g_tvisit),2) 月客单,round(sum(h.g_lsal)/sum(h.g_lvisit),2) 月同期客单, round(sum(i.t_sal+h.g_tsal)/sum(i.t_visit+h.g_tvisit)-sum(h.g_lsal)/sum(h.g_lvisit),2) 月客单增长,round((sum(i.t_sal+h.g_tsal)/sum(i.t_visit+h.g_tvisit)-sum(h.g_lsal)/sum(h.g_lvisit))/(sum(h.g_lsal)/sum(h.g_lvisit))*100,2) 月客单增长率
      from erp_div_ind i,erp_div_heap h
      where i.name not like '%大厂%'
            and i.new_store_no=h.location
            and i.div=3
            and i.div=h.div
      group by i.div,rollup(i.area_no, i.name)'''</span><span class="token punctuation">,</span> <span class="token string">'部门销售-百货'</span><span class="token punctuation">,</span> <span class="token string">'bh_ind.xls'</span><span class="token punctuation">,</span> <span class="token string">'bh_ind.png'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token triple-quoted-string string">'''with step1 as(
        select decode(t2.division,1,'1生鲜',2,'2食品',3,'3百货','其他') 部门, 
               case when(t2.buyer_uid like '%NF2%') then '硬百'
               when(t2.buyer_uid like '%NF10%') then '软百'
               else t2.buyer_uid end 采购,
               sum(target) target, sum(t_sal) t_sal, sum(l_sal) l_sal, sum(t_visit) t_visit, sum(l_visit) l_visit 
        from erp_group_ind t1, 
               (select t2.division, name, wm_concat(distinct t1.buyer_uid) buyer_uid 
                from erp_buyer_info t1, groups t2 
                where t1.group_no=t2.group_no group by division, name) t2
        where t1.name = t2.name
        group by t2.division, t2.buyer_uid
        ),
        step2 as(
        select decode(t2.division,1,'1生鲜',2,'2食品',3,'3百货','其他') 部门, 
               case when(t2.buyer_uid like '%NF2%') then '硬百'
               when(t2.buyer_uid like '%NF10%') then '软百'
               else t2.buyer_uid end 采购, division,
               --decode(substr(t2.buyer_uid,1,3),'NF2','软百','NF1','硬百',t2.buyer_uid) 采购, 
               sum(target) g_target, sum(g_tsal) g_tsal, sum(g_lsal) g_lsal, sum(g_tvisit) g_tvisit, sum(g_lvisit)g_lvisit 
        from erp_group_heap t1, 
               (select t2.division, name, wm_concat(distinct t1.buyer_uid) buyer_uid 
                from erp_buyer_info t1, groups t2 
                where t1.group_no=t2.group_no group by division, name) t2
        where t1.name = t2.name
        group by t2.division, t2.buyer_uid
        )
        select case when(lag(t2.部门) over(order by t2.部门, t2.采购) = t2.部门 and grouping(t2.采购) = 0) then '' 
                    else decode(grouping(t2.部门)+grouping(t2.采购),1,'小计',2,'总计', substr(t2.部门,2)) end  部门, 
               decode(grouping(t2.采购),1,count(*)||'条',t2.采购) 采购,
               round(sum(t1.target)/10000,2) 日指标, round(sum(t_sal)/10000,2) 销售, round(sum(t_sal)/sum(target)*100,2) 达成, round(sum(l_sal)/10000,2) 同期,
               round((sum(t_sal)-sum(l_sal))/10000,2) 增长, round(decode(sum(l_sal),0,0,(sum(t_sal)-sum(l_sal))/sum(l_sal)*100),2) 增长率,
               round((sum(g_tsal)+sum(t_sal))/10000,2) 月销售, round(sum(t2.g_target)/10000,2) 月指标, round((sum(g_tsal)+sum(t_sal))/sum(g_target)*100,2) 达成, 
               round(decode(sum(g_lsal),0,0,(sum(g_tsal)+sum(t_sal)-sum(g_lsal))/sum(g_lsal)*100),2) 增长率,
               sum(t_visit) 来客, sum(t_visit)-sum(l_visit) 增长, round((sum(t_visit)-sum(l_visit))/sum(l_visit)*100,2) 增长率,
               round((sum(g_tvisit)+sum(t_visit))/to_char(sysdate,'DD')) 来客, 
               round((sum(g_tvisit)+sum(t_visit)-sum(g_lvisit))/to_char(sysdate,'DD')) 增长, 
               round((sum(g_tvisit)+sum(t_visit)-sum(g_lvisit))/sum(g_lvisit)*100,2) 增长率,
               round(sum(t_sal)/sum(t_visit),2) 客单, 
               round((sum(t_sal)/sum(t_visit)-sum(l_sal)/sum(l_visit))/(sum(l_sal)/sum(l_visit))*100,2) 增长率,
               round((sum(g_tsal)+sum(t_sal))/(sum(g_tvisit)+sum(t_visit)),2) 客单, 
               round(((sum(g_tsal)+sum(t_sal))/(sum(g_tvisit)+sum(t_visit))-sum(g_lsal)/sum(g_lvisit))/(sum(g_lsal)/sum(g_lvisit))*100,2) 增长率   
        from step1 t1, step2 t2
        where t1.采购 = t2.采购
        group by rollup(t2.部门,t2.采购)'''</span><span class="token punctuation">,</span> <span class="token string">'时段销售-采购'</span><span class="token punctuation">,</span> <span class="token string">'group_cnt.xls'</span><span class="token punctuation">,</span> <span class="token string">'group_cnt.png'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token triple-quoted-string string">'''with step1 as(
      Select t1.area_no,t.new_store_no,t.ds,t.Name,row_number()
      over( order by decode(t.l_sal,0,0,(t.t_sal-t.l_sal)*100/t.l_sal) desc) rank,
      t.t_sal , round(decode(t.l_sal,0,0,(t.t_sal-t.l_sal)*100/t.l_sal),2) s_zzv,
      t.t_visit,t.l_visit,
       round(decode(t.l_visit,0,0,(t.t_visit-t.l_visit)*100/t.l_visit),2) v_zzv,t.l_sal
       From erp_ds_ind t,store_compare t1
      Where t.new_store_no=t1.new_store_no and t1.old_store_no != 16
      And t1.area_no In(51,11)
      And t.ds='菜'
      ),
      step2 as(
      Select t1.area_no,t.location,t.ds_type,
      t.ds_tsal ,t.ds_tvisit,t.ds_lvisit,t.ds_lsal
       From erp_ds_heap t,store_compare t1
      Where t.location=t1.new_store_no and t1.old_store_no != 16
      And t1.area_no In(51,11)
      And t.ds_type='菜'
      ),
      step3 as(
      Select t.Location,t.t_visit
      From erp_st_ind t,store_compare t1
      Where t.Location=t1.new_store_no
      And t1.area_no In(51,11)
      ),
      step4 as(
      select wm_concat(ds)品类,decode(grouping(t1.name),1,count(*)||'条',t1.name) 店名,to_number(decode(grouping(name),1,null,sum(rank))) 名次,
             Sum(t1.t_sal) 销售额,
             round(decode(sum(t1.l_sal),0,0,(Sum(t1.t_sal)-sum(t1.l_sal))/sum(t1.l_sal))*100,2) 增长率,Sum(t1.t_visit) 来客,
             round(decode(sum(t1.l_visit),0,0,(Sum(t1.t_visit)-sum(t1.l_visit))/sum(t1.l_visit))*100,2) 来客增长率,
             decode(Sum(t2.t_visit),0,0,round(Sum(t1.t_visit)/Sum(t2.t_visit)*100,2)) 渗透率,
             decode(Sum(t1.t_visit),0,0,round(Sum(t1.t_sal)/Sum(t1.t_visit),2)) 客单,
             decode(sum(round(decode(t1.l_visit,0,0,t1.l_sal/t1.l_visit),2)),0,0,
             round(Sum( (round(decode(t1.t_visit,0,0,t1.t_sal/t1.t_visit),2)-round(decode(t1.l_visit,0,0,t1.l_sal/t1.l_visit),2)))*100/
            sum(round(decode(t1.l_visit,0,0,t1.l_sal/t1.l_visit),2)),2)) 客单增长率,Sum(t1.t_sal+t3.ds_tsal) 月销售额,
             round(decode(sum(t3.ds_lsal),0,0,(Sum(t1.t_sal+t3.ds_tsal)-sum(t3.ds_lsal))/sum(t3.ds_lsal))*100,2) 月增长率,round(Sum(t3.ds_tvisit+t1.t_visit)/to_char(sysdate,'DD'),0) 月日均来客,
             round(decode(sum(t3.ds_lvisit),0,0,(Sum(t1.t_visit+t3.ds_tvisit)-sum(t3.ds_lvisit))/sum(t3.ds_lvisit))*100,2) 月来客增长率 
           from step1 t1, step3 t2,step2 t3
      where t1.new_store_no = t2.Location
            and t1.new_store_no=t3.location
            and t1.ds=t3.ds_type
      group by rollup(t1.Name)
      )
      select case when(length(品类) &gt; 5) then '总计' when(lag(品类,1) over(order by 名次) = 品类) then '' else 品类 end 品类,
             店名, 名次, 销售额, 增长率, 来客, 来客增长率, 渗透率, 客单, 客单增长率,月销售额,月增长率,月日均来客,月来客增长率
      from step4'''</span><span class="token punctuation">,</span> <span class="token string">'生鲜重点品类销售-菜'</span><span class="token punctuation">,</span> <span class="token string">'ds_veg.xls'</span><span class="token punctuation">,</span> <span class="token string">'ds_veg.png'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token triple-quoted-string string">'''with step1 as(
      Select t1.area_no,t.new_store_no,t.ds,t.Name,row_number()
      over( order by decode(t.l_sal,0,0,(t.t_sal-t.l_sal)*100/t.l_sal) desc) rank,
      t.t_sal , round(decode(t.l_sal,0,0,(t.t_sal-t.l_sal)*100/t.l_sal),2) s_zzv,
      t.t_visit,t.l_visit,
       round(decode(t.l_visit,0,0,(t.t_visit-t.l_visit)*100/t.l_visit),2) v_zzv,t.l_sal
       From erp_ds_ind t,store_compare t1
      Where t.new_store_no=t1.new_store_no and t1.old_store_no != 16
      And t1.area_no In(51,11)
      And t.ds='果'
      ),
      step2 as(
      Select t1.area_no,t.location,t.ds_type,
      t.ds_tsal ,t.ds_tvisit,t.ds_lvisit,t.ds_lsal
       From erp_ds_heap t,store_compare t1
      Where t.location=t1.new_store_no and t1.old_store_no != 16
      And t1.area_no In(51,11)
      And t.ds_type='果'
      ),
      step3 as(
      Select t.Location,t.t_visit
      From erp_st_ind t,store_compare t1
      Where t.Location=t1.new_store_no
      And t1.area_no In(51,11)
      ),
      step4 as(
      select wm_concat(ds)品类,decode(grouping(t1.name),1,count(*)||'条',t1.name) 店名,to_number(decode(grouping(name),1,null,sum(rank))) 名次,
             Sum(t1.t_sal) 销售额,
             round(decode(sum(t1.l_sal),0,0,(Sum(t1.t_sal)-sum(t1.l_sal))/sum(t1.l_sal))*100,2) 增长率,Sum(t1.t_visit) 来客,
             round(decode(sum(t1.l_visit),0,0,(Sum(t1.t_visit)-sum(t1.l_visit))/sum(t1.l_visit))*100,2) 来客增长率,
             decode(Sum(t2.t_visit),0,0,round(Sum(t1.t_visit)/Sum(t2.t_visit)*100,2)) 渗透率,
             decode(Sum(t1.t_visit),0,0,round(Sum(t1.t_sal)/Sum(t1.t_visit),2)) 客单,
             decode(sum(round(decode(t1.l_visit,0,0,t1.l_sal/t1.l_visit),2)),0,0,
             round(Sum( (round(decode(t1.t_visit,0,0,t1.t_sal/t1.t_visit),2)-round(decode(t1.l_visit,0,0,t1.l_sal/t1.l_visit),2)))*100/
            sum(round(decode(t1.l_visit,0,0,t1.l_sal/t1.l_visit),2)),2)) 客单增长率,Sum(t1.t_sal+t3.ds_tsal) 月销售额,
             round(decode(sum(t3.ds_lsal),0,0,(Sum(t1.t_sal+t3.ds_tsal)-sum(t3.ds_lsal))/sum(t3.ds_lsal))*100,2) 月增长率,round(Sum(t3.ds_tvisit+t1.t_visit)/to_char(sysdate,'DD'),0) 月日均来客,
             round(decode(sum(t3.ds_lvisit),0,0,(Sum(t1.t_visit+t3.ds_tvisit)-sum(t3.ds_lvisit))/sum(t3.ds_lvisit))*100,2) 月来客增长率 
           from step1 t1, step3 t2,step2 t3
      where t1.new_store_no = t2.Location
            and t1.new_store_no=t3.location
            and t1.ds=t3.ds_type
      group by rollup(t1.Name)
      )
      select case when(length(品类) &gt; 5) then '总计' when(lag(品类,1) over(order by 名次) = 品类) then '' else 品类 end 品类,
             店名, 名次, 销售额, 增长率, 来客, 来客增长率, 渗透率, 客单, 客单增长率,月销售额,月增长率,月日均来客,月来客增长率
      from step4'''</span><span class="token punctuation">,</span> <span class="token string">'生鲜重点品类销售-果'</span><span class="token punctuation">,</span> <span class="token string">'ds_fruit.xls'</span><span class="token punctuation">,</span> <span class="token string">'ds_fruit.png'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token triple-quoted-string string">'''with step1 as(
      Select t1.area_no,t.new_store_no,t.ds,t.Name,row_number()
      over( order by decode(t.l_sal,0,0,(t.t_sal-t.l_sal)*100/t.l_sal) desc) rank,
      t.t_sal , round(decode(t.l_sal,0,0,(t.t_sal-t.l_sal)*100/t.l_sal),2) s_zzv,
      t.t_visit,t.l_visit,
       round(decode(t.l_visit,0,0,(t.t_visit-t.l_visit)*100/t.l_visit),2) v_zzv,t.l_sal
       From erp_ds_ind t,store_compare t1
      Where t.new_store_no=t1.new_store_no and t1.old_store_no != 16
      And t1.area_no In(51,11)
      And t.ds='冷冻'
      ),
      step2 as(
      Select t1.area_no,t.location,t.ds_type,
      t.ds_tsal ,t.ds_tvisit,t.ds_lvisit,t.ds_lsal
       From erp_ds_heap t,store_compare t1
      Where t.location=t1.new_store_no and t1.old_store_no != 16
      And t1.area_no In(51,11)
      And t.ds_type='冷冻'
      ),
      step3 as(
      Select t.Location,t.t_visit
      From erp_st_ind t,store_compare t1
      Where t.Location=t1.new_store_no
      And t1.area_no In(51,11)
      ),
      step4 as(
      select wm_concat(ds)品类,decode(grouping(t1.name),1,count(*)||'条',t1.name) 店名,to_number(decode(grouping(name),1,null,sum(rank))) 名次,
             Sum(t1.t_sal) 销售额,
             round(decode(sum(t1.l_sal),0,0,(Sum(t1.t_sal)-sum(t1.l_sal))/sum(t1.l_sal))*100,2) 增长率,Sum(t1.t_visit) 来客,
             round(decode(sum(t1.l_visit),0,0,(Sum(t1.t_visit)-sum(t1.l_visit))/sum(t1.l_visit))*100,2) 来客增长率,
             decode(Sum(t2.t_visit),0,0,round(Sum(t1.t_visit)/Sum(t2.t_visit)*100,2)) 渗透率,
             decode(Sum(t1.t_visit),0,0,round(Sum(t1.t_sal)/Sum(t1.t_visit),2)) 客单,
             decode(sum(round(decode(t1.l_visit,0,0,t1.l_sal/t1.l_visit),2)),0,0,
             round(Sum( (round(decode(t1.t_visit,0,0,t1.t_sal/t1.t_visit),2)-round(decode(t1.l_visit,0,0,t1.l_sal/t1.l_visit),2)))*100/
            sum(round(decode(t1.l_visit,0,0,t1.l_sal/t1.l_visit),2)),2)) 客单增长率,Sum(t1.t_sal+t3.ds_tsal) 月销售额,
             round(decode(sum(t3.ds_lsal),0,0,(Sum(t1.t_sal+t3.ds_tsal)-sum(t3.ds_lsal))/sum(t3.ds_lsal))*100,2) 月增长率,round(Sum(t3.ds_tvisit+t1.t_visit)/to_char(sysdate,'DD'),0) 月日均来客,
             round(decode(sum(t3.ds_lvisit),0,0,(Sum(t1.t_visit+t3.ds_tvisit)-sum(t3.ds_lvisit))/sum(t3.ds_lvisit))*100,2) 月来客增长率 
           from step1 t1, step3 t2,step2 t3
      where t1.new_store_no = t2.Location
            and t1.new_store_no=t3.location
            and t1.ds=t3.ds_type
      group by rollup(t1.Name)
      )
      select case when(length(品类) &gt; 5) then '总计' when(lag(品类,1) over(order by 名次) = 品类) then '' else 品类 end 品类,
             店名, 名次, 销售额, 增长率, 来客, 来客增长率, 渗透率, 客单, 客单增长率,月销售额,月增长率,月日均来客,月来客增长率
      from step4'''</span><span class="token punctuation">,</span> <span class="token string">'生鲜重点品类销售-冷冻水产'</span><span class="token punctuation">,</span> <span class="token string">'ds_frozen.xls'</span><span class="token punctuation">,</span> <span class="token string">'ds_frozen.png'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token triple-quoted-string string">'''with step1 as(
      Select t1.area_no,t.new_store_no,t.ds,t.Name,row_number()
      over( order by decode(t.l_sal,0,0,(t.t_sal-t.l_sal)*100/t.l_sal) desc) rank,
      t.t_sal , round(decode(t.l_sal,0,0,(t.t_sal-t.l_sal)*100/t.l_sal),2) s_zzv,
      t.t_visit,t.l_visit,
       round(decode(t.l_visit,0,0,(t.t_visit-t.l_visit)*100/t.l_visit),2) v_zzv,t.l_sal
       From erp_ds_ind t,store_compare t1
      Where t.new_store_no=t1.new_store_no and t1.old_store_no != 16
      And t1.area_no In(51,11)
      And t.ds='牛肉'
      ),
      step2 as(
      Select t1.area_no,t.location,t.ds_type,
      t.ds_tsal ,t.ds_tvisit,t.ds_lvisit,t.ds_lsal
       From erp_ds_heap t,store_compare t1
      Where t.location=t1.new_store_no and t1.old_store_no != 16
      And t1.area_no In(51,11)
      And t.ds_type='牛肉'
      ),
      step3 as(
      Select t.Location,t.t_visit
      From erp_st_ind t,store_compare t1
      Where t.Location=t1.new_store_no
      And t1.area_no In(51,11)
      ),
      step4 as(
      select wm_concat(ds)品类,decode(grouping(t1.name),1,count(*)||'条',t1.name) 店名,to_number(decode(grouping(name),1,null,sum(rank))) 名次,
             Sum(t1.t_sal) 销售额,
             round(decode(sum(t1.l_sal),0,0,(Sum(t1.t_sal)-sum(t1.l_sal))/sum(t1.l_sal))*100,2) 增长率,Sum(t1.t_visit) 来客,
             round(decode(sum(t1.l_visit),0,0,(Sum(t1.t_visit)-sum(t1.l_visit))/sum(t1.l_visit))*100,2) 来客增长率,
             decode(Sum(t2.t_visit),0,0,round(Sum(t1.t_visit)/Sum(t2.t_visit)*100,2)) 渗透率,
             decode(Sum(t1.t_visit),0,0,round(Sum(t1.t_sal)/Sum(t1.t_visit),2)) 客单,
             decode(sum(round(decode(t1.l_visit,0,0,t1.l_sal/t1.l_visit),2)),0,0,
             round(Sum( (round(decode(t1.t_visit,0,0,t1.t_sal/t1.t_visit),2)-round(decode(t1.l_visit,0,0,t1.l_sal/t1.l_visit),2)))*100/
            sum(round(decode(t1.l_visit,0,0,t1.l_sal/t1.l_visit),2)),2)) 客单增长率,Sum(t1.t_sal+t3.ds_tsal) 月销售额,
             round(decode(sum(t3.ds_lsal),0,0,(Sum(t1.t_sal+t3.ds_tsal)-sum(t3.ds_lsal))/sum(t3.ds_lsal))*100,2) 月增长率,round(Sum(t3.ds_tvisit+t1.t_visit)/to_char(sysdate,'DD'),0) 月日均来客,
             round(decode(sum(t3.ds_lvisit),0,0,(Sum(t1.t_visit+t3.ds_tvisit)-sum(t3.ds_lvisit))/sum(t3.ds_lvisit))*100,2) 月来客增长率 
           from step1 t1, step3 t2,step2 t3
      where t1.new_store_no = t2.Location
            and t1.new_store_no=t3.location
            and t1.ds=t3.ds_type
      group by rollup(t1.Name)
      )
      select case when(length(品类) &gt; 5) then '总计' when(lag(品类,1) over(order by 名次) = 品类) then '' else 品类 end 品类,
             店名, 名次, 销售额, 增长率, 来客, 来客增长率, 渗透率, 客单, 客单增长率,月销售额,月增长率,月日均来客,月来客增长率
      from step4'''</span><span class="token punctuation">,</span> <span class="token string">'生鲜重点品类销售-牛肉'</span><span class="token punctuation">,</span> <span class="token string">'ds_beef.xls'</span><span class="token punctuation">,</span> <span class="token string">'ds_beef.png'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token triple-quoted-string string">'''with step1 as(
      Select t1.area_no,t.new_store_no,t.ds,t.Name,row_number()
      over( order by decode(t.l_sal,0,0,(t.t_sal-t.l_sal)*100/t.l_sal) desc) rank,
      t.t_sal , round(decode(t.l_sal,0,0,(t.t_sal-t.l_sal)*100/t.l_sal),2) s_zzv,
      t.t_visit,t.l_visit,
       round(decode(t.l_visit,0,0,(t.t_visit-t.l_visit)*100/t.l_visit),2) v_zzv,t.l_sal
       From erp_ds_ind t,store_compare t1
      Where t.new_store_no=t1.new_store_no and t1.old_store_no != 16
      And t1.area_no In(51,11)
      And t.ds='禽'
      ),
      step2 as(
      Select t1.area_no,t.location,t.ds_type,
      t.ds_tsal ,t.ds_tvisit,t.ds_lvisit,t.ds_lsal
       From erp_ds_heap t,store_compare t1
      Where t.location=t1.new_store_no and t1.old_store_no != 16
      And t1.area_no In(51,11)
      And t.ds_type='禽'
      ),
      step3 as(
      Select t.Location,t.t_visit
      From erp_st_ind t,store_compare t1
      Where t.Location=t1.new_store_no
      And t1.area_no In(51,11)
      ),
      step4 as(
      select wm_concat(ds)品类,decode(grouping(t1.name),1,count(*)||'条',t1.name) 店名,to_number(decode(grouping(name),1,null,sum(rank))) 名次,
             Sum(t1.t_sal) 销售额,
             round(decode(sum(t1.l_sal),0,0,(Sum(t1.t_sal)-sum(t1.l_sal))/sum(t1.l_sal))*100,2) 增长率,Sum(t1.t_visit) 来客,
             round(decode(sum(t1.l_visit),0,0,(Sum(t1.t_visit)-sum(t1.l_visit))/sum(t1.l_visit))*100,2) 来客增长率,
             decode(Sum(t2.t_visit),0,0,round(Sum(t1.t_visit)/Sum(t2.t_visit)*100,2)) 渗透率,
             decode(Sum(t1.t_visit),0,0,round(Sum(t1.t_sal)/Sum(t1.t_visit),2)) 客单,
             decode(sum(round(decode(t1.l_visit,0,0,t1.l_sal/t1.l_visit),2)),0,0,
             round(Sum( (round(decode(t1.t_visit,0,0,t1.t_sal/t1.t_visit),2)-round(decode(t1.l_visit,0,0,t1.l_sal/t1.l_visit),2)))*100/
            sum(round(decode(t1.l_visit,0,0,t1.l_sal/t1.l_visit),2)),2)) 客单增长率,Sum(t1.t_sal+t3.ds_tsal) 月销售额,
             round(decode(sum(t3.ds_lsal),0,0,(Sum(t1.t_sal+t3.ds_tsal)-sum(t3.ds_lsal))/sum(t3.ds_lsal))*100,2) 月增长率,round(Sum(t3.ds_tvisit+t1.t_visit)/to_char(sysdate,'DD'),0) 月日均来客,
             round(decode(sum(t3.ds_lvisit),0,0,(Sum(t1.t_visit+t3.ds_tvisit)-sum(t3.ds_lvisit))/sum(t3.ds_lvisit))*100,2) 月来客增长率 
           from step1 t1, step3 t2,step2 t3
      where t1.new_store_no = t2.Location
            and t1.new_store_no=t3.location
            and t1.ds=t3.ds_type
      group by rollup(t1.Name)
      )
      select case when(length(品类) &gt; 5) then '总计' when(lag(品类,1) over(order by 名次) = 品类) then '' else 品类 end 品类,
             店名, 名次, 销售额, 增长率, 来客, 来客增长率, 渗透率, 客单, 客单增长率,月销售额,月增长率,月日均来客,月来客增长率
      from step4'''</span><span class="token punctuation">,</span> <span class="token string">'生鲜重点品类销售-禽'</span><span class="token punctuation">,</span> <span class="token string">'ds_fowl.xls'</span><span class="token punctuation">,</span> <span class="token string">'ds_fowl.png'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token triple-quoted-string string">'''with step1 as(
      Select t1.area_no,t.new_store_no,t.ds,t.Name,row_number()
      over( order by decode(t.l_sal,0,0,(t.t_sal-t.l_sal)*100/t.l_sal) desc) rank,
      t.t_sal , round(decode(t.l_sal,0,0,(t.t_sal-t.l_sal)*100/t.l_sal),2) s_zzv,
      t.t_visit,t.l_visit,
       round(decode(t.l_visit,0,0,(t.t_visit-t.l_visit)*100/t.l_visit),2) v_zzv,t.l_sal
       From erp_ds_ind t,store_compare t1
      Where t.new_store_no=t1.new_store_no and t1.old_store_no != 16
      And t1.area_no In(51,11)
      And t.ds='肉'
      ),
      step2 as(
      Select t1.area_no,t.location,t.ds_type,
      t.ds_tsal ,t.ds_tvisit,t.ds_lvisit,t.ds_lsal
       From erp_ds_heap t,store_compare t1
      Where t.location=t1.new_store_no and t1.old_store_no != 16
      And t1.area_no In(51,11)
      And t.ds_type='肉'
      ),
      step3 as(
      Select t.Location,t.t_visit
      From erp_st_ind t,store_compare t1
      Where t.Location=t1.new_store_no
      And t1.area_no In(51,11)
      ),
      step4 as(
      select wm_concat(ds)品类,decode(grouping(t1.name),1,count(*)||'条',t1.name) 店名,to_number(decode(grouping(name),1,null,sum(rank))) 名次,
             Sum(t1.t_sal) 销售额,
             round(decode(sum(t1.l_sal),0,0,(Sum(t1.t_sal)-sum(t1.l_sal))/sum(t1.l_sal))*100,2) 增长率,Sum(t1.t_visit) 来客,
             round(decode(sum(t1.l_visit),0,0,(Sum(t1.t_visit)-sum(t1.l_visit))/sum(t1.l_visit))*100,2) 来客增长率,
             decode(Sum(t2.t_visit),0,0,round(Sum(t1.t_visit)/Sum(t2.t_visit)*100,2)) 渗透率,
             decode(Sum(t1.t_visit),0,0,round(Sum(t1.t_sal)/Sum(t1.t_visit),2)) 客单,
             decode(sum(round(decode(t1.l_visit,0,0,t1.l_sal/t1.l_visit),2)),0,0,
             round(Sum( (round(decode(t1.t_visit,0,0,t1.t_sal/t1.t_visit),2)-round(decode(t1.l_visit,0,0,t1.l_sal/t1.l_visit),2)))*100/
            sum(round(decode(t1.l_visit,0,0,t1.l_sal/t1.l_visit),2)),2)) 客单增长率,Sum(t1.t_sal+t3.ds_tsal) 月销售额,
             round(decode(sum(t3.ds_lsal),0,0,(Sum(t1.t_sal+t3.ds_tsal)-sum(t3.ds_lsal))/sum(t3.ds_lsal))*100,2) 月增长率,round(Sum(t3.ds_tvisit+t1.t_visit)/to_char(sysdate,'DD'),0) 月日均来客,
             round(decode(sum(t3.ds_lvisit),0,0,(Sum(t1.t_visit+t3.ds_tvisit)-sum(t3.ds_lvisit))/sum(t3.ds_lvisit))*100,2) 月来客增长率 
           from step1 t1, step3 t2,step2 t3
      where t1.new_store_no = t2.Location
            and t1.new_store_no=t3.location
            and t1.ds=t3.ds_type
      group by rollup(t1.Name)
      )
      select case when(length(品类) &gt; 5) then '总计' when(lag(品类,1) over(order by 名次) = 品类) then '' else 品类 end 品类,
             店名, 名次, 销售额, 增长率, 来客, 来客增长率, 渗透率, 客单, 客单增长率,月销售额,月增长率,月日均来客,月来客增长率
      from step4'''</span><span class="token punctuation">,</span> <span class="token string">'生鲜重点品类销售-肉'</span><span class="token punctuation">,</span> <span class="token string">'ds_meat.xls'</span><span class="token punctuation">,</span> <span class="token string">'ds_meat.png'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token triple-quoted-string string">'''with step1 as(
      Select t1.area_no,t.new_store_no,t.ds,t.Name,row_number()
      over( order by decode(t.l_sal,0,0,(t.t_sal-t.l_sal)*100/t.l_sal) desc) rank,
      t.t_sal , round(decode(t.l_sal,0,0,(t.t_sal-t.l_sal)*100/t.l_sal),2) s_zzv,
      t.t_visit,t.l_visit,
       round(decode(t.l_visit,0,0,(t.t_visit-t.l_visit)*100/t.l_visit),2) v_zzv,t.l_sal
       From erp_ds_ind t,store_compare t1
      Where t.new_store_no=t1.new_store_no and t1.old_store_no != 16
      And t1.area_no In(51,11)
      And t.ds='鲜活'
      ),
      step2 as(
      Select t1.area_no,t.location,t.ds_type,
      t.ds_tsal ,t.ds_tvisit,t.ds_lvisit,t.ds_lsal
       From erp_ds_heap t,store_compare t1
      Where t.location=t1.new_store_no and t1.old_store_no != 16
      And t1.area_no In(51,11)
      And t.ds_type='鲜活'
      ),
      step3 as(
      Select t.Location,t.t_visit
      From erp_st_ind t,store_compare t1
      Where t.Location=t1.new_store_no
      And t1.area_no In(51,11)
      ),
      step4 as(
      select wm_concat(ds)品类,decode(grouping(t1.name),1,count(*)||'条',t1.name) 店名,to_number(decode(grouping(name),1,null,sum(rank))) 名次,
             Sum(t1.t_sal) 销售额,
             round(decode(sum(t1.l_sal),0,0,(Sum(t1.t_sal)-sum(t1.l_sal))/sum(t1.l_sal))*100,2) 增长率,Sum(t1.t_visit) 来客,
             round(decode(sum(t1.l_visit),0,0,(Sum(t1.t_visit)-sum(t1.l_visit))/sum(t1.l_visit))*100,2) 来客增长率,
             decode(Sum(t2.t_visit),0,0,round(Sum(t1.t_visit)/Sum(t2.t_visit)*100,2)) 渗透率,
             decode(Sum(t1.t_visit),0,0,round(Sum(t1.t_sal)/Sum(t1.t_visit),2)) 客单,
             decode(sum(round(decode(t1.l_visit,0,0,t1.l_sal/t1.l_visit),2)),0,0,
             round(Sum( (round(decode(t1.t_visit,0,0,t1.t_sal/t1.t_visit),2)-round(decode(t1.l_visit,0,0,t1.l_sal/t1.l_visit),2)))*100/
            sum(round(decode(t1.l_visit,0,0,t1.l_sal/t1.l_visit),2)),2)) 客单增长率,Sum(t1.t_sal+t3.ds_tsal) 月销售额,
             round(decode(sum(t3.ds_lsal),0,0,(Sum(t1.t_sal+t3.ds_tsal)-sum(t3.ds_lsal))/sum(t3.ds_lsal))*100,2) 月增长率,round(Sum(t3.ds_tvisit+t1.t_visit)/to_char(sysdate,'DD'),0) 月日均来客,
             round(decode(sum(t3.ds_lvisit),0,0,(Sum(t1.t_visit+t3.ds_tvisit)-sum(t3.ds_lvisit))/sum(t3.ds_lvisit))*100,2) 月来客增长率 
           from step1 t1, step3 t2,step2 t3
      where t1.new_store_no = t2.Location
            and t1.new_store_no=t3.location
            and t1.ds=t3.ds_type
      group by rollup(t1.Name)
      )
      select case when(length(品类) &gt; 5) then '总计' when(lag(品类,1) over(order by 名次) = 品类) then '' else 品类 end 品类,
             店名, 名次, 销售额, 增长率, 来客, 来客增长率, 渗透率, 客单, 客单增长率,月销售额,月增长率,月日均来客,月来客增长率
      from step4'''</span><span class="token punctuation">,</span> <span class="token string">'生鲜重点品类销售-鲜活'</span><span class="token punctuation">,</span> <span class="token string">'ds_alive.xls'</span><span class="token punctuation">,</span> <span class="token string">'ds_alive.png'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token triple-quoted-string string">'''with step1 as(
      select decode(t2.division,1,'1生鲜',2,'2食品',3,'3百货','其他') 部门, 
             case when(t2.buyer_uid like '%NF2%') then '硬百'
             when(t2.buyer_uid like '%NF10%') then '软百'
             else t2.buyer_uid end 采购,
             sum(target) target, sum(t_sal) t_sal, sum(l_sal) l_sal, sum(t_visit) t_visit, sum(l_visit) l_visit 
      from erp_group_ind t1, 
             (select t2.division, name, wm_concat(distinct t1.buyer_uid) buyer_uid 
              from erp_buyer_info t1, groups t2 
              where t1.group_no=t2.group_no group by division, name) t2
      where t1.name = t2.name
            and t1.area_no=51
      group by t2.division, t2.buyer_uid
      ),
      step2 as(
      select decode(t2.division,1,'1生鲜',2,'2食品',3,'3百货','其他') 部门, 
             case when(t2.buyer_uid like '%NF2%') then '硬百'
             when(t2.buyer_uid like '%NF10%') then '软百'
             else t2.buyer_uid end 采购, division,
             --decode(substr(t2.buyer_uid,1,3),'NF2','软百','NF1','硬百',t2.buyer_uid) 采购, 
             sum(target) g_target, sum(g_tsal) g_tsal, sum(g_lsal) g_lsal, sum(g_tvisit) g_tvisit, sum(g_lvisit)g_lvisit 
      from erp_group_heap t1, 
             (select t2.division, name, wm_concat(distinct t1.buyer_uid) buyer_uid 
              from erp_buyer_info t1, groups t2 
              where t1.group_no=t2.group_no group by division, name) t2
      where t1.name = t2.name
            and t1.area_no=51
      group by t2.division, t2.buyer_uid
      )
      select decode(grouping(t2.部门)+grouping(t2.采购),1,'小计',2,'总计', substr(t2.部门,2)) 部门, 
             decode(grouping(t2.采购),1,count(*)||'条',t2.采购) 采购,
             round(sum(t1.target)/10000,2) 日指标, round(sum(t_sal)/10000,2) 日销售, round(sum(t_sal)/sum(target)*100,2) 日达成, round(sum(l_sal)/10000,2) 日同期,
             round((sum(t_sal)-sum(l_sal))/10000,2) 日增长, round(decode(sum(l_sal),0,0,(sum(t_sal)-sum(l_sal))/sum(l_sal)*100),2) 日增长率,
             round((sum(g_tsal)+sum(t_sal))/10000,2) 月销售, round(sum(t2.g_target)/10000,2) 月指标, round((sum(g_tsal)+sum(t_sal))/sum(g_target)*100,2) 月达成, 
             round(decode(sum(g_lsal),0,0,(sum(g_tsal)+sum(t_sal)-sum(g_lsal))/sum(g_lsal)*100),2) 月增长率,
             sum(t_visit) 日来客, sum(t_visit)-sum(l_visit) 增长, round((sum(t_visit)-sum(l_visit))/sum(l_visit)*100,2) 增长率,
             round((sum(g_tvisit)+sum(t_visit))/to_char(sysdate,'DD'),0) 月来客, 
             round((sum(g_tvisit)+sum(t_visit)-sum(g_lvisit))/to_char(sysdate,'DD'),0) 增长, 
             round((sum(g_tvisit)+sum(t_visit)-sum(g_lvisit))/sum(g_lvisit)*100,2) 增长率,
             round(sum(t_sal)/sum(t_visit),2) 日客单, 
             round((sum(t_sal)/sum(t_visit)-sum(l_sal)/sum(l_visit))/(sum(l_sal)/sum(l_visit))*100,2) 增长率,
             round((sum(g_tsal)+sum(t_sal))/(sum(g_tvisit)+sum(t_visit)),2) 月客单, 
             round(((sum(g_tsal)+sum(t_sal))/(sum(g_tvisit)+sum(t_visit))-sum(g_lsal)/sum(g_lvisit))/(sum(g_lsal)/sum(g_lvisit))*100,2) 增长率   
      from step1 t1, step2 t2
      where t1.采购 = t2.采购
      group by rollup(t2.部门,t2.采购)'''</span><span class="token punctuation">,</span> <span class="token string">'时段销售-采购-大综超'</span><span class="token punctuation">,</span> <span class="token string">'group_ind51.xls'</span><span class="token punctuation">,</span> <span class="token string">'group_ind51.png'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token triple-quoted-string string">'''with step1 as(
      select decode(t2.division,1,'1生鲜',2,'2食品',3,'3百货','其他') 部门, 
             case when(t2.buyer_uid like '%NF2%') then '硬百'
             when(t2.buyer_uid like '%NF10%') then '软百'
             else t2.buyer_uid end 采购,
             sum(target) target, sum(t_sal) t_sal, sum(l_sal) l_sal, sum(t_visit) t_visit, sum(l_visit) l_visit 
      from erp_group_ind t1, 
             (select t2.division, name, wm_concat(distinct t1.buyer_uid) buyer_uid 
              from erp_buyer_info t1, groups t2 
              where t1.group_no=t2.group_no group by division, name) t2
      where t1.name = t2.name
            and t1.area_no=11
      group by t2.division, t2.buyer_uid
      ),
      step2 as(
      select decode(t2.division,1,'1生鲜',2,'2食品',3,'3百货','其他') 部门, 
             case when(t2.buyer_uid like '%NF2%') then '硬百'
             when(t2.buyer_uid like '%NF10%') then '软百'
             else t2.buyer_uid end 采购, division,
             --decode(substr(t2.buyer_uid,1,3),'NF2','软百','NF1','硬百',t2.buyer_uid) 采购, 
             sum(target) g_target, sum(g_tsal) g_tsal, sum(g_lsal) g_lsal, sum(g_tvisit) g_tvisit, sum(g_lvisit)g_lvisit 
      from erp_group_heap t1, 
             (select t2.division, name, wm_concat(distinct t1.buyer_uid) buyer_uid 
              from erp_buyer_info t1, groups t2 
              where t1.group_no=t2.group_no group by division, name) t2
      where t1.name = t2.name
            and t1.area_no=11
      group by t2.division, t2.buyer_uid
      )
      select decode(grouping(t2.部门)+grouping(t2.采购),1,'小计',2,'总计', substr(t2.部门,2)) 部门, 
             decode(grouping(t2.采购),1,count(*)||'条',t2.采购) 采购,
             round(sum(t1.target)/10000,2) 日指标, round(sum(t_sal)/10000,2) 日销售, round(sum(t_sal)/sum(target)*100,2) 日达成, round(sum(l_sal)/10000,2) 日同期,
             round((sum(t_sal)-sum(l_sal))/10000,2) 日增长, round(decode(sum(l_sal),0,0,(sum(t_sal)-sum(l_sal))/sum(l_sal)*100),2) 日增长率,
             round((sum(g_tsal)+sum(t_sal))/10000,2) 月销售, round(sum(t2.g_target)/10000,2) 月指标, round((sum(g_tsal)+sum(t_sal))/sum(g_target)*100,2) 月达成, 
             round(decode(sum(g_lsal),0,0,(sum(g_tsal)+sum(t_sal)-sum(g_lsal))/sum(g_lsal)*100),2) 月增长率,
             sum(t_visit) 日来客, sum(t_visit)-sum(l_visit) 增长, round((sum(t_visit)-sum(l_visit))/sum(l_visit)*100,2) 增长率,
             round((sum(g_tvisit)+sum(t_visit))/to_char(sysdate,'DD'),0) 月来客, 
             round((sum(g_tvisit)+sum(t_visit)-sum(g_lvisit))/to_char(sysdate,'DD'),0) 增长, 
             round((sum(g_tvisit)+sum(t_visit)-sum(g_lvisit))/sum(g_lvisit)*100,2) 增长率,
             decode(sum(t_visit),0,0,round(sum(t_sal)/sum(t_visit),2)) 日客单, 
             round((decode(sum(t_visit),0,0,sum(t_sal)/sum(t_visit))-sum(l_sal)/sum(l_visit))/(sum(l_sal)/sum(l_visit))*100,2) 增长率,
             round((sum(g_tsal)+sum(t_sal))/(sum(g_tvisit)+sum(t_visit)),2) 月客单, 
             round(((sum(g_tsal)+sum(t_sal))/(sum(g_tvisit)+sum(t_visit))-sum(g_lsal)/sum(g_lvisit))/(sum(g_lsal)/sum(g_lvisit))*100,2) 增长率   
      from step1 t1, step2 t2
      where t1.采购 = t2.采购
      group by rollup(t2.部门,t2.采购)'''</span><span class="token punctuation">,</span> <span class="token string">'时段销售-采购-小综超'</span><span class="token punctuation">,</span> <span class="token string">'group_ind11.xls'</span><span class="token punctuation">,</span> <span class="token string">'group_ind11.png'</span><span class="token punctuation">]</span>
  <span class="token punctuation">]</span>
  <span class="token keyword">return</span> sqlmap_night
<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    getParam<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br><span class="line-number">143</span><br><span class="line-number">144</span><br><span class="line-number">145</span><br><span class="line-number">146</span><br><span class="line-number">147</span><br><span class="line-number">148</span><br><span class="line-number">149</span><br><span class="line-number">150</span><br><span class="line-number">151</span><br><span class="line-number">152</span><br><span class="line-number">153</span><br><span class="line-number">154</span><br><span class="line-number">155</span><br><span class="line-number">156</span><br><span class="line-number">157</span><br><span class="line-number">158</span><br><span class="line-number">159</span><br><span class="line-number">160</span><br><span class="line-number">161</span><br><span class="line-number">162</span><br><span class="line-number">163</span><br><span class="line-number">164</span><br><span class="line-number">165</span><br><span class="line-number">166</span><br><span class="line-number">167</span><br><span class="line-number">168</span><br><span class="line-number">169</span><br><span class="line-number">170</span><br><span class="line-number">171</span><br><span class="line-number">172</span><br><span class="line-number">173</span><br><span class="line-number">174</span><br><span class="line-number">175</span><br><span class="line-number">176</span><br><span class="line-number">177</span><br><span class="line-number">178</span><br><span class="line-number">179</span><br><span class="line-number">180</span><br><span class="line-number">181</span><br><span class="line-number">182</span><br><span class="line-number">183</span><br><span class="line-number">184</span><br><span class="line-number">185</span><br><span class="line-number">186</span><br><span class="line-number">187</span><br><span class="line-number">188</span><br><span class="line-number">189</span><br><span class="line-number">190</span><br><span class="line-number">191</span><br><span class="line-number">192</span><br><span class="line-number">193</span><br><span class="line-number">194</span><br><span class="line-number">195</span><br><span class="line-number">196</span><br><span class="line-number">197</span><br><span class="line-number">198</span><br><span class="line-number">199</span><br><span class="line-number">200</span><br><span class="line-number">201</span><br><span class="line-number">202</span><br><span class="line-number">203</span><br><span class="line-number">204</span><br><span class="line-number">205</span><br><span class="line-number">206</span><br><span class="line-number">207</span><br><span class="line-number">208</span><br><span class="line-number">209</span><br><span class="line-number">210</span><br><span class="line-number">211</span><br><span class="line-number">212</span><br><span class="line-number">213</span><br><span class="line-number">214</span><br><span class="line-number">215</span><br><span class="line-number">216</span><br><span class="line-number">217</span><br><span class="line-number">218</span><br><span class="line-number">219</span><br><span class="line-number">220</span><br><span class="line-number">221</span><br><span class="line-number">222</span><br><span class="line-number">223</span><br><span class="line-number">224</span><br><span class="line-number">225</span><br><span class="line-number">226</span><br><span class="line-number">227</span><br><span class="line-number">228</span><br><span class="line-number">229</span><br><span class="line-number">230</span><br><span class="line-number">231</span><br><span class="line-number">232</span><br><span class="line-number">233</span><br><span class="line-number">234</span><br><span class="line-number">235</span><br><span class="line-number">236</span><br><span class="line-number">237</span><br><span class="line-number">238</span><br><span class="line-number">239</span><br><span class="line-number">240</span><br><span class="line-number">241</span><br><span class="line-number">242</span><br><span class="line-number">243</span><br><span class="line-number">244</span><br><span class="line-number">245</span><br><span class="line-number">246</span><br><span class="line-number">247</span><br><span class="line-number">248</span><br><span class="line-number">249</span><br><span class="line-number">250</span><br><span class="line-number">251</span><br><span class="line-number">252</span><br><span class="line-number">253</span><br><span class="line-number">254</span><br><span class="line-number">255</span><br><span class="line-number">256</span><br><span class="line-number">257</span><br><span class="line-number">258</span><br><span class="line-number">259</span><br><span class="line-number">260</span><br><span class="line-number">261</span><br><span class="line-number">262</span><br><span class="line-number">263</span><br><span class="line-number">264</span><br><span class="line-number">265</span><br><span class="line-number">266</span><br><span class="line-number">267</span><br><span class="line-number">268</span><br><span class="line-number">269</span><br><span class="line-number">270</span><br><span class="line-number">271</span><br><span class="line-number">272</span><br><span class="line-number">273</span><br><span class="line-number">274</span><br><span class="line-number">275</span><br><span class="line-number">276</span><br><span class="line-number">277</span><br><span class="line-number">278</span><br><span class="line-number">279</span><br><span class="line-number">280</span><br><span class="line-number">281</span><br><span class="line-number">282</span><br><span class="line-number">283</span><br><span class="line-number">284</span><br><span class="line-number">285</span><br><span class="line-number">286</span><br><span class="line-number">287</span><br><span class="line-number">288</span><br><span class="line-number">289</span><br><span class="line-number">290</span><br><span class="line-number">291</span><br><span class="line-number">292</span><br><span class="line-number">293</span><br><span class="line-number">294</span><br><span class="line-number">295</span><br><span class="line-number">296</span><br><span class="line-number">297</span><br><span class="line-number">298</span><br><span class="line-number">299</span><br><span class="line-number">300</span><br><span class="line-number">301</span><br><span class="line-number">302</span><br><span class="line-number">303</span><br><span class="line-number">304</span><br><span class="line-number">305</span><br><span class="line-number">306</span><br><span class="line-number">307</span><br><span class="line-number">308</span><br><span class="line-number">309</span><br><span class="line-number">310</span><br><span class="line-number">311</span><br><span class="line-number">312</span><br><span class="line-number">313</span><br><span class="line-number">314</span><br><span class="line-number">315</span><br><span class="line-number">316</span><br><span class="line-number">317</span><br><span class="line-number">318</span><br><span class="line-number">319</span><br><span class="line-number">320</span><br><span class="line-number">321</span><br><span class="line-number">322</span><br><span class="line-number">323</span><br><span class="line-number">324</span><br><span class="line-number">325</span><br><span class="line-number">326</span><br><span class="line-number">327</span><br><span class="line-number">328</span><br><span class="line-number">329</span><br><span class="line-number">330</span><br><span class="line-number">331</span><br><span class="line-number">332</span><br><span class="line-number">333</span><br><span class="line-number">334</span><br><span class="line-number">335</span><br><span class="line-number">336</span><br><span class="line-number">337</span><br><span class="line-number">338</span><br><span class="line-number">339</span><br><span class="line-number">340</span><br><span class="line-number">341</span><br><span class="line-number">342</span><br><span class="line-number">343</span><br><span class="line-number">344</span><br><span class="line-number">345</span><br><span class="line-number">346</span><br><span class="line-number">347</span><br><span class="line-number">348</span><br><span class="line-number">349</span><br><span class="line-number">350</span><br><span class="line-number">351</span><br><span class="line-number">352</span><br><span class="line-number">353</span><br><span class="line-number">354</span><br><span class="line-number">355</span><br><span class="line-number">356</span><br><span class="line-number">357</span><br><span class="line-number">358</span><br><span class="line-number">359</span><br><span class="line-number">360</span><br><span class="line-number">361</span><br><span class="line-number">362</span><br><span class="line-number">363</span><br><span class="line-number">364</span><br><span class="line-number">365</span><br><span class="line-number">366</span><br><span class="line-number">367</span><br><span class="line-number">368</span><br><span class="line-number">369</span><br><span class="line-number">370</span><br><span class="line-number">371</span><br><span class="line-number">372</span><br><span class="line-number">373</span><br><span class="line-number">374</span><br><span class="line-number">375</span><br><span class="line-number">376</span><br><span class="line-number">377</span><br><span class="line-number">378</span><br><span class="line-number">379</span><br><span class="line-number">380</span><br><span class="line-number">381</span><br><span class="line-number">382</span><br><span class="line-number">383</span><br><span class="line-number">384</span><br><span class="line-number">385</span><br><span class="line-number">386</span><br><span class="line-number">387</span><br><span class="line-number">388</span><br><span class="line-number">389</span><br><span class="line-number">390</span><br><span class="line-number">391</span><br><span class="line-number">392</span><br><span class="line-number">393</span><br><span class="line-number">394</span><br><span class="line-number">395</span><br><span class="line-number">396</span><br><span class="line-number">397</span><br><span class="line-number">398</span><br><span class="line-number">399</span><br><span class="line-number">400</span><br><span class="line-number">401</span><br><span class="line-number">402</span><br><span class="line-number">403</span><br><span class="line-number">404</span><br><span class="line-number">405</span><br><span class="line-number">406</span><br><span class="line-number">407</span><br><span class="line-number">408</span><br><span class="line-number">409</span><br><span class="line-number">410</span><br><span class="line-number">411</span><br><span class="line-number">412</span><br><span class="line-number">413</span><br><span class="line-number">414</span><br><span class="line-number">415</span><br><span class="line-number">416</span><br><span class="line-number">417</span><br><span class="line-number">418</span><br><span class="line-number">419</span><br><span class="line-number">420</span><br><span class="line-number">421</span><br><span class="line-number">422</span><br><span class="line-number">423</span><br><span class="line-number">424</span><br><span class="line-number">425</span><br><span class="line-number">426</span><br><span class="line-number">427</span><br><span class="line-number">428</span><br><span class="line-number">429</span><br><span class="line-number">430</span><br><span class="line-number">431</span><br><span class="line-number">432</span><br><span class="line-number">433</span><br><span class="line-number">434</span><br><span class="line-number">435</span><br><span class="line-number">436</span><br><span class="line-number">437</span><br><span class="line-number">438</span><br><span class="line-number">439</span><br><span class="line-number">440</span><br><span class="line-number">441</span><br><span class="line-number">442</span><br><span class="line-number">443</span><br><span class="line-number">444</span><br><span class="line-number">445</span><br><span class="line-number">446</span><br><span class="line-number">447</span><br><span class="line-number">448</span><br><span class="line-number">449</span><br><span class="line-number">450</span><br><span class="line-number">451</span><br><span class="line-number">452</span><br><span class="line-number">453</span><br><span class="line-number">454</span><br><span class="line-number">455</span><br><span class="line-number">456</span><br><span class="line-number">457</span><br><span class="line-number">458</span><br><span class="line-number">459</span><br><span class="line-number">460</span><br><span class="line-number">461</span><br><span class="line-number">462</span><br><span class="line-number">463</span><br><span class="line-number">464</span><br><span class="line-number">465</span><br><span class="line-number">466</span><br><span class="line-number">467</span><br><span class="line-number">468</span><br><span class="line-number">469</span><br><span class="line-number">470</span><br><span class="line-number">471</span><br><span class="line-number">472</span><br><span class="line-number">473</span><br><span class="line-number">474</span><br><span class="line-number">475</span><br><span class="line-number">476</span><br><span class="line-number">477</span><br><span class="line-number">478</span><br><span class="line-number">479</span><br><span class="line-number">480</span><br><span class="line-number">481</span><br><span class="line-number">482</span><br><span class="line-number">483</span><br><span class="line-number">484</span><br><span class="line-number">485</span><br><span class="line-number">486</span><br><span class="line-number">487</span><br><span class="line-number">488</span><br><span class="line-number">489</span><br><span class="line-number">490</span><br><span class="line-number">491</span><br><span class="line-number">492</span><br><span class="line-number">493</span><br><span class="line-number">494</span><br><span class="line-number">495</span><br><span class="line-number">496</span><br><span class="line-number">497</span><br><span class="line-number">498</span><br><span class="line-number">499</span><br><span class="line-number">500</span><br><span class="line-number">501</span><br><span class="line-number">502</span><br><span class="line-number">503</span><br><span class="line-number">504</span><br><span class="line-number">505</span><br><span class="line-number">506</span><br><span class="line-number">507</span><br><span class="line-number">508</span><br><span class="line-number">509</span><br><span class="line-number">510</span><br><span class="line-number">511</span><br><span class="line-number">512</span><br><span class="line-number">513</span><br><span class="line-number">514</span><br><span class="line-number">515</span><br><span class="line-number">516</span><br><span class="line-number">517</span><br><span class="line-number">518</span><br><span class="line-number">519</span><br><span class="line-number">520</span><br><span class="line-number">521</span><br><span class="line-number">522</span><br><span class="line-number">523</span><br><span class="line-number">524</span><br><span class="line-number">525</span><br><span class="line-number">526</span><br><span class="line-number">527</span><br><span class="line-number">528</span><br><span class="line-number">529</span><br><span class="line-number">530</span><br><span class="line-number">531</span><br><span class="line-number">532</span><br><span class="line-number">533</span><br><span class="line-number">534</span><br><span class="line-number">535</span><br><span class="line-number">536</span><br><span class="line-number">537</span><br><span class="line-number">538</span><br><span class="line-number">539</span><br><span class="line-number">540</span><br><span class="line-number">541</span><br><span class="line-number">542</span><br><span class="line-number">543</span><br><span class="line-number">544</span><br><span class="line-number">545</span><br><span class="line-number">546</span><br><span class="line-number">547</span><br><span class="line-number">548</span><br><span class="line-number">549</span><br><span class="line-number">550</span><br><span class="line-number">551</span><br><span class="line-number">552</span><br><span class="line-number">553</span><br><span class="line-number">554</span><br><span class="line-number">555</span><br><span class="line-number">556</span><br><span class="line-number">557</span><br><span class="line-number">558</span><br><span class="line-number">559</span><br><span class="line-number">560</span><br><span class="line-number">561</span><br><span class="line-number">562</span><br><span class="line-number">563</span><br><span class="line-number">564</span><br><span class="line-number">565</span><br><span class="line-number">566</span><br><span class="line-number">567</span><br><span class="line-number">568</span><br><span class="line-number">569</span><br><span class="line-number">570</span><br><span class="line-number">571</span><br><span class="line-number">572</span><br><span class="line-number">573</span><br><span class="line-number">574</span><br><span class="line-number">575</span><br><span class="line-number">576</span><br><span class="line-number">577</span><br><span class="line-number">578</span><br><span class="line-number">579</span><br><span class="line-number">580</span><br><span class="line-number">581</span><br><span class="line-number">582</span><br><span class="line-number">583</span><br><span class="line-number">584</span><br><span class="line-number">585</span><br><span class="line-number">586</span><br><span class="line-number">587</span><br><span class="line-number">588</span><br><span class="line-number">589</span><br><span class="line-number">590</span><br><span class="line-number">591</span><br><span class="line-number">592</span><br><span class="line-number">593</span><br><span class="line-number">594</span><br><span class="line-number">595</span><br><span class="line-number">596</span><br><span class="line-number">597</span><br><span class="line-number">598</span><br><span class="line-number">599</span><br><span class="line-number">600</span><br><span class="line-number">601</span><br><span class="line-number">602</span><br><span class="line-number">603</span><br><span class="line-number">604</span><br><span class="line-number">605</span><br><span class="line-number">606</span><br><span class="line-number">607</span><br><span class="line-number">608</span><br><span class="line-number">609</span><br><span class="line-number">610</span><br><span class="line-number">611</span><br><span class="line-number">612</span><br><span class="line-number">613</span><br><span class="line-number">614</span><br><span class="line-number">615</span><br><span class="line-number">616</span><br><span class="line-number">617</span><br><span class="line-number">618</span><br><span class="line-number">619</span><br><span class="line-number">620</span><br><span class="line-number">621</span><br><span class="line-number">622</span><br><span class="line-number">623</span><br><span class="line-number">624</span><br><span class="line-number">625</span><br><span class="line-number">626</span><br><span class="line-number">627</span><br><span class="line-number">628</span><br><span class="line-number">629</span><br><span class="line-number">630</span><br><span class="line-number">631</span><br><span class="line-number">632</span><br><span class="line-number">633</span><br><span class="line-number">634</span><br><span class="line-number">635</span><br><span class="line-number">636</span><br><span class="line-number">637</span><br><span class="line-number">638</span><br><span class="line-number">639</span><br><span class="line-number">640</span><br><span class="line-number">641</span><br><span class="line-number">642</span><br><span class="line-number">643</span><br><span class="line-number">644</span><br><span class="line-number">645</span><br><span class="line-number">646</span><br><span class="line-number">647</span><br><span class="line-number">648</span><br><span class="line-number">649</span><br><span class="line-number">650</span><br><span class="line-number">651</span><br><span class="line-number">652</span><br><span class="line-number">653</span><br><span class="line-number">654</span><br><span class="line-number">655</span><br><span class="line-number">656</span><br><span class="line-number">657</span><br><span class="line-number">658</span><br><span class="line-number">659</span><br><span class="line-number">660</span><br><span class="line-number">661</span><br><span class="line-number">662</span><br><span class="line-number">663</span><br><span class="line-number">664</span><br><span class="line-number">665</span><br><span class="line-number">666</span><br><span class="line-number">667</span><br><span class="line-number">668</span><br><span class="line-number">669</span><br><span class="line-number">670</span><br><span class="line-number">671</span><br><span class="line-number">672</span><br><span class="line-number">673</span><br><span class="line-number">674</span><br><span class="line-number">675</span><br><span class="line-number">676</span><br><span class="line-number">677</span><br><span class="line-number">678</span><br><span class="line-number">679</span><br><span class="line-number">680</span><br><span class="line-number">681</span><br><span class="line-number">682</span><br><span class="line-number">683</span><br><span class="line-number">684</span><br><span class="line-number">685</span><br><span class="line-number">686</span><br><span class="line-number">687</span><br><span class="line-number">688</span><br><span class="line-number">689</span><br><span class="line-number">690</span><br><span class="line-number">691</span><br><span class="line-number">692</span><br><span class="line-number">693</span><br><span class="line-number">694</span><br><span class="line-number">695</span><br><span class="line-number">696</span><br><span class="line-number">697</span><br><span class="line-number">698</span><br><span class="line-number">699</span><br><span class="line-number">700</span><br><span class="line-number">701</span><br></div></div><h2 id="网络爬虫的应用"><a href="#网络爬虫的应用" class="header-anchor">#</a> 网络爬虫的应用</h2> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">from</span> selenium <span class="token keyword">import</span> webdriver
<span class="token keyword">from</span> selenium<span class="token punctuation">.</span>webdriver<span class="token punctuation">.</span>common<span class="token punctuation">.</span>by <span class="token keyword">import</span> By
<span class="token keyword">from</span> selenium<span class="token punctuation">.</span>webdriver<span class="token punctuation">.</span>support<span class="token punctuation">.</span>ui <span class="token keyword">import</span> WebDriverWait
<span class="token keyword">from</span> selenium<span class="token punctuation">.</span>webdriver<span class="token punctuation">.</span>support <span class="token keyword">import</span> expected_conditions <span class="token keyword">as</span> EC
<span class="token keyword">import</span> time
<span class="token keyword">import</span> threading
<span class="token keyword">import</span> os<span class="token punctuation">,</span>shutil

subdir <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'89'</span><span class="token punctuation">,</span><span class="token string">'30'</span><span class="token punctuation">,</span><span class="token string">'84'</span><span class="token punctuation">,</span><span class="token string">'71'</span><span class="token punctuation">,</span><span class="token string">'10'</span><span class="token punctuation">,</span><span class="token string">'21'</span><span class="token punctuation">,</span><span class="token string">'51'</span><span class="token punctuation">,</span><span class="token string">'07'</span><span class="token punctuation">,</span><span class="token string">'05'</span><span class="token punctuation">,</span><span class="token string">'68'</span><span class="token punctuation">,</span><span class="token string">'88'</span><span class="token punctuation">]</span>
dirname <span class="token operator">=</span> <span class="token string">'c:\\temp\\'</span>
identify <span class="token operator">=</span> <span class="token number">0</span>

<span class="token keyword">def</span> <span class="token function">getChrome</span><span class="token punctuation">(</span>download_location<span class="token punctuation">,</span>menuid<span class="token punctuation">,</span>packpath<span class="token punctuation">)</span><span class="token punctuation">:</span>
  starttime <span class="token operator">=</span> time<span class="token punctuation">.</span>asctime<span class="token punctuation">(</span>time<span class="token punctuation">.</span>localtime<span class="token punctuation">(</span>time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token keyword">print</span><span class="token punctuation">(</span>download_location<span class="token operator">+</span><span class="token string">'_start'</span><span class="token punctuation">)</span>
  browser <span class="token operator">=</span> <span class="token string">''</span>
  ex <span class="token operator">=</span> <span class="token number">0</span>
  <span class="token keyword">while</span> ex <span class="token operator">&lt;</span> <span class="token number">6</span><span class="token punctuation">:</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
      option <span class="token operator">=</span> webdriver<span class="token punctuation">.</span>ChromeOptions<span class="token punctuation">(</span><span class="token punctuation">)</span>
      option<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">&quot;--headless&quot;</span><span class="token punctuation">)</span>
      option<span class="token punctuation">.</span>add_experimental_option<span class="token punctuation">(</span><span class="token string">'excludeSwitches'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'enable-automation'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
      option<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">'log-level=3'</span><span class="token punctuation">)</span>
      <span class="token comment"># option.add_experimental_option('prefs', prefs)</span>
      browser <span class="token operator">=</span> webdriver<span class="token punctuation">.</span>Chrome<span class="token punctuation">(</span>executable_path<span class="token operator">=</span>packpath<span class="token punctuation">,</span> chrome_options<span class="token operator">=</span>option<span class="token punctuation">)</span>  <span class="token comment"># 调用chrome，加载配置</span>
      browser<span class="token punctuation">.</span>set_window_size<span class="token punctuation">(</span><span class="token number">1440</span><span class="token punctuation">,</span> <span class="token number">900</span><span class="token punctuation">)</span>  <span class="token comment"># 调整浏览器尺寸</span>
      browser<span class="token punctuation">.</span>command_executor<span class="token punctuation">.</span>_commands<span class="token punctuation">[</span><span class="token string">&quot;send_command&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">&quot;POST&quot;</span><span class="token punctuation">,</span> <span class="token string">'/session/$sessionId/chromium/send_command'</span><span class="token punctuation">)</span>
      <span class="token comment"># 加载下载属性</span>
      params <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">'cmd'</span><span class="token punctuation">:</span> <span class="token string">'Page.setDownloadBehavior'</span><span class="token punctuation">,</span> <span class="token string">'params'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token string">'behavior'</span><span class="token punctuation">:</span> <span class="token string">'allow'</span><span class="token punctuation">,</span> <span class="token string">'downloadPath'</span><span class="token punctuation">:</span> download_location<span class="token punctuation">}</span><span class="token punctuation">}</span>
      command_result <span class="token operator">=</span> browser<span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token string">&quot;send_command&quot;</span><span class="token punctuation">,</span> params<span class="token punctuation">)</span>

      url <span class="token operator">=</span> <span class="token string">&quot;http://10.4.18.41:8080/WebReport/ReportServer?op=fs_load&amp;cmd=fs_signin&amp;_=1592193358476&quot;</span>
      browser<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">)</span>
      <span class="token comment"># print(browser.title)</span>
      <span class="token comment"># 进入登录页验证</span>
      browser<span class="token punctuation">.</span>find_element_by_xpath<span class="token punctuation">(</span><span class="token string">'//*[@id=&quot;fs-login-content&quot;]/div[2]/input'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>send_keys<span class="token punctuation">(</span><span class="token string">'xxx'</span><span class="token punctuation">)</span>
      browser<span class="token punctuation">.</span>find_element_by_xpath<span class="token punctuation">(</span><span class="token string">'//*[@id=&quot;fs-login-content&quot;]/div[3]/input'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>send_keys<span class="token punctuation">(</span><span class="token string">'xxx'</span><span class="token punctuation">)</span>
      browser<span class="token punctuation">.</span>find_element_by_xpath<span class="token punctuation">(</span><span class="token string">'//*[@id=&quot;fs-login-btn&quot;]'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>click<span class="token punctuation">(</span><span class="token punctuation">)</span>
      time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>

      <span class="token comment"># 侧边条树形菜单点击</span>
      sideMenu1 <span class="token operator">=</span> browser<span class="token punctuation">.</span>find_element_by_xpath<span class="token punctuation">(</span><span class="token string">'//*[@id=&quot;fs-frame-menu&quot;]/div[1]/div[1]/div/ul/li[9]/a'</span><span class="token punctuation">)</span>
      sideMenu1<span class="token punctuation">.</span>click<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 点击----地区报表</span>
      sideMenu2 <span class="token operator">=</span> browser<span class="token punctuation">.</span>find_element_by_xpath<span class="token punctuation">(</span><span class="token string">'//*[@id=&quot;fs-frame-menu&quot;]/div[1]/div[1]/div/ul/li[9]/ul/li[1]/a'</span><span class="token punctuation">)</span>
      sideMenu2<span class="token punctuation">.</span>click<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 点击----01.北京地区</span>
      js <span class="token operator">=</span> <span class="token string">'document.getElementsByClassName(&quot;menutree-node fs-menu-item menutree-child fui-seb fui-fht select&quot;)[0].scrollIntoView()'</span>
      browser<span class="token punctuation">.</span>execute_script<span class="token punctuation">(</span>js<span class="token punctuation">)</span>  <span class="token comment"># 执行JavaScript使得后选择滚动进可视区域</span>
      sideMenu3 <span class="token operator">=</span> browser<span class="token punctuation">.</span>find_element_by_xpath<span class="token punctuation">(</span><span class="token string">'//*[@id=&quot;fs-frame-menu&quot;]/div[1]/div[1]/div/ul/li[9]/ul/li[1]/ul/li[18]/a'</span><span class="token punctuation">)</span>
      sideMenu3<span class="token punctuation">.</span>click<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 点击----参数预估表</span>

      <span class="token comment"># 切换IFrame</span>
      iframe <span class="token operator">=</span> browser<span class="token punctuation">.</span>find_elements_by_tag_name<span class="token punctuation">(</span><span class="token string">&quot;iframe&quot;</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
      browser<span class="token punctuation">.</span>switch_to<span class="token punctuation">.</span>frame<span class="token punctuation">(</span>iframe<span class="token punctuation">)</span>

      <span class="token comment">###级联菜单####</span>
      <span class="token comment"># 1</span>
      browser<span class="token punctuation">.</span>find_element_by_class_name<span class="token punctuation">(</span><span class="token string">'fr-trigger-btn-up'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>click<span class="token punctuation">(</span><span class="token punctuation">)</span>
      time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">)</span>
      droplist1 <span class="token operator">=</span> browser<span class="token punctuation">.</span>find_element_by_xpath<span class="token punctuation">(</span><span class="token string">'/html/body/div[3]/div[1]/div[2]/div/span'</span><span class="token punctuation">)</span>
      droplist1<span class="token punctuation">.</span>click<span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token comment"># 2</span>
      browser<span class="token punctuation">.</span>find_element_by_xpath<span class="token punctuation">(</span><span class="token string">'/html/body/div[1]/div[1]/div[2]/div/div[8]/div[2]'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>click<span class="token punctuation">(</span><span class="token punctuation">)</span>
      time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">)</span>
      droplist2 <span class="token operator">=</span> browser<span class="token punctuation">.</span>find_element_by_xpath<span class="token punctuation">(</span>menuid<span class="token punctuation">)</span>
      <span class="token keyword">print</span><span class="token punctuation">(</span>droplist2<span class="token punctuation">.</span>text<span class="token punctuation">)</span>
      droplist2<span class="token punctuation">.</span>click<span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token comment"># 3/html/body/div[3]/div[3]/div[1]/div/span</span>
      browser<span class="token punctuation">.</span>find_element_by_xpath<span class="token punctuation">(</span><span class="token string">'/html/body/div[1]/div[1]/div[2]/div/div[9]/div[2]'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>click<span class="token punctuation">(</span><span class="token punctuation">)</span>
      time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">)</span>
      droplist3 <span class="token operator">=</span> browser<span class="token punctuation">.</span>find_element_by_xpath<span class="token punctuation">(</span><span class="token string">'/html/body/div[3]/div[3]/div[1]/div/span'</span><span class="token punctuation">)</span>
      droplist3<span class="token punctuation">.</span>click<span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token comment"># 4 BUTTON</span>
      browser<span class="token punctuation">.</span>find_element_by_xpath<span class="token punctuation">(</span><span class="token string">'//*[@id=&quot;fr-btn-WIDGET1&quot;]/div/em/button'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>click<span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token keyword">break</span>
      <span class="token comment">####End####</span>
    <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
      <span class="token keyword">print</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
      ex <span class="token operator">+=</span> <span class="token number">1</span>


  <span class="token comment">####等待结果####</span>
  <span class="token keyword">try</span><span class="token punctuation">:</span>
    element <span class="token operator">=</span> WebDriverWait<span class="token punctuation">(</span>browser<span class="token punctuation">,</span> <span class="token number">500</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span>until<span class="token punctuation">(</span>
      EC<span class="token punctuation">.</span>presence_of_element_located<span class="token punctuation">(</span><span class="token punctuation">(</span>By<span class="token punctuation">.</span>CLASS_NAME<span class="token punctuation">,</span> <span class="token string">'x-table'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span>
    table <span class="token operator">=</span> browser<span class="token punctuation">.</span>find_elements_by_class_name<span class="token punctuation">(</span><span class="token string">'x-table'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
  <span class="token keyword">finally</span><span class="token punctuation">:</span>
    <span class="token comment"># 点击保存</span>
    btn_save <span class="token operator">=</span> browser<span class="token punctuation">.</span>find_elements_by_xpath<span class="token punctuation">(</span><span class="token string">'//*[@id=&quot;fr-btn-&quot;]/div/em'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
    btn_save<span class="token punctuation">.</span>click<span class="token punctuation">(</span><span class="token punctuation">)</span>
    btn_excel <span class="token operator">=</span> browser<span class="token punctuation">.</span>find_element_by_xpath<span class="token punctuation">(</span><span class="token string">'/html/body/div[4]/div[2]'</span><span class="token punctuation">)</span>
    btn_excel<span class="token punctuation">.</span>click<span class="token punctuation">(</span><span class="token punctuation">)</span>
    btn_simple <span class="token operator">=</span> browser<span class="token punctuation">.</span>find_element_by_xpath<span class="token punctuation">(</span><span class="token string">'/html/body/div[5]/div[2]/div[1]'</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>btn_simple<span class="token punctuation">.</span>text<span class="token punctuation">)</span>
    btn_simple<span class="token punctuation">.</span>click<span class="token punctuation">(</span><span class="token punctuation">)</span>
    searchname <span class="token operator">=</span> <span class="token string">'参数预估表.xlsx'</span>
    fx <span class="token operator">=</span> <span class="token number">1</span>
    <span class="token keyword">while</span> fx<span class="token punctuation">:</span>
      time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
      <span class="token keyword">for</span> root<span class="token punctuation">,</span>dirs<span class="token punctuation">,</span>files <span class="token keyword">in</span> os<span class="token punctuation">.</span>walk<span class="token punctuation">(</span>download_location<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> searchname <span class="token keyword">in</span> files<span class="token punctuation">:</span>
          fx <span class="token operator">=</span> <span class="token number">0</span>

    browser<span class="token punctuation">.</span>quit<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">global</span> identify
    identify <span class="token operator">+=</span> <span class="token number">1</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>download_location<span class="token operator">+</span><span class="token string">'_end'</span><span class="token punctuation">)</span>
    shutil<span class="token punctuation">.</span>copy<span class="token punctuation">(</span>download_location <span class="token operator">+</span> <span class="token string">'\\'</span> <span class="token operator">+</span> <span class="token string">'参数预估表.xlsx'</span><span class="token punctuation">,</span> dirname <span class="token operator">+</span> <span class="token string">'参数预估表_'</span> <span class="token operator">+</span> download_location<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">'.xlsx'</span><span class="token punctuation">)</span>
    os<span class="token punctuation">.</span>remove<span class="token punctuation">(</span>download_location <span class="token operator">+</span> <span class="token string">'\\'</span> <span class="token operator">+</span> <span class="token string">'参数预估表.xlsx'</span><span class="token punctuation">)</span>
    os<span class="token punctuation">.</span>rmdir<span class="token punctuation">(</span>download_location<span class="token punctuation">)</span>
    endtime <span class="token operator">=</span> time<span class="token punctuation">.</span>asctime<span class="token punctuation">(</span>time<span class="token punctuation">.</span>localtime<span class="token punctuation">(</span>time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'开始时间：{} ---- 结束时间：{}'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>starttime<span class="token punctuation">,</span> endtime<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token comment"># return '参数预估表.xlsx'</span>
  <span class="token comment">################</span>

<span class="token keyword">def</span> <span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
  os<span class="token punctuation">.</span>system<span class="token punctuation">(</span><span class="token string">&quot;taskkill /F /IM chromedriver.exe&quot;</span><span class="token punctuation">)</span>
  j <span class="token operator">=</span> <span class="token number">0</span>
  <span class="token keyword">global</span> dirname<span class="token punctuation">,</span> subdir
  <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">14</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> i <span class="token operator">!=</span> <span class="token number">3</span><span class="token punctuation">:</span>
      i <span class="token operator">=</span> <span class="token builtin">str</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>
      menuid <span class="token operator">=</span> <span class="token string">'/html/body/div[3]/div[2]/div['</span><span class="token operator">+</span>i<span class="token operator">+</span><span class="token string">']/div/span'</span>
      dirs <span class="token operator">=</span> dirname<span class="token operator">+</span>subdir<span class="token punctuation">[</span>j<span class="token punctuation">]</span>
      thread <span class="token operator">=</span> threading<span class="token punctuation">.</span>Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>getChrome<span class="token punctuation">,</span> args<span class="token operator">=</span><span class="token punctuation">(</span>dirs<span class="token punctuation">,</span>menuid<span class="token punctuation">,</span><span class="token string">'chromedriver.exe'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      thread<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>
      j <span class="token operator">+=</span> <span class="token number">1</span>

<span class="token keyword">def</span> <span class="token function">delFiles</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
  <span class="token keyword">global</span> dirname<span class="token punctuation">,</span> subdir
  <span class="token keyword">for</span> dname <span class="token keyword">in</span> subdir<span class="token punctuation">:</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
      os<span class="token punctuation">.</span>remove<span class="token punctuation">(</span>dirname<span class="token operator">+</span><span class="token string">'参数预估表_'</span><span class="token operator">+</span>dname<span class="token operator">+</span><span class="token string">'.xlsx'</span><span class="token punctuation">)</span>
    <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
      <span class="token keyword">print</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>


<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
  delFiles<span class="token punctuation">(</span><span class="token punctuation">)</span>
  getData<span class="token punctuation">(</span><span class="token punctuation">)</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br></div></div><p>如果需要隐藏控制台，除了正常编译参数以外还需要修改文件</p> <p>目录：\Lib\site-packages\selenium\webdriver\common\services.py</p> <p>添加：from win32process import CREATE_NO_WINDOW</p> <p>修改：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code>self<span class="token punctuation">.</span>process <span class="token operator">=</span> subprocess<span class="token punctuation">.</span>Popen<span class="token punctuation">(</span>cmd<span class="token punctuation">,</span> env<span class="token operator">=</span>self<span class="token punctuation">.</span>env<span class="token punctuation">,</span>
                                close_fds<span class="token operator">=</span>platform<span class="token punctuation">.</span>system<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token string">'Windows'</span><span class="token punctuation">,</span>
                                stdout<span class="token operator">=</span>self<span class="token punctuation">.</span>log_file<span class="token punctuation">,</span>
                                stderr<span class="token operator">=</span>self<span class="token punctuation">.</span>log_file<span class="token punctuation">,</span>
                                creationflags<span class="token operator">=</span>CREATE_NO_WINDOW<span class="token punctuation">,</span> <span class="token operator">//</span>添加此项设置
                                stdin<span class="token operator">=</span>PIPE<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h2 id="pandas"><a href="#pandas" class="header-anchor">#</a> Pandas</h2> <p>一款强大的数据分析工具。在pycharm中安装最新版本时，需要更新当前工程下\venv\Scripts目录里面的pip。</p> <p>python -m pip install --upgrade pip 否则一直会安装报错，无法使用</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/blog/python/" class="prev router-link-active">
        Python笔记
      </a></span> <!----></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/blog/assets/js/app.d55c3362.js" defer></script><script src="/blog/assets/js/2.e56be046.js" defer></script><script src="/blog/assets/js/22.4c3e2b37.js" defer></script>
  </body>
</html>
